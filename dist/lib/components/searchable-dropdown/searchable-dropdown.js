import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useRef, useState } from 'react';
import styled from 'styled-components';
import FlexRow from '../flex-row/flex-row';
import SvgIcon from '../svg-icon/svg-icon';
import UpIcon from '../../assets/icons/ic-arrow-up.svg';
import DownIcon from '../../assets/icons/ic-arrow-down.svg';
import { useClickAway } from '../../hooks/use-click-away';
var StyledDropdown = styled.div(function (_a) {
    var theme = _a.theme, disabled = _a.disabled;
    return (__assign(__assign({ outline: 'none', position: 'relative', borderRadius: theme.borderRadius.base }, (disabled && {
        opacity: '0.5',
        pointerEvents: 'none',
    })), { background: theme.styleguideColors.fillSecondary, ':hover, :active': {
            background: theme.styleguideColors.fillSecondary,
            svg: {
                path: {
                    fill: theme.styleguideColors.fillPrimaryRed,
                },
            },
        } }));
});
var StyledInput = styled.input(function (_a) {
    var theme = _a.theme, fontSize = _a.fontSize, icon = _a.icon;
    return ({
        lineHeight: '1.5',
        fontSize: fontSize,
        height: '36px',
        borderRadius: theme.borderRadius.base,
        outline: 'none',
        padding: icon ? '0 12px' : '0 16px',
        transition: 'all 200ms ease',
        width: '100%',
        color: theme.styleguideColors.contentPrimary,
        border: 'none',
        background: theme.styleguideColors.fillSecondary,
        ':hover': {
            cursor: 'pointer',
        },
    });
});
var ItemContainer = styled.div(function (_a) {
    var theme = _a.theme, isOpen = _a.isOpen, height = _a.height, fontSize = _a.fontSize, maxHeight = _a.maxHeight;
    return ({
        display: isOpen ? 'block' : 'none',
        borderRadius: theme.borderRadius.base,
        fontSize: fontSize,
        paddingLeft: '6px',
        background: theme.styleguideColors.fillSecondary,
        boxShadow: '0 1px 0 rgba(0, 0, 0, 0.06)',
        marginTop: '4px',
        height: height,
        maxHeight: maxHeight,
        overflowY: 'auto',
        position: 'absolute',
        top: '100%',
        width: '100%',
        zIndex: '1000',
    });
});
var Item = styled.div(function (_a) {
    var theme = _a.theme, selected = _a.selected;
    return ({
        display: 'block',
        cursor: 'pointer',
        padding: '8px 10px',
        color: theme.styleguideColors.contentPrimary,
        ':hover, :active': {
            background: theme.styleguideColors.fillSecondaryBlueHover,
        },
        fontWeight: selected ? 600 : 400,
    });
});
var ArrowSvg = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        marginRight: '16px',
        path: {
            fill: theme.styleguideColors.contentPrimary,
        },
    });
});
var CustomIcon = styled.div(function (_a) {
    var inLoop = _a.inLoop;
    return ({
        margin: inLoop ? '0 12px 0 0' : '0 0 0 16px',
        display: 'inline',
        position: 'relative',
        bottom: inLoop ? '0' : '1px',
    });
});
export var SearchableDropdown = function (_a) {
    var items = _a.items, value = _a.value, height = _a.height, fontSize = _a.fontSize, maxHeight = _a.maxHeight, onSelect = _a.onSelect, placeholder = _a.placeholder;
    var _b = useState(''), query = _b[0], setQuery = _b[1];
    var _c = useState(false), isOpen = _c[0], setIsOpen = _c[1];
    var _d = useState(null), icon = _d[0], setIcon = _d[1];
    useEffect(function () {
        value.icon && setIcon(value.icon);
    }, [value]);
    var inputRef = useRef(null);
    var ref = useClickAway({
        callback: function () {
            setIsOpen(false);
        },
    }).ref;
    var selectOption = function (option) {
        setQuery(function () { return ''; });
        onSelect(option);
        setIsOpen(function (isOpen) { return !isOpen; });
        setIcon(option.icon);
    };
    var toggle = function (e) {
        setIsOpen(e && e.target === inputRef.current);
    };
    var getDisplayValue = function () {
        if (query)
            return query;
        if (value)
            return value.label;
        return '';
    };
    var filterOptionsWithSearchedValue = function (options, query) {
        return options.filter(function (option) { return option.label.toLowerCase().indexOf(query.toLowerCase()) > -1; });
    };
    var searchedOptions = filterOptionsWithSearchedValue(items, query);
    return (_jsxs(StyledDropdown, __assign({ ref: ref }, { children: [_jsxs(FlexRow, __assign({ align: "center", justify: "space-between" }, { children: [icon && _jsx(CustomIcon, { children: icon }), _jsx(StyledInput, { ref: inputRef, placeholder: placeholder, value: getDisplayValue(), onChange: function (e) {
                            setQuery(e.target.value);
                            onSelect({});
                        }, onClick: toggle, fontSize: fontSize, icon: Boolean(icon) }), _jsx(ArrowSvg, { src: isOpen ? UpIcon : DownIcon })] })), _jsx(ItemContainer, __assign({ isOpen: isOpen, height: height, fontSize: fontSize, maxHeight: maxHeight }, { children: searchedOptions.map(function (item, index) {
                    return (_jsxs(Item, __assign({ onClick: function () { return selectOption(item); }, selected: item.value === value.value }, { children: [item.icon && _jsx(CustomIcon, __assign({ inLoop: true }, { children: item.icon })), item.label] }), index));
                }) }))] })));
};
export default SearchableDropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoYWJsZS1kcm9wZG93bi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9zZWFyY2hhYmxlLWRyb3Bkb3duL3NlYXJjaGFibGUtZHJvcGRvd24udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQzNELE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sTUFBTSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hELE9BQU8sUUFBUSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUUxRCxJQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUMvQixVQUFDLEVBQW1CO1FBQWpCLEtBQUssV0FBQSxFQUFFLFFBQVEsY0FBQTtJQUFPLE9BQUEscUJBQ3ZCLE9BQU8sRUFBRSxNQUFNLEVBQ2YsUUFBUSxFQUFFLFVBQVUsRUFDcEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUVsQyxDQUFDLFFBQVEsSUFBSTtRQUNkLE9BQU8sRUFBRSxLQUFLO1FBQ2QsYUFBYSxFQUFFLE1BQU07S0FDdEIsQ0FBQyxLQUVGLFVBQVUsRUFBRSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUNoRCxpQkFBaUIsRUFBRTtZQUNqQixVQUFVLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGFBQWE7WUFDaEQsR0FBRyxFQUFFO2dCQUNILElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGNBQWM7aUJBQzVDO2FBQ0Y7U0FDRixJQUNEO0FBbkJ1QixD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LENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzs0QkFDekIsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3dCQUNmLENBQUMsRUFDRCxPQUFPLEVBQUUsTUFBTSxFQUNmLFFBQVEsRUFBRSxRQUFRLEVBQ2xCLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQ25CLEVBQ0YsS0FBQyxRQUFRLElBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUksS0FDckMsRUFFVixLQUFDLGFBQWEsYUFDWixNQUFNLEVBQUUsTUFBTSxFQUNkLE1BQU0sRUFBRSxNQUFNLEVBQ2QsUUFBUSxFQUFFLFFBQVEsRUFDbEIsU0FBUyxFQUFFLFNBQVMsZ0JBRW5CLGVBQWUsQ0FBQyxHQUFHLENBQUMsVUFBQyxJQUFJLEVBQUUsS0FBSztvQkFDL0IsT0FBTyxDQUNMLE1BQUMsSUFBSSxhQUNILE9BQU8sRUFBRSxjQUFNLE9BQUEsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFsQixDQUFrQixFQUNqQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsS0FBSyxpQkFHbkMsSUFBSSxDQUFDLElBQUksSUFBSSxLQUFDLFVBQVUsYUFBQyxNQUFNLHNCQUFFLElBQUksQ0FBQyxJQUFJLElBQWMsRUFDeEQsSUFBSSxDQUFDLEtBQUssTUFITixLQUFLLENBSUwsQ0FDUixDQUFDO2dCQUNKLENBQUMsQ0FBQyxJQUNZLEtBQ0QsQ0FDbEIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGVBQWUsa0JBQWtCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgRmxleFJvdyBmcm9tICcuLi9mbGV4LXJvdy9mbGV4LXJvdyc7XG5pbXBvcnQgU3ZnSWNvbiBmcm9tICcuLi9zdmctaWNvbi9zdmctaWNvbic7XG5pbXBvcnQgVXBJY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1hcnJvdy11cC5zdmcnO1xuaW1wb3J0IERvd25JY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1hcnJvdy1kb3duLnN2Zyc7XG5pbXBvcnQgeyB1c2VDbGlja0F3YXkgfSBmcm9tICcuLi8uLi9ob29rcy91c2UtY2xpY2stYXdheSc7XG5cbmNvbnN0IFN0eWxlZERyb3Bkb3duID0gc3R5bGVkLmRpdjx7IGRpc2FibGVkPzogYm9vbGVhbiB9PihcbiAgKHsgdGhlbWUsIGRpc2FibGVkIH0pID0+ICh7XG4gICAgb3V0bGluZTogJ25vbmUnLFxuICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIGJvcmRlclJhZGl1czogdGhlbWUuYm9yZGVyUmFkaXVzLmJhc2UsXG5cbiAgICAuLi4oZGlzYWJsZWQgJiYge1xuICAgICAgb3BhY2l0eTogJzAuNScsXG4gICAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScsXG4gICAgfSksXG5cbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgICAgIHN2Zzoge1xuICAgICAgICBwYXRoOiB7XG4gICAgICAgICAgZmlsbDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsUHJpbWFyeVJlZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbik7XG5cbmNvbnN0IFN0eWxlZElucHV0ID0gc3R5bGVkLmlucHV0PHsgZm9udFNpemU/OiBzdHJpbmc7IGljb24/OiBib29sZWFuIH0+KFxuICAoeyB0aGVtZSwgZm9udFNpemUsIGljb24gfSkgPT4gKHtcbiAgICBsaW5lSGVpZ2h0OiAnMS41JyxcbiAgICBmb250U2l6ZTogZm9udFNpemUsXG4gICAgaGVpZ2h0OiAnMzZweCcsXG4gICAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgcGFkZGluZzogaWNvbiA/ICcwIDEycHgnIDogJzAgMTZweCcsXG4gICAgdHJhbnNpdGlvbjogJ2FsbCAyMDBtcyBlYXNlJyxcbiAgICB3aWR0aDogJzEwMCUnLFxuICAgIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxuICAgIGJvcmRlcjogJ25vbmUnLFxuICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgICAnOmhvdmVyJzoge1xuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXG4gICAgfSxcbiAgfSlcbik7XG5cbmNvbnN0IEl0ZW1Db250YWluZXIgPSBzdHlsZWQuZGl2PHtcbiAgaXNPcGVuPzogYm9vbGVhbjtcbiAgaGVpZ2h0Pzogc3RyaW5nO1xuICBtYXhIZWlnaHQ/OiBzdHJpbmc7XG4gIGZvbnRTaXplPzogc3RyaW5nO1xufT4oKHsgdGhlbWUsIGlzT3BlbiwgaGVpZ2h0LCBmb250U2l6ZSwgbWF4SGVpZ2h0IH0pID0+ICh7XG4gIGRpc3BsYXk6IGlzT3BlbiA/ICdibG9jaycgOiAnbm9uZScsXG4gIGJvcmRlclJhZGl1czogdGhlbWUuYm9yZGVyUmFkaXVzLmJhc2UsXG4gIGZvbnRTaXplOiBmb250U2l6ZSxcbiAgcGFkZGluZ0xlZnQ6ICc2cHgnLFxuICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gIGJveFNoYWRvdzogJzAgMXB4IDAgcmdiYSgwLCAwLCAwLCAwLjA2KScsXG4gIG1hcmdpblRvcDogJzRweCcsXG4gIGhlaWdodDogaGVpZ2h0LFxuICBtYXhIZWlnaHQ6IG1heEhlaWdodCxcbiAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICB0b3A6ICcxMDAlJyxcbiAgd2lkdGg6ICcxMDAlJyxcbiAgekluZGV4OiAnMTAwMCcsXG59KSk7XG5cbmNvbnN0IEl0ZW0gPSBzdHlsZWQuZGl2PHsgc2VsZWN0ZWQ6IGJvb2xlYW4gfT4oKHsgdGhlbWUsIHNlbGVjdGVkIH0pID0+ICh7XG4gIGRpc3BsYXk6ICdibG9jaycsXG4gIGN1cnNvcjogJ3BvaW50ZXInLFxuICBwYWRkaW5nOiAnOHB4IDEwcHgnLFxuICBjb2xvcjogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50UHJpbWFyeSxcbiAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnlCbHVlSG92ZXIsXG4gIH0sXG4gIGZvbnRXZWlnaHQ6IHNlbGVjdGVkID8gNjAwIDogNDAwLFxufSkpO1xuXG5jb25zdCBBcnJvd1N2ZyA9IHN0eWxlZChTdmdJY29uKSgoeyB0aGVtZSB9KSA9PiAoe1xuICBtYXJnaW5SaWdodDogJzE2cHgnLFxuICBwYXRoOiB7XG4gICAgZmlsbDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50UHJpbWFyeSxcbiAgfSxcbn0pKTtcblxuY29uc3QgQ3VzdG9tSWNvbiA9IHN0eWxlZC5kaXY8eyBpbkxvb3A/OiBib29sZWFuIH0+KCh7IGluTG9vcCB9KSA9PiAoe1xuICBtYXJnaW46IGluTG9vcCA/ICcwIDEycHggMCAwJyA6ICcwIDAgMCAxNnB4JyxcbiAgZGlzcGxheTogJ2lubGluZScsXG4gIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICBib3R0b206IGluTG9vcCA/ICcwJyA6ICcxcHgnLFxufSkpO1xuXG5pbnRlcmZhY2UgSXRlbSB7XG4gIHZhbHVlOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGljb24/OiBSZWFjdC5SZWFjdEVsZW1lbnQgfCBudWxsO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaGFibGVEcm9wZG93blByb3BzIHtcbiAgaXRlbXM6IEl0ZW1bXTtcbiAgdmFsdWU6IEl0ZW07XG4gIG9uU2VsZWN0OiAoZGF0YTogYW55KSA9PiB2b2lkO1xuICBoZWlnaHQ/OiBzdHJpbmc7XG4gIG1heEhlaWdodD86IHN0cmluZztcbiAgZm9udFNpemU/OiBzdHJpbmc7XG4gIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgU2VhcmNoYWJsZURyb3Bkb3duID0gKHtcbiAgaXRlbXMsXG4gIHZhbHVlLFxuICBoZWlnaHQsXG4gIGZvbnRTaXplLFxuICBtYXhIZWlnaHQsXG4gIG9uU2VsZWN0LFxuICBwbGFjZWhvbGRlcixcbn06IFNlYXJjaGFibGVEcm9wZG93blByb3BzKSA9PiB7XG4gIGNvbnN0IFtxdWVyeSwgc2V0UXVlcnldID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbaXNPcGVuLCBzZXRJc09wZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbaWNvbiwgc2V0SWNvbl0gPSB1c2VTdGF0ZTxSZWFjdC5SZWFjdEVsZW1lbnQgfCBudWxsPihudWxsKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHZhbHVlLmljb24gJiYgc2V0SWNvbih2YWx1ZS5pY29uKTtcbiAgfSwgW3ZhbHVlXSk7XG5cbiAgY29uc3QgaW5wdXRSZWYgPSB1c2VSZWYobnVsbCk7XG5cbiAgY29uc3QgeyByZWYgfSA9IHVzZUNsaWNrQXdheSh7XG4gICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgIHNldElzT3BlbihmYWxzZSk7XG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qgc2VsZWN0T3B0aW9uID0gKG9wdGlvbikgPT4ge1xuICAgIHNldFF1ZXJ5KCgpID0+ICcnKTtcbiAgICBvblNlbGVjdChvcHRpb24pO1xuXG4gICAgc2V0SXNPcGVuKChpc09wZW4pID0+ICFpc09wZW4pO1xuICAgIHNldEljb24ob3B0aW9uLmljb24pO1xuICB9O1xuXG4gIGNvbnN0IHRvZ2dsZSA9IChlKSA9PiB7XG4gICAgc2V0SXNPcGVuKGUgJiYgZS50YXJnZXQgPT09IGlucHV0UmVmLmN1cnJlbnQpO1xuICB9O1xuXG4gIGNvbnN0IGdldERpc3BsYXlWYWx1ZSA9ICgpID0+IHtcbiAgICBpZiAocXVlcnkpIHJldHVybiBxdWVyeTtcbiAgICBpZiAodmFsdWUpIHJldHVybiB2YWx1ZS5sYWJlbDtcblxuICAgIHJldHVybiAnJztcbiAgfTtcblxuICBjb25zdCBmaWx0ZXJPcHRpb25zV2l0aFNlYXJjaGVkVmFsdWUgPSAob3B0aW9ucywgcXVlcnkpID0+IHtcbiAgICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoXG4gICAgICAob3B0aW9uKSA9PiBvcHRpb24ubGFiZWwudG9Mb3dlckNhc2UoKS5pbmRleE9mKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpID4gLTFcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IHNlYXJjaGVkT3B0aW9ucyA9IGZpbHRlck9wdGlvbnNXaXRoU2VhcmNoZWRWYWx1ZShpdGVtcywgcXVlcnkpO1xuXG4gIHJldHVybiAoXG4gICAgPFN0eWxlZERyb3Bkb3duIHJlZj17cmVmfT5cbiAgICAgIDxGbGV4Um93IGFsaWduPVwiY2VudGVyXCIganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIj5cbiAgICAgICAge2ljb24gJiYgPEN1c3RvbUljb24+e2ljb259PC9DdXN0b21JY29uPn1cbiAgICAgICAgPFN0eWxlZElucHV0XG4gICAgICAgICAgcmVmPXtpbnB1dFJlZn1cbiAgICAgICAgICBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9XG4gICAgICAgICAgdmFsdWU9e2dldERpc3BsYXlWYWx1ZSgpfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgc2V0UXVlcnkoZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgb25TZWxlY3Qoe30pO1xuICAgICAgICAgIH19XG4gICAgICAgICAgb25DbGljaz17dG9nZ2xlfVxuICAgICAgICAgIGZvbnRTaXplPXtmb250U2l6ZX1cbiAgICAgICAgICBpY29uPXtCb29sZWFuKGljb24pfVxuICAgICAgICAvPlxuICAgICAgICA8QXJyb3dTdmcgc3JjPXtpc09wZW4gPyBVcEljb24gOiBEb3duSWNvbn0gLz5cbiAgICAgIDwvRmxleFJvdz5cblxuICAgICAgPEl0ZW1Db250YWluZXJcbiAgICAgICAgaXNPcGVuPXtpc09wZW59XG4gICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICBmb250U2l6ZT17Zm9udFNpemV9XG4gICAgICAgIG1heEhlaWdodD17bWF4SGVpZ2h0fVxuICAgICAgPlxuICAgICAgICB7c2VhcmNoZWRPcHRpb25zLm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEl0ZW1cbiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2VsZWN0T3B0aW9uKGl0ZW0pfVxuICAgICAgICAgICAgICBzZWxlY3RlZD17aXRlbS52YWx1ZSA9PT0gdmFsdWUudmFsdWV9XG4gICAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtpdGVtLmljb24gJiYgPEN1c3RvbUljb24gaW5Mb29wPntpdGVtLmljb259PC9DdXN0b21JY29uPn1cbiAgICAgICAgICAgICAge2l0ZW0ubGFiZWx9XG4gICAgICAgICAgICA8L0l0ZW0+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSl9XG4gICAgICA8L0l0ZW1Db250YWluZXI+XG4gICAgPC9TdHlsZWREcm9wZG93bj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFNlYXJjaGFibGVEcm9wZG93bjtcbiJdfQ==