import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useRef, useState } from 'react';
import styled from 'styled-components';
import FlexRow from '../flex-row/flex-row';
import SvgIcon from '../svg-icon/svg-icon';
import UpIcon from '../../assets/icons/ic-arrow-up.svg';
import DownIcon from '../../assets/icons/ic-arrow-down.svg';
import { useClickAway } from '../../hooks/use-click-away';
var StyledDropdown = styled.div(function (_a) {
    var theme = _a.theme, disabled = _a.disabled;
    return (__assign(__assign({ outline: 'none', position: 'relative', borderRadius: theme.borderRadius.base }, (disabled && {
        opacity: '0.5',
        pointerEvents: 'none',
    })), { background: theme.styleguideColors.fillSecondary, ':hover, :active': {
            background: theme.styleguideColors.fillSecondary,
            svg: {
                path: {
                    fill: theme.styleguideColors.fillPrimaryRed,
                },
            },
        } }));
});
var StyledInput = styled.input(function (_a) {
    var theme = _a.theme, fontSize = _a.fontSize, icon = _a.icon;
    return ({
        lineHeight: '1.5',
        fontSize: fontSize,
        height: '36px',
        borderRadius: theme.borderRadius.base,
        outline: 'none',
        padding: icon ? '0 12px' : '0 16px',
        transition: 'all 200ms ease',
        width: '100%',
        color: theme.styleguideColors.contentPrimary,
        border: 'none',
        background: theme.styleguideColors.fillSecondary,
        ':hover': {
            cursor: 'pointer',
        },
    });
});
var ItemContainer = styled.div(function (_a) {
    var theme = _a.theme, isOpen = _a.isOpen, height = _a.height, fontSize = _a.fontSize, maxHeight = _a.maxHeight;
    return ({
        display: isOpen ? 'block' : 'none',
        borderRadius: theme.borderRadius.base,
        fontSize: fontSize,
        paddingLeft: '6px',
        background: theme.styleguideColors.fillSecondary,
        boxShadow: '0 1px 0 rgba(0, 0, 0, 0.06)',
        marginTop: '4px',
        height: height,
        maxHeight: maxHeight,
        overflowY: 'auto',
        position: 'absolute',
        top: '100%',
        width: '100%',
        zIndex: '1000',
    });
});
var Item = styled.div(function (_a) {
    var theme = _a.theme, selected = _a.selected;
    return ({
        display: 'block',
        cursor: 'pointer',
        padding: '8px 10px',
        color: theme.styleguideColors.contentPrimary,
        ':hover, :active': {
            background: theme.styleguideColors.fillSecondaryBlueHover,
        },
        fontWeight: selected ? 600 : 400,
    });
});
var ArrowSvg = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        marginRight: '16px',
        path: {
            fill: theme.styleguideColors.contentPrimary,
        },
    });
});
var CustomIcon = styled.div(function (_a) {
    var inLoop = _a.inLoop;
    return ({
        margin: inLoop ? '0 12px 0 0' : '0 0 0 16px',
        display: 'inline',
        position: 'relative',
        bottom: inLoop ? '0' : '1px',
    });
});
export var SearchableDropdown = function (_a) {
    var items = _a.items, value = _a.value, height = _a.height, fontSize = _a.fontSize, maxHeight = _a.maxHeight, onSelect = _a.onSelect, placeholder = _a.placeholder;
    var _b = useState(''), searchedValue = _b[0], setSearchedValue = _b[1];
    var _c = useState(false), isOpen = _c[0], setIsOpen = _c[1];
    var _d = useState(false), rotate = _d[0], setRotate = _d[1];
    var _e = useState(null), icon = _e[0], setIcon = _e[1];
    var inputRef = useRef(null);
    var ref = useClickAway({
        callback: function () {
            setIsOpen(false);
        },
    }).ref;
    useEffect(function () {
        value.icon && setIcon(value.icon);
    }, [value]);
    useEffect(function () {
        if (isOpen === rotate)
            return;
        setRotate(isOpen);
    }, [isOpen]);
    var selectOption = function (option) {
        setSearchedValue('');
        onSelect(option);
        setIsOpen(function (isOpen) { return !isOpen; });
        setIsOpen(!isOpen);
        setIcon(option.icon);
    };
    var handleOpenDropdown = function (e) {
        setIsOpen(true);
    };
    var getDisplayValue = function () {
        if (searchedValue)
            return searchedValue;
        if (value)
            return value.label;
        return '';
    };
    var filterOptionsWithSearchedValue = function (options, searchedValue) {
        return options.filter(function (option) {
            return option.label.toLowerCase().indexOf(searchedValue.toLowerCase()) > -1;
        });
    };
    var searchedItems = filterOptionsWithSearchedValue(items, searchedValue);
    return (_jsxs(StyledDropdown, __assign({ ref: ref }, { children: [_jsxs(FlexRow, __assign({ align: "center", justify: "space-between", onClick: handleOpenDropdown }, { children: [icon && _jsx(CustomIcon, { children: icon }), _jsx(StyledInput, { ref: inputRef, placeholder: placeholder, value: getDisplayValue(), onChange: function (e) {
                            setSearchedValue(e.target.value);
                            onSelect({});
                        }, fontSize: fontSize, icon: Boolean(icon) }), _jsx(ArrowSvg, { src: rotate ? UpIcon : DownIcon })] })), _jsx(ItemContainer, __assign({ isOpen: isOpen, height: height, fontSize: fontSize, maxHeight: maxHeight }, { children: searchedItems.map(function (item, index) {
                    return (_jsxs(Item, __assign({ onClick: function () { return selectOption(item); }, selected: item.value === value.value }, { children: [item.icon && _jsx(CustomIcon, __assign({ inLoop: true }, { children: item.icon })), item.label] }), index));
                }) }))] })));
};
export default SearchableDropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoYWJsZS1kcm9wZG93bi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9zZWFyY2hhYmxlLWRyb3Bkb3duL3NlYXJjaGFibGUtZHJvcGRvd24udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQzNELE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sTUFBTSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hELE9BQU8sUUFBUSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUUxRCxJQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUMvQixVQUFDLEVBQW1CO1FBQWpCLEtBQUssV0FBQSxFQUFFLFFBQVEsY0FBQTtJQUFPLE9BQUEscUJBQ3ZCLE9BQU8sRUFBRSxNQUFNLEVBQ2YsUUFBUSxFQUFFLFVBQVUsRUFDcEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUVsQyxDQUFDLFFBQVEsSUFBSTtRQUNkLE9BQU8sRUFBRSxLQUFLO1FBQ2QsYUFBYSxFQUFFLE1BQU07S0FDdEIsQ0FBQyxLQUVGLFVBQVUsRUFBRSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUNoRCxpQkFBaUIsRUFBRTtZQUNqQixVQUFVLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGFBQWE7WUFDaEQsR0FBRyxFQUFFO2dCQUNILElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGNBQWM7aUJBQzVDO2FBQ0Y7U0FDRixJQUNEO0FBbkJ1QixD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QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IEZsZXhSb3cgZnJvbSAnLi4vZmxleC1yb3cvZmxleC1yb3cnO1xuaW1wb3J0IFN2Z0ljb24gZnJvbSAnLi4vc3ZnLWljb24vc3ZnLWljb24nO1xuaW1wb3J0IFVwSWNvbiBmcm9tICcuLi8uLi9hc3NldHMvaWNvbnMvaWMtYXJyb3ctdXAuc3ZnJztcbmltcG9ydCBEb3duSWNvbiBmcm9tICcuLi8uLi9hc3NldHMvaWNvbnMvaWMtYXJyb3ctZG93bi5zdmcnO1xuaW1wb3J0IHsgdXNlQ2xpY2tBd2F5IH0gZnJvbSAnLi4vLi4vaG9va3MvdXNlLWNsaWNrLWF3YXknO1xuXG5jb25zdCBTdHlsZWREcm9wZG93biA9IHN0eWxlZC5kaXY8eyBkaXNhYmxlZD86IGJvb2xlYW4gfT4oXG4gICh7IHRoZW1lLCBkaXNhYmxlZCB9KSA9PiAoe1xuICAgIG91dGxpbmU6ICdub25lJyxcbiAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuXG4gICAgLi4uKGRpc2FibGVkICYmIHtcbiAgICAgIG9wYWNpdHk6ICcwLjUnLFxuICAgICAgcG9pbnRlckV2ZW50czogJ25vbmUnLFxuICAgIH0pLFxuXG4gICAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5LFxuICAgICc6aG92ZXIsIDphY3RpdmUnOiB7XG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgICBzdmc6IHtcbiAgICAgICAgcGF0aDoge1xuICAgICAgICAgIGZpbGw6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFByaW1hcnlSZWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4pO1xuXG5jb25zdCBTdHlsZWRJbnB1dCA9IHN0eWxlZC5pbnB1dDx7IGZvbnRTaXplPzogc3RyaW5nOyBpY29uPzogYm9vbGVhbiB9PihcbiAgKHsgdGhlbWUsIGZvbnRTaXplLCBpY29uIH0pID0+ICh7XG4gICAgbGluZUhlaWdodDogJzEuNScsXG4gICAgZm9udFNpemU6IGZvbnRTaXplLFxuICAgIGhlaWdodDogJzM2cHgnLFxuICAgIGJvcmRlclJhZGl1czogdGhlbWUuYm9yZGVyUmFkaXVzLmJhc2UsXG4gICAgb3V0bGluZTogJ25vbmUnLFxuICAgIHBhZGRpbmc6IGljb24gPyAnMCAxMnB4JyA6ICcwIDE2cHgnLFxuICAgIHRyYW5zaXRpb246ICdhbGwgMjAwbXMgZWFzZScsXG4gICAgd2lkdGg6ICcxMDAlJyxcbiAgICBjb2xvcjogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50UHJpbWFyeSxcbiAgICBib3JkZXI6ICdub25lJyxcbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgJzpob3Zlcic6IHtcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgIH0sXG4gIH0pXG4pO1xuXG5jb25zdCBJdGVtQ29udGFpbmVyID0gc3R5bGVkLmRpdjx7XG4gIGlzT3Blbj86IGJvb2xlYW47XG4gIGhlaWdodD86IHN0cmluZztcbiAgbWF4SGVpZ2h0Pzogc3RyaW5nO1xuICBmb250U2l6ZT86IHN0cmluZztcbn0+KCh7IHRoZW1lLCBpc09wZW4sIGhlaWdodCwgZm9udFNpemUsIG1heEhlaWdodCB9KSA9PiAoe1xuICBkaXNwbGF5OiBpc09wZW4gPyAnYmxvY2snIDogJ25vbmUnLFxuICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICBmb250U2l6ZTogZm9udFNpemUsXG4gIHBhZGRpbmdMZWZ0OiAnNnB4JyxcbiAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5LFxuICBib3hTaGFkb3c6ICcwIDFweCAwIHJnYmEoMCwgMCwgMCwgMC4wNiknLFxuICBtYXJnaW5Ub3A6ICc0cHgnLFxuICBoZWlnaHQ6IGhlaWdodCxcbiAgbWF4SGVpZ2h0OiBtYXhIZWlnaHQsXG4gIG92ZXJmbG93WTogJ2F1dG8nLFxuICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgdG9wOiAnMTAwJScsXG4gIHdpZHRoOiAnMTAwJScsXG4gIHpJbmRleDogJzEwMDAnLFxufSkpO1xuXG5jb25zdCBJdGVtID0gc3R5bGVkLmRpdjx7IHNlbGVjdGVkOiBib29sZWFuIH0+KCh7IHRoZW1lLCBzZWxlY3RlZCB9KSA9PiAoe1xuICBkaXNwbGF5OiAnYmxvY2snLFxuICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgcGFkZGluZzogJzhweCAxMHB4JyxcbiAgY29sb3I6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudFByaW1hcnksXG4gICc6aG92ZXIsIDphY3RpdmUnOiB7XG4gICAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5Qmx1ZUhvdmVyLFxuICB9LFxuICBmb250V2VpZ2h0OiBzZWxlY3RlZCA/IDYwMCA6IDQwMCxcbn0pKTtcblxuY29uc3QgQXJyb3dTdmcgPSBzdHlsZWQoU3ZnSWNvbikoKHsgdGhlbWUgfSkgPT4gKHtcbiAgbWFyZ2luUmlnaHQ6ICcxNnB4JyxcbiAgcGF0aDoge1xuICAgIGZpbGw6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudFByaW1hcnksXG4gIH0sXG59KSk7XG5cbmNvbnN0IEN1c3RvbUljb24gPSBzdHlsZWQuZGl2PHsgaW5Mb29wPzogYm9vbGVhbiB9PigoeyBpbkxvb3AgfSkgPT4gKHtcbiAgbWFyZ2luOiBpbkxvb3AgPyAnMCAxMnB4IDAgMCcgOiAnMCAwIDAgMTZweCcsXG4gIGRpc3BsYXk6ICdpbmxpbmUnLFxuICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgYm90dG9tOiBpbkxvb3AgPyAnMCcgOiAnMXB4Jyxcbn0pKTtcblxuaW50ZXJmYWNlIEl0ZW0ge1xuICB2YWx1ZTogc3RyaW5nO1xuICBsYWJlbDogc3RyaW5nO1xuICBpY29uPzogUmVhY3QuUmVhY3RFbGVtZW50IHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hhYmxlRHJvcGRvd25Qcm9wcyB7XG4gIGl0ZW1zOiBJdGVtW107XG4gIHZhbHVlOiBJdGVtO1xuICBvblNlbGVjdDogKGRhdGE6IGFueSkgPT4gdm9pZDtcbiAgaGVpZ2h0Pzogc3RyaW5nO1xuICBtYXhIZWlnaHQ/OiBzdHJpbmc7XG4gIGZvbnRTaXplPzogc3RyaW5nO1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IFNlYXJjaGFibGVEcm9wZG93biA9ICh7XG4gIGl0ZW1zLFxuICB2YWx1ZSxcbiAgaGVpZ2h0LFxuICBmb250U2l6ZSxcbiAgbWF4SGVpZ2h0LFxuICBvblNlbGVjdCxcbiAgcGxhY2Vob2xkZXIsXG59OiBTZWFyY2hhYmxlRHJvcGRvd25Qcm9wcykgPT4ge1xuICBjb25zdCBbc2VhcmNoZWRWYWx1ZSwgc2V0U2VhcmNoZWRWYWx1ZV0gPSB1c2VTdGF0ZSgnJyk7XG4gIGNvbnN0IFtpc09wZW4sIHNldElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtyb3RhdGUsIHNldFJvdGF0ZV0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtpY29uLCBzZXRJY29uXSA9IHVzZVN0YXRlPFJlYWN0LlJlYWN0RWxlbWVudCB8IG51bGw+KG51bGwpO1xuXG4gIGNvbnN0IGlucHV0UmVmID0gdXNlUmVmKG51bGwpO1xuXG4gIGNvbnN0IHsgcmVmIH0gPSB1c2VDbGlja0F3YXkoe1xuICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICBzZXRJc09wZW4oZmFsc2UpO1xuICAgIH0sXG4gIH0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgdmFsdWUuaWNvbiAmJiBzZXRJY29uKHZhbHVlLmljb24pO1xuICB9LCBbdmFsdWVdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChpc09wZW4gPT09IHJvdGF0ZSkgcmV0dXJuO1xuXG4gICAgc2V0Um90YXRlKGlzT3Blbik7XG4gIH0sIFtpc09wZW5dKTtcblxuICBjb25zdCBzZWxlY3RPcHRpb24gPSAob3B0aW9uKSA9PiB7XG4gICAgc2V0U2VhcmNoZWRWYWx1ZSgnJyk7XG4gICAgb25TZWxlY3Qob3B0aW9uKTtcblxuICAgIHNldElzT3BlbigoaXNPcGVuKSA9PiAhaXNPcGVuKTtcbiAgICBzZXRJc09wZW4oIWlzT3Blbik7XG4gICAgc2V0SWNvbihvcHRpb24uaWNvbik7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlT3BlbkRyb3Bkb3duID0gKGUpID0+IHtcbiAgICBzZXRJc09wZW4odHJ1ZSk7XG4gIH07XG5cbiAgY29uc3QgZ2V0RGlzcGxheVZhbHVlID0gKCkgPT4ge1xuICAgIGlmIChzZWFyY2hlZFZhbHVlKSByZXR1cm4gc2VhcmNoZWRWYWx1ZTtcbiAgICBpZiAodmFsdWUpIHJldHVybiB2YWx1ZS5sYWJlbDtcblxuICAgIHJldHVybiAnJztcbiAgfTtcblxuICBjb25zdCBmaWx0ZXJPcHRpb25zV2l0aFNlYXJjaGVkVmFsdWUgPSAob3B0aW9ucywgc2VhcmNoZWRWYWx1ZSkgPT4ge1xuICAgIHJldHVybiBvcHRpb25zLmZpbHRlcihcbiAgICAgIChvcHRpb24pID0+XG4gICAgICAgIG9wdGlvbi5sYWJlbC50b0xvd2VyQ2FzZSgpLmluZGV4T2Yoc2VhcmNoZWRWYWx1ZS50b0xvd2VyQ2FzZSgpKSA+IC0xXG4gICAgKTtcbiAgfTtcblxuICBjb25zdCBzZWFyY2hlZEl0ZW1zID0gZmlsdGVyT3B0aW9uc1dpdGhTZWFyY2hlZFZhbHVlKGl0ZW1zLCBzZWFyY2hlZFZhbHVlKTtcblxuICByZXR1cm4gKFxuICAgIDxTdHlsZWREcm9wZG93biByZWY9e3JlZn0+XG4gICAgICA8RmxleFJvd1xuICAgICAgICBhbGlnbj1cImNlbnRlclwiXG4gICAgICAgIGp1c3RpZnk9XCJzcGFjZS1iZXR3ZWVuXCJcbiAgICAgICAgb25DbGljaz17aGFuZGxlT3BlbkRyb3Bkb3dufVxuICAgICAgPlxuICAgICAgICB7aWNvbiAmJiA8Q3VzdG9tSWNvbj57aWNvbn08L0N1c3RvbUljb24+fVxuICAgICAgICA8U3R5bGVkSW5wdXRcbiAgICAgICAgICByZWY9e2lucHV0UmVmfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgICB2YWx1ZT17Z2V0RGlzcGxheVZhbHVlKCl9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICBzZXRTZWFyY2hlZFZhbHVlKGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICAgIG9uU2VsZWN0KHt9KTtcbiAgICAgICAgICB9fVxuICAgICAgICAgIGZvbnRTaXplPXtmb250U2l6ZX1cbiAgICAgICAgICBpY29uPXtCb29sZWFuKGljb24pfVxuICAgICAgICAvPlxuICAgICAgICA8QXJyb3dTdmcgc3JjPXtyb3RhdGUgPyBVcEljb24gOiBEb3duSWNvbn0gLz5cbiAgICAgIDwvRmxleFJvdz5cblxuICAgICAgPEl0ZW1Db250YWluZXJcbiAgICAgICAgaXNPcGVuPXtpc09wZW59XG4gICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICBmb250U2l6ZT17Zm9udFNpemV9XG4gICAgICAgIG1heEhlaWdodD17bWF4SGVpZ2h0fVxuICAgICAgPlxuICAgICAgICB7c2VhcmNoZWRJdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxJdGVtXG4gICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNlbGVjdE9wdGlvbihpdGVtKX1cbiAgICAgICAgICAgICAgc2VsZWN0ZWQ9e2l0ZW0udmFsdWUgPT09IHZhbHVlLnZhbHVlfVxuICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7aXRlbS5pY29uICYmIDxDdXN0b21JY29uIGluTG9vcD57aXRlbS5pY29ufTwvQ3VzdG9tSWNvbj59XG4gICAgICAgICAgICAgIHtpdGVtLmxhYmVsfVxuICAgICAgICAgICAgPC9JdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC9JdGVtQ29udGFpbmVyPlxuICAgIDwvU3R5bGVkRHJvcGRvd24+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTZWFyY2hhYmxlRHJvcGRvd247XG4iXX0=