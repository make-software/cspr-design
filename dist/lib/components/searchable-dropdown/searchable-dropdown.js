import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useRef, useState } from 'react';
import styled from 'styled-components';
import FlexRow from '../flex-row/flex-row';
import SvgIcon from '../svg-icon/svg-icon';
import UpIcon from '../../assets/icons/ic-arrow-up.svg';
import DownIcon from '../../assets/icons/ic-arrow-down.svg';
import { useClickAway } from '../../hooks/use-click-away';
var StyledDropdown = styled.div(function (_a) {
    var theme = _a.theme, disabled = _a.disabled;
    return (__assign(__assign({ outline: 'none', position: 'relative', borderRadius: theme.borderRadius.base }, (disabled && {
        opacity: '0.5',
        pointerEvents: 'none',
    })), { background: theme.styleguideColors.fillSecondary, ':hover, :active': {
            background: theme.styleguideColors.fillSecondary,
            svg: {
                path: {
                    fill: theme.styleguideColors.fillPrimaryRed,
                },
            },
        } }));
});
var StyledContentRow = styled(FlexRow)(function (_a) {
    var theme = _a.theme, error = _a.error;
    return theme.withMedia({
        width: '100%',
        border: error ? "1px solid ".concat(theme.styleguideColors.contentRed) : 'none',
    });
});
var StyledInput = styled.input(function (_a) {
    var theme = _a.theme, fontSize = _a.fontSize, icon = _a.icon;
    return ({
        lineHeight: '1.5',
        fontSize: fontSize,
        height: '36px',
        borderRadius: theme.borderRadius.base,
        outline: 'none',
        padding: icon ? '0 12px' : '0 16px',
        transition: 'all 200ms ease',
        width: '100%',
        color: theme.styleguideColors.contentPrimary,
        border: 'none',
        background: theme.styleguideColors.fillSecondary,
        ':hover': {
            cursor: 'pointer',
        },
    });
});
var ItemContainer = styled.div(function (_a) {
    var theme = _a.theme, isOpen = _a.isOpen, height = _a.height, fontSize = _a.fontSize, maxHeight = _a.maxHeight;
    return ({
        display: isOpen ? 'block' : 'none',
        borderRadius: theme.borderRadius.base,
        fontSize: fontSize,
        paddingLeft: '6px',
        background: theme.styleguideColors.fillSecondary,
        boxShadow: '0 1px 0 rgba(0, 0, 0, 0.06)',
        marginTop: '4px',
        height: height,
        maxHeight: maxHeight,
        overflowY: 'auto',
        position: 'absolute',
        top: '100%',
        width: '100%',
        zIndex: '1000',
    });
});
var Item = styled.div(function (_a) {
    var theme = _a.theme, selected = _a.selected;
    return ({
        display: 'block',
        cursor: 'pointer',
        padding: '8px 10px',
        color: theme.styleguideColors.contentPrimary,
        ':hover, :active': {
            background: theme.styleguideColors.fillSecondaryBlueHover,
        },
        fontWeight: selected ? 600 : 400,
    });
});
var ArrowSvg = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        marginRight: '16px',
        path: {
            fill: theme.styleguideColors.contentPrimary,
        },
    });
});
var CustomIcon = styled.div(function (_a) {
    var inLoop = _a.inLoop;
    return ({
        margin: inLoop ? '0 12px 0 0' : '0 0 0 16px',
        display: 'inline',
        position: 'relative',
        bottom: inLoop ? '0' : '1px',
    });
});
export var SearchableDropdown = function (_a) {
    var items = _a.items, value = _a.value, height = _a.height, isError = _a.isError, fontSize = _a.fontSize, maxHeight = _a.maxHeight, onSelect = _a.onSelect, placeholder = _a.placeholder;
    var _b = useState(''), searchedValue = _b[0], setSearchedValue = _b[1];
    var _c = useState(false), isOpen = _c[0], setIsOpen = _c[1];
    var _d = useState(false), rotate = _d[0], setRotate = _d[1];
    var _e = useState(null), icon = _e[0], setIcon = _e[1];
    var inputRef = useRef(null);
    var ref = useClickAway({
        callback: function () {
            setIsOpen(false);
        },
    }).ref;
    useEffect(function () {
        value.icon && setIcon(value.icon);
    }, [value]);
    useEffect(function () {
        if (isOpen === rotate)
            return;
        setRotate(isOpen);
    }, [isOpen]);
    var selectOption = function (option) {
        setSearchedValue('');
        onSelect(option);
        setIsOpen(function (isOpen) { return !isOpen; });
        setIsOpen(!isOpen);
        setIcon(option.icon);
    };
    var handleOpenDropdown = function (e) {
        setIsOpen(true);
    };
    var getDisplayValue = function () {
        if (searchedValue)
            return searchedValue;
        if (value)
            return value.label;
        return '';
    };
    var filterOptionsWithSearchedValue = function (options, searchedValue) {
        return options.filter(function (option) {
            return option.label.toLowerCase().indexOf(searchedValue.toLowerCase()) > -1;
        });
    };
    var searchedItems = filterOptionsWithSearchedValue(items, searchedValue);
    return (_jsxs(StyledDropdown, __assign({ ref: ref }, { children: [_jsx(FlexRow, __assign({ align: "center", justify: "space-between", onClick: handleOpenDropdown }, { children: _jsxs(StyledContentRow, __assign({ justify: 'space-around', align: 'center', error: isError }, { children: [icon && _jsx(CustomIcon, { children: icon }), _jsx(StyledInput, { ref: inputRef, placeholder: placeholder, value: getDisplayValue(), onChange: function (e) {
                                setSearchedValue(e.target.value);
                                onSelect({});
                            }, fontSize: fontSize, icon: Boolean(icon) }), _jsx(ArrowSvg, { src: rotate ? UpIcon : DownIcon })] })) })), _jsx(ItemContainer, __assign({ isOpen: isOpen, height: height, fontSize: fontSize, maxHeight: maxHeight }, { children: searchedItems.map(function (item, index) {
                    return (_jsxs(Item, __assign({ onClick: function () { return selectOption(item); }, selected: item.value === value.value }, { children: [item.icon && _jsx(CustomIcon, __assign({ inLoop: true }, { children: item.icon })), item.label] }), index));
                }) }))] })));
};
export default SearchableDropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoYWJsZS1kcm9wZG93bi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9zZWFyY2hhYmxlLWRyb3Bkb3duL3NlYXJjaGFibGUtZHJvcGRvd24udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQzNELE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sTUFBTSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hELE9BQU8sUUFBUSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUUxRCxJQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUMvQixVQUFDLEVBQW1CO1FBQWpCLEtBQUssV0FBQSxFQUFFLFFBQVEsY0FBQTtJQUFPLE9BQUEscUJBQ3ZCLE9BQU8sRUFBRSxNQUFNLEVBQ2YsUUFBUSxFQUFFLFVBQVUsRUFDcEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUVsQyxDQUFDLFFBQVEsSUFBSTtRQUNkLE9BQU8sRUFBRSxLQUFLO1FBQ2QsYUFBYSxFQUFFLE1BQU07S0FDdEIsQ0FBQyxLQUVGLFVBQVUsRUFBRSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUNoRCxpQkFBaUIsRUFBRTtZQUNqQixVQUFVLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGFBQWE7WUFDaEQsR0FBRyxFQUFFO2dCQUNILElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGNBQWM7aUJBQzVDO2FBQ0Y7U0FDRixJQUNEO0FBbkJ1QixD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LGFBQWEsQ0FBQyxHQUFHLENBQUMsVUFBQyxJQUFJLEVBQUUsS0FBSztvQkFDN0IsT0FBTyxDQUNMLE1BQUMsSUFBSSxhQUNILE9BQU8sRUFBRSxjQUFNLE9BQUEsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFsQixDQUFrQixFQUNqQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsS0FBSyxpQkFHbkMsSUFBSSxDQUFDLElBQUksSUFBSSxLQUFDLFVBQVUsYUFBQyxNQUFNLHNCQUFFLElBQUksQ0FBQyxJQUFJLElBQWMsRUFDeEQsSUFBSSxDQUFDLEtBQUssTUFITixLQUFLLENBSUwsQ0FDUixDQUFDO2dCQUNKLENBQUMsQ0FBQyxJQUNZLEtBQ0QsQ0FDbEIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGVBQWUsa0JBQWtCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgRmxleFJvdyBmcm9tICcuLi9mbGV4LXJvdy9mbGV4LXJvdyc7XG5pbXBvcnQgU3ZnSWNvbiBmcm9tICcuLi9zdmctaWNvbi9zdmctaWNvbic7XG5pbXBvcnQgVXBJY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1hcnJvdy11cC5zdmcnO1xuaW1wb3J0IERvd25JY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1hcnJvdy1kb3duLnN2Zyc7XG5pbXBvcnQgeyB1c2VDbGlja0F3YXkgfSBmcm9tICcuLi8uLi9ob29rcy91c2UtY2xpY2stYXdheSc7XG5cbmNvbnN0IFN0eWxlZERyb3Bkb3duID0gc3R5bGVkLmRpdjx7IGRpc2FibGVkPzogYm9vbGVhbiB9PihcbiAgKHsgdGhlbWUsIGRpc2FibGVkIH0pID0+ICh7XG4gICAgb3V0bGluZTogJ25vbmUnLFxuICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIGJvcmRlclJhZGl1czogdGhlbWUuYm9yZGVyUmFkaXVzLmJhc2UsXG5cbiAgICAuLi4oZGlzYWJsZWQgJiYge1xuICAgICAgb3BhY2l0eTogJzAuNScsXG4gICAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScsXG4gICAgfSksXG5cbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgICAgIHN2Zzoge1xuICAgICAgICBwYXRoOiB7XG4gICAgICAgICAgZmlsbDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsUHJpbWFyeVJlZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbik7XG5cbmNvbnN0IFN0eWxlZENvbnRlbnRSb3cgPSBzdHlsZWQoRmxleFJvdyk8eyBlcnJvcj86IGJvb2xlYW4gfT4oXG4gICh7IHRoZW1lLCBlcnJvciB9KSA9PlxuICAgIHRoZW1lLndpdGhNZWRpYSh7XG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgYm9yZGVyOiBlcnJvciA/IGAxcHggc29saWQgJHt0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRSZWR9YCA6ICdub25lJyxcbiAgICB9KVxuKTtcblxuY29uc3QgU3R5bGVkSW5wdXQgPSBzdHlsZWQuaW5wdXQ8eyBmb250U2l6ZT86IHN0cmluZzsgaWNvbj86IGJvb2xlYW4gfT4oXG4gICh7IHRoZW1lLCBmb250U2l6ZSwgaWNvbiB9KSA9PiAoe1xuICAgIGxpbmVIZWlnaHQ6ICcxLjUnLFxuICAgIGZvbnRTaXplOiBmb250U2l6ZSxcbiAgICBoZWlnaHQ6ICczNnB4JyxcbiAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICAgIG91dGxpbmU6ICdub25lJyxcbiAgICBwYWRkaW5nOiBpY29uID8gJzAgMTJweCcgOiAnMCAxNnB4JyxcbiAgICB0cmFuc2l0aW9uOiAnYWxsIDIwMG1zIGVhc2UnLFxuICAgIHdpZHRoOiAnMTAwJScsXG4gICAgY29sb3I6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudFByaW1hcnksXG4gICAgYm9yZGVyOiAnbm9uZScsXG4gICAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5LFxuICAgICc6aG92ZXInOiB7XG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICB9LFxuICB9KVxuKTtcblxuY29uc3QgSXRlbUNvbnRhaW5lciA9IHN0eWxlZC5kaXY8e1xuICBpc09wZW4/OiBib29sZWFuO1xuICBoZWlnaHQ/OiBzdHJpbmc7XG4gIG1heEhlaWdodD86IHN0cmluZztcbiAgZm9udFNpemU/OiBzdHJpbmc7XG59PigoeyB0aGVtZSwgaXNPcGVuLCBoZWlnaHQsIGZvbnRTaXplLCBtYXhIZWlnaHQgfSkgPT4gKHtcbiAgZGlzcGxheTogaXNPcGVuID8gJ2Jsb2NrJyA6ICdub25lJyxcbiAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgZm9udFNpemU6IGZvbnRTaXplLFxuICBwYWRkaW5nTGVmdDogJzZweCcsXG4gIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgYm94U2hhZG93OiAnMCAxcHggMCByZ2JhKDAsIDAsIDAsIDAuMDYpJyxcbiAgbWFyZ2luVG9wOiAnNHB4JyxcbiAgaGVpZ2h0OiBoZWlnaHQsXG4gIG1heEhlaWdodDogbWF4SGVpZ2h0LFxuICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gIHRvcDogJzEwMCUnLFxuICB3aWR0aDogJzEwMCUnLFxuICB6SW5kZXg6ICcxMDAwJyxcbn0pKTtcblxuY29uc3QgSXRlbSA9IHN0eWxlZC5kaXY8eyBzZWxlY3RlZDogYm9vbGVhbiB9PigoeyB0aGVtZSwgc2VsZWN0ZWQgfSkgPT4gKHtcbiAgZGlzcGxheTogJ2Jsb2NrJyxcbiAgY3Vyc29yOiAncG9pbnRlcicsXG4gIHBhZGRpbmc6ICc4cHggMTBweCcsXG4gIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxuICAnOmhvdmVyLCA6YWN0aXZlJzoge1xuICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeUJsdWVIb3ZlcixcbiAgfSxcbiAgZm9udFdlaWdodDogc2VsZWN0ZWQgPyA2MDAgOiA0MDAsXG59KSk7XG5cbmNvbnN0IEFycm93U3ZnID0gc3R5bGVkKFN2Z0ljb24pKCh7IHRoZW1lIH0pID0+ICh7XG4gIG1hcmdpblJpZ2h0OiAnMTZweCcsXG4gIHBhdGg6IHtcbiAgICBmaWxsOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxuICB9LFxufSkpO1xuXG5jb25zdCBDdXN0b21JY29uID0gc3R5bGVkLmRpdjx7IGluTG9vcD86IGJvb2xlYW4gfT4oKHsgaW5Mb29wIH0pID0+ICh7XG4gIG1hcmdpbjogaW5Mb29wID8gJzAgMTJweCAwIDAnIDogJzAgMCAwIDE2cHgnLFxuICBkaXNwbGF5OiAnaW5saW5lJyxcbiAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gIGJvdHRvbTogaW5Mb29wID8gJzAnIDogJzFweCcsXG59KSk7XG5cbmludGVyZmFjZSBJdGVtIHtcbiAgdmFsdWU6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgaWNvbj86IFJlYWN0LlJlYWN0RWxlbWVudCB8IG51bGw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoYWJsZURyb3Bkb3duUHJvcHMge1xuICBpdGVtczogSXRlbVtdO1xuICB2YWx1ZTogSXRlbTtcbiAgb25TZWxlY3Q6IChkYXRhOiBhbnkpID0+IHZvaWQ7XG4gIGhlaWdodD86IHN0cmluZztcbiAgbWF4SGVpZ2h0Pzogc3RyaW5nO1xuICBmb250U2l6ZT86IHN0cmluZztcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIGlzRXJyb3I/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgU2VhcmNoYWJsZURyb3Bkb3duID0gKHtcbiAgaXRlbXMsXG4gIHZhbHVlLFxuICBoZWlnaHQsXG4gIGlzRXJyb3IsXG4gIGZvbnRTaXplLFxuICBtYXhIZWlnaHQsXG4gIG9uU2VsZWN0LFxuICBwbGFjZWhvbGRlcixcbn06IFNlYXJjaGFibGVEcm9wZG93blByb3BzKSA9PiB7XG4gIGNvbnN0IFtzZWFyY2hlZFZhbHVlLCBzZXRTZWFyY2hlZFZhbHVlXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2lzT3Blbiwgc2V0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW3JvdGF0ZSwgc2V0Um90YXRlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2ljb24sIHNldEljb25dID0gdXNlU3RhdGU8UmVhY3QuUmVhY3RFbGVtZW50IHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3QgaW5wdXRSZWYgPSB1c2VSZWYobnVsbCk7XG5cbiAgY29uc3QgeyByZWYgfSA9IHVzZUNsaWNrQXdheSh7XG4gICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgIHNldElzT3BlbihmYWxzZSk7XG4gICAgfSxcbiAgfSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICB2YWx1ZS5pY29uICYmIHNldEljb24odmFsdWUuaWNvbik7XG4gIH0sIFt2YWx1ZV0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzT3BlbiA9PT0gcm90YXRlKSByZXR1cm47XG5cbiAgICBzZXRSb3RhdGUoaXNPcGVuKTtcbiAgfSwgW2lzT3Blbl0pO1xuXG4gIGNvbnN0IHNlbGVjdE9wdGlvbiA9IChvcHRpb24pID0+IHtcbiAgICBzZXRTZWFyY2hlZFZhbHVlKCcnKTtcbiAgICBvblNlbGVjdChvcHRpb24pO1xuXG4gICAgc2V0SXNPcGVuKChpc09wZW4pID0+ICFpc09wZW4pO1xuICAgIHNldElzT3BlbighaXNPcGVuKTtcbiAgICBzZXRJY29uKG9wdGlvbi5pY29uKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVPcGVuRHJvcGRvd24gPSAoZSkgPT4ge1xuICAgIHNldElzT3Blbih0cnVlKTtcbiAgfTtcblxuICBjb25zdCBnZXREaXNwbGF5VmFsdWUgPSAoKSA9PiB7XG4gICAgaWYgKHNlYXJjaGVkVmFsdWUpIHJldHVybiBzZWFyY2hlZFZhbHVlO1xuICAgIGlmICh2YWx1ZSkgcmV0dXJuIHZhbHVlLmxhYmVsO1xuXG4gICAgcmV0dXJuICcnO1xuICB9O1xuXG4gIGNvbnN0IGZpbHRlck9wdGlvbnNXaXRoU2VhcmNoZWRWYWx1ZSA9IChvcHRpb25zLCBzZWFyY2hlZFZhbHVlKSA9PiB7XG4gICAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKFxuICAgICAgKG9wdGlvbikgPT5cbiAgICAgICAgb3B0aW9uLmxhYmVsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hlZFZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTFcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IHNlYXJjaGVkSXRlbXMgPSBmaWx0ZXJPcHRpb25zV2l0aFNlYXJjaGVkVmFsdWUoaXRlbXMsIHNlYXJjaGVkVmFsdWUpO1xuXG4gIHJldHVybiAoXG4gICAgPFN0eWxlZERyb3Bkb3duIHJlZj17cmVmfT5cbiAgICAgIDxGbGV4Um93XG4gICAgICAgIGFsaWduPVwiY2VudGVyXCJcbiAgICAgICAganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIlxuICAgICAgICBvbkNsaWNrPXtoYW5kbGVPcGVuRHJvcGRvd259XG4gICAgICA+XG4gICAgICAgIDxTdHlsZWRDb250ZW50Um93XG4gICAgICAgICAganVzdGlmeT17J3NwYWNlLWFyb3VuZCd9XG4gICAgICAgICAgYWxpZ249eydjZW50ZXInfVxuICAgICAgICAgIGVycm9yPXtpc0Vycm9yfVxuICAgICAgICA+XG4gICAgICAgICAge2ljb24gJiYgPEN1c3RvbUljb24+e2ljb259PC9DdXN0b21JY29uPn1cbiAgICAgICAgICA8U3R5bGVkSW5wdXRcbiAgICAgICAgICAgIHJlZj17aW5wdXRSZWZ9XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9XG4gICAgICAgICAgICB2YWx1ZT17Z2V0RGlzcGxheVZhbHVlKCl9XG4gICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHtcbiAgICAgICAgICAgICAgc2V0U2VhcmNoZWRWYWx1ZShlLnRhcmdldC52YWx1ZSk7XG4gICAgICAgICAgICAgIG9uU2VsZWN0KHt9KTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBmb250U2l6ZT17Zm9udFNpemV9XG4gICAgICAgICAgICBpY29uPXtCb29sZWFuKGljb24pfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEFycm93U3ZnIHNyYz17cm90YXRlID8gVXBJY29uIDogRG93bkljb259IC8+XG4gICAgICAgIDwvU3R5bGVkQ29udGVudFJvdz5cbiAgICAgIDwvRmxleFJvdz5cblxuICAgICAgPEl0ZW1Db250YWluZXJcbiAgICAgICAgaXNPcGVuPXtpc09wZW59XG4gICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICBmb250U2l6ZT17Zm9udFNpemV9XG4gICAgICAgIG1heEhlaWdodD17bWF4SGVpZ2h0fVxuICAgICAgPlxuICAgICAgICB7c2VhcmNoZWRJdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxJdGVtXG4gICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNlbGVjdE9wdGlvbihpdGVtKX1cbiAgICAgICAgICAgICAgc2VsZWN0ZWQ9e2l0ZW0udmFsdWUgPT09IHZhbHVlLnZhbHVlfVxuICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7aXRlbS5pY29uICYmIDxDdXN0b21JY29uIGluTG9vcD57aXRlbS5pY29ufTwvQ3VzdG9tSWNvbj59XG4gICAgICAgICAgICAgIHtpdGVtLmxhYmVsfVxuICAgICAgICAgICAgPC9JdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC9JdGVtQ29udGFpbmVyPlxuICAgIDwvU3R5bGVkRHJvcGRvd24+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTZWFyY2hhYmxlRHJvcGRvd247XG4iXX0=