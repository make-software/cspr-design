import { jsx as _jsx } from "react/jsx-runtime";
import React from 'react';
import styled from 'styled-components';
import SvgIcon from '../svg-icon/svg-icon';
import { getImageProxyUrl } from '../../utils/cache-asset';
import Identicon from '../identicon/identicon.tsx';
import { HashIcon } from '../../icons-index.ts';
import Skeleton from 'react-loading-skeleton';
export const isValidAccountHash = (accountHash) => {
    if (accountHash == null) {
        return false;
    }
    const validHashRegExp = new RegExp('^([0-9A-Fa-f]){64}$');
    return validHashRegExp.test(accountHash.trim());
};
const getCornerRadius = (size = 'default') => {
    const cornerRadiusMap = {
        tiny: 2,
        small: 2,
        default: 2,
        average: 4,
        medium: 12,
        big: 12,
    };
    return cornerRadiusMap[size] || cornerRadiusMap.default;
};
const getSize = (size = 'default') => {
    const sizeMap = {
        tiny: 16,
        small: 20,
        average: 28,
        default: 32,
        medium: 80,
        big: 124,
    };
    return sizeMap[size] || sizeMap.default;
};
const getBgColor = (size = 'default') => {
    const bgColorMap = {
        tiny: 'contentTertiary',
        small: 'contentTertiary',
        default: 'contentQuaternary',
        average: 'contentQuaternary',
        medium: 'contentQuaternary',
        big: 'contentQuaternary',
    };
    return bgColorMap[size] || bgColorMap.default;
};
const getMargin = (size = 'default') => {
    const marginMap = {
        tiny: 0,
        small: 0,
        default: 4,
        average: 4,
        medium: 4,
        big: 0,
    };
    return marginMap[size] || marginMap.default;
};
export const BackgroundWrapper = styled.div(({ theme, sizeType, withBgColor = false }) => ({
    borderRadius: getCornerRadius(sizeType),
    height: getSize(sizeType),
    width: getSize(sizeType),
    padding: 0,
    margin: getMargin(sizeType),
    backgroundColor: withBgColor
        ? theme.styleguideColors[getBgColor(sizeType)]
        : 'transparent',
    '& > canvas': {
        borderRadius: getCornerRadius(sizeType),
    },
}));
const IconHashWrapper = styled.div(({ theme }) => ({
    color: theme.styleguideColors.contentOnFill,
    height: '100%',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
}));
export const Avatar = React.forwardRef(function Avatar(props, ref) {
    const { loading, hash, src, size = 'default', transparentBg = false, ...restProps } = props;
    const avatarSize = getSize(size);
    const RETINA_SCALE = 2;
    const CACHE_TTL = '86400';
    if (loading || (!hash && !src)) {
        return (_jsx("div", { ...restProps, children: _jsx(Skeleton, { style: {
                    borderRadius: 2,
                    width: avatarSize,
                    fontSize: `${avatarSize}px`,
                    margin: getMargin(size),
                } }) }));
    }
    if (src) {
        const cachedUrl = getImageProxyUrl(src, {
            ttl: CACHE_TTL,
            width: avatarSize * RETINA_SCALE,
        });
        return (_jsx("span", { ref: ref, ...restProps, children: _jsx(BackgroundWrapper, { sizeType: size, style: {
                    background: `url("${cachedUrl}") center / contain no-repeat`,
                }, children: _jsx("div", { style: { width: avatarSize, height: avatarSize } }) }) }));
    }
    if (hash && isValidAccountHash(hash)) {
        return (_jsx("span", { ref: ref, ...restProps, children: _jsx(BackgroundWrapper, { sizeType: size, withBgColor: !transparentBg, children: _jsx(IconHashWrapper, { children: _jsx(SvgIcon, { src: HashIcon, size: avatarSize - 8 }) }) }) }));
    }
    return (_jsx("span", { ref: ref, ...restProps, children: _jsx(BackgroundWrapper, { sizeType: size, children: hash && (_jsx(Identicon, { hexString: hash, size: avatarSize, ...restProps })) }) }));
});
Avatar.displayName = 'Avatar';
export default Avatar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZhdGFyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2F2YXRhci9hdmF0YXIudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxNQUFNLE1BQU0sbUJBQW1CLENBQUM7QUFDdkMsT0FBTyxPQUFPLE1BQU0sc0JBQXNCLENBQUM7QUFDM0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDM0QsT0FBTyxTQUFTLE1BQU0sNEJBQTRCLENBQUM7QUFDbkQsT0FBTyxFQUFtQixRQUFRLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNqRSxPQUFPLFFBQVEsTUFBTSx3QkFBd0IsQ0FBQztBQUU5QyxNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxDQUNoQyxXQUEyQixFQUNKLEVBQUU7SUFDekIsSUFBSSxXQUFXLElBQUksSUFBSSxFQUFFLENBQUM7UUFDeEIsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsTUFBTSxlQUFlLEdBQUcsSUFBSSxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUMxRCxPQUFPLGVBQWUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFDbEQsQ0FBQyxDQUFDO0FBV0YsTUFBTSxlQUFlLEdBQUcsQ0FBQyxPQUFlLFNBQVMsRUFBRSxFQUFFO0lBQ25ELE1BQU0sZUFBZSxHQUEyQjtRQUM5QyxJQUFJLEVBQUUsQ0FBQztRQUNQLEtBQUssRUFBRSxDQUFDO1FBQ1IsT0FBTyxFQUFFLENBQUM7UUFDVixPQUFPLEVBQUUsQ0FBQztRQUNWLE1BQU0sRUFBRSxFQUFFO1FBQ1YsR0FBRyxFQUFFLEVBQUU7S0FDUixDQUFDO0lBRUYsT0FBTyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksZUFBZSxDQUFDLE9BQU8sQ0FBQztBQUMxRCxDQUFD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SSxFQUFFLFVBQVUsR0FBRyxDQUFDLEdBQUksR0FDaEMsR0FDQSxHQUNmLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRCxPQUFPLENBQ0wsZUFBTSxHQUFHLEVBQUUsR0FBRyxLQUFNLFNBQVMsWUFDM0IsS0FBQyxpQkFBaUIsSUFBQyxRQUFRLEVBQUUsSUFBSSxZQUM5QixJQUFJLElBQUksQ0FDUCxLQUFDLFNBQVMsSUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxVQUFVLEtBQU0sU0FBUyxHQUFJLENBQ2hFLEdBQ2lCLEdBQ2YsQ0FDUixDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQztBQUU5QixlQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBTdmdJY29uIGZyb20gJy4uL3N2Zy1pY29uL3N2Zy1pY29uJztcbmltcG9ydCB7IGdldEltYWdlUHJveHlVcmwgfSBmcm9tICcuLi8uLi91dGlscy9jYWNoZS1hc3NldCc7XG5pbXBvcnQgSWRlbnRpY29uIGZyb20gJy4uL2lkZW50aWNvbi9pZGVudGljb24udHN4JztcbmltcG9ydCB7IEVyYzIwQXZhdGFySWNvbiwgSGFzaEljb24gfSBmcm9tICcuLi8uLi9pY29ucy1pbmRleC50cyc7XG5pbXBvcnQgU2tlbGV0b24gZnJvbSAncmVhY3QtbG9hZGluZy1za2VsZXRvbic7XG5cbmV4cG9ydCBjb25zdCBpc1ZhbGlkQWNjb3VudEhhc2ggPSAoXG4gIGFjY291bnRIYXNoPzogc3RyaW5nIHwgbnVsbCxcbik6IGFjY291bnRIYXNoIGlzIHN0cmluZyA9PiB7XG4gIGlmIChhY2NvdW50SGFzaCA9PSBudWxsKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgdmFsaWRIYXNoUmVnRXhwID0gbmV3IFJlZ0V4cCgnXihbMC05QS1GYS1mXSl7NjR9JCcpO1xuICByZXR1cm4gdmFsaWRIYXNoUmVnRXhwLnRlc3QoYWNjb3VudEhhc2gudHJpbSgpKTtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXZhdGFyUHJvcHM8VCA9IGFueT4ge1xuICBoYXNoPzogc3RyaW5nIHwgbnVsbDtcbiAgc3JjPzogc3RyaW5nIHwgbnVsbDtcbiAgc2l6ZT86ICdkZWZhdWx0JyB8ICdiaWcnIHwgJ2F2ZXJhZ2UnIHwgJ21lZGl1bScgfCAnc21hbGwnIHwgJ3RpbnknO1xuICBsb2FkaW5nPzogYm9vbGVhbjtcbiAgdHJhbnNwYXJlbnRCZz86IGJvb2xlYW47XG4gIFtrZXk6IHN0cmluZ106IGFueTtcbn1cblxuY29uc3QgZ2V0Q29ybmVyUmFkaXVzID0gKHNpemU6IHN0cmluZyA9ICdkZWZhdWx0JykgPT4ge1xuICBjb25zdCBjb3JuZXJSYWRpdXNNYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgdGlueTogMixcbiAgICBzbWFsbDogMixcbiAgICBkZWZhdWx0OiAyLFxuICAgIGF2ZXJhZ2U6IDQsXG4gICAgbWVkaXVtOiAxMixcbiAgICBiaWc6IDEyLFxuICB9O1xuXG4gIHJldHVybiBjb3JuZXJSYWRpdXNNYXBbc2l6ZV0gfHwgY29ybmVyUmFkaXVzTWFwLmRlZmF1bHQ7XG59O1xuXG5jb25zdCBnZXRTaXplID0gKHNpemU6IHN0cmluZyA9ICdkZWZhdWx0Jyk6IG51bWJlciA9PiB7XG4gIGNvbnN0IHNpemVNYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgdGlueTogMTYsXG4gICAgc21hbGw6IDIwLFxuICAgIGF2ZXJhZ2U6IDI4LFxuICAgIGRlZmF1bHQ6IDMyLFxuICAgIG1lZGl1bTogODAsXG4gICAgYmlnOiAxMjQsXG4gIH07XG5cbiAgcmV0dXJuIHNpemVNYXBbc2l6ZV0gfHwgc2l6ZU1hcC5kZWZhdWx0O1xufTtcblxuY29uc3QgZ2V0QmdDb2xvciA9IChzaXplOiBzdHJpbmcgPSAnZGVmYXVsdCcpID0+IHtcbiAgY29uc3QgYmdDb2xvck1hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICB0aW55OiAnY29udGVudFRlcnRpYXJ5JyxcbiAgICBzbWFsbDogJ2NvbnRlbnRUZXJ0aWFyeScsXG4gICAgZGVmYXVsdDogJ2NvbnRlbnRRdWF0ZXJuYXJ5JyxcbiAgICBhdmVyYWdlOiAnY29udGVudFF1YXRlcm5hcnknLFxuICAgIG1lZGl1bTogJ2NvbnRlbnRRdWF0ZXJuYXJ5JyxcbiAgICBiaWc6ICdjb250ZW50UXVhdGVybmFyeScsXG4gIH07XG5cbiAgcmV0dXJuIGJnQ29sb3JNYXBbc2l6ZV0gfHwgYmdDb2xvck1hcC5kZWZhdWx0O1xufTtcblxuY29uc3QgZ2V0TWFyZ2luID0gKHNpemU6IHN0cmluZyA9ICdkZWZhdWx0JykgPT4ge1xuICBjb25zdCBtYXJnaW5NYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgdGlueTogMCxcbiAgICBzbWFsbDogMCxcbiAgICBkZWZhdWx0OiA0LFxuICAgIGF2ZXJhZ2U6IDQsXG4gICAgbWVkaXVtOiA0LFxuICAgIGJpZzogMCxcbiAgfTtcblxuICByZXR1cm4gbWFyZ2luTWFwW3NpemVdIHx8IG1hcmdpbk1hcC5kZWZhdWx0O1xufTtcblxuZXhwb3J0IGNvbnN0IEJhY2tncm91bmRXcmFwcGVyID0gc3R5bGVkLmRpdjx7XG4gIHNpemVUeXBlOiBzdHJpbmc7XG4gIHdpdGhCZ0NvbG9yPzogYm9vbGVhbjtcbn0+KCh7IHRoZW1lLCBzaXplVHlwZSwgd2l0aEJnQ29sb3IgPSBmYWxzZSB9KSA9PiAoe1xuICBib3JkZXJSYWRpdXM6IGdldENvcm5lclJhZGl1cyhzaXplVHlwZSksXG4gIGhlaWdodDogZ2V0U2l6ZShzaXplVHlwZSksXG4gIHdpZHRoOiBnZXRTaXplKHNpemVUeXBlKSxcbiAgcGFkZGluZzogMCxcbiAgbWFyZ2luOiBnZXRNYXJnaW4oc2l6ZVR5cGUpLFxuICBiYWNrZ3JvdW5kQ29sb3I6IHdpdGhCZ0NvbG9yXG4gICAgPyB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzW2dldEJnQ29sb3Ioc2l6ZVR5cGUpXVxuICAgIDogJ3RyYW5zcGFyZW50JyxcbiAgJyYgPiBjYW52YXMnOiB7XG4gICAgYm9yZGVyUmFkaXVzOiBnZXRDb3JuZXJSYWRpdXMoc2l6ZVR5cGUpLFxuICB9LFxufSkpO1xuXG5jb25zdCBJY29uSGFzaFdyYXBwZXIgPSBzdHlsZWQuZGl2KCh7IHRoZW1lIH0pID0+ICh7XG4gIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRPbkZpbGwsXG4gIGhlaWdodDogJzEwMCUnLFxuICBkaXNwbGF5OiAnZmxleCcsXG4gIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJyxcbiAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG59KSk7XG5cbnR5cGUgUmVmID0gSFRNTFNwYW5FbGVtZW50O1xuXG5leHBvcnQgY29uc3QgQXZhdGFyID0gUmVhY3QuZm9yd2FyZFJlZjxSZWYsIEF2YXRhclByb3BzPihmdW5jdGlvbiBBdmF0YXIoXG4gIHByb3BzOiBBdmF0YXJQcm9wcyxcbiAgcmVmLFxuKSB7XG4gIGNvbnN0IHtcbiAgICBsb2FkaW5nLFxuICAgIGhhc2gsXG4gICAgc3JjLFxuICAgIHNpemUgPSAnZGVmYXVsdCcsXG4gICAgdHJhbnNwYXJlbnRCZyA9IGZhbHNlLFxuICAgIC4uLnJlc3RQcm9wc1xuICB9ID0gcHJvcHM7XG4gIGNvbnN0IGF2YXRhclNpemUgPSBnZXRTaXplKHNpemUpO1xuXG4gIGNvbnN0IFJFVElOQV9TQ0FMRSA9IDI7XG4gIGNvbnN0IENBQ0hFX1RUTCA9ICc4NjQwMCc7XG5cbiAgaWYgKGxvYWRpbmcgfHwgKCFoYXNoICYmICFzcmMpKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgey4uLnJlc3RQcm9wc30+XG4gICAgICAgIDxTa2VsZXRvblxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICBib3JkZXJSYWRpdXM6IDIsXG4gICAgICAgICAgICB3aWR0aDogYXZhdGFyU2l6ZSxcbiAgICAgICAgICAgIGZvbnRTaXplOiBgJHthdmF0YXJTaXplfXB4YCxcbiAgICAgICAgICAgIG1hcmdpbjogZ2V0TWFyZ2luKHNpemUpLFxuICAgICAgICAgIH19XG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgaWYgKHNyYykge1xuICAgIGNvbnN0IGNhY2hlZFVybCA9IGdldEltYWdlUHJveHlVcmwoc3JjLCB7XG4gICAgICB0dGw6IENBQ0hFX1RUTCxcbiAgICAgIHdpZHRoOiBhdmF0YXJTaXplICogUkVUSU5BX1NDQUxFLFxuICAgIH0pO1xuICAgIHJldHVybiAoXG4gICAgICA8c3BhbiByZWY9e3JlZn0gey4uLnJlc3RQcm9wc30+XG4gICAgICAgIDxCYWNrZ3JvdW5kV3JhcHBlclxuICAgICAgICAgIHNpemVUeXBlPXtzaXplfVxuICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiBgdXJsKFwiJHtjYWNoZWRVcmx9XCIpIGNlbnRlciAvIGNvbnRhaW4gbm8tcmVwZWF0YCxcbiAgICAgICAgICB9fVxuICAgICAgICA+XG4gICAgICAgICAgPGRpdiBzdHlsZT17eyB3aWR0aDogYXZhdGFyU2l6ZSwgaGVpZ2h0OiBhdmF0YXJTaXplIH19IC8+XG4gICAgICAgIDwvQmFja2dyb3VuZFdyYXBwZXI+XG4gICAgICA8L3NwYW4+XG4gICAgKTtcbiAgfVxuICBpZiAoaGFzaCAmJiBpc1ZhbGlkQWNjb3VudEhhc2goaGFzaCkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPHNwYW4gcmVmPXtyZWZ9IHsuLi5yZXN0UHJvcHN9PlxuICAgICAgICA8QmFja2dyb3VuZFdyYXBwZXIgc2l6ZVR5cGU9e3NpemV9IHdpdGhCZ0NvbG9yPXshdHJhbnNwYXJlbnRCZ30+XG4gICAgICAgICAgPEljb25IYXNoV3JhcHBlcj5cbiAgICAgICAgICAgIDxTdmdJY29uIHNyYz17SGFzaEljb259IHNpemU9e2F2YXRhclNpemUgLSA4fSAvPlxuICAgICAgICAgIDwvSWNvbkhhc2hXcmFwcGVyPlxuICAgICAgICA8L0JhY2tncm91bmRXcmFwcGVyPlxuICAgICAgPC9zcGFuPlxuICAgICk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxzcGFuIHJlZj17cmVmfSB7Li4ucmVzdFByb3BzfT5cbiAgICAgIDxCYWNrZ3JvdW5kV3JhcHBlciBzaXplVHlwZT17c2l6ZX0+XG4gICAgICAgIHtoYXNoICYmIChcbiAgICAgICAgICA8SWRlbnRpY29uIGhleFN0cmluZz17aGFzaH0gc2l6ZT17YXZhdGFyU2l6ZX0gey4uLnJlc3RQcm9wc30gLz5cbiAgICAgICAgKX1cbiAgICAgIDwvQmFja2dyb3VuZFdyYXBwZXI+XG4gICAgPC9zcGFuPlxuICApO1xufSk7XG5cbkF2YXRhci5kaXNwbGF5TmFtZSA9ICdBdmF0YXInO1xuXG5leHBvcnQgZGVmYXVsdCBBdmF0YXI7XG4iXX0=