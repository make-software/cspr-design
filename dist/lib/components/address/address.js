import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import React from 'react';
import { Avatar } from '../avatar/avatar';
import styled from 'styled-components';
import BodyText from '../body-text/body-text.tsx';
import { HashLink } from '../hash-link/hash-link.tsx';
import FlexRow from '../flex-row/flex-row.tsx';
import FlexColumn from '../flex-column/flex-column.tsx';
import { formatHash, HashLength, shortenCsprName, truncateCSPRName, } from '../../utils/formatters.ts';
import TruncateBox from '../truncate-box/truncate-box.tsx';
import Copy from '../copy/copy.tsx';
import TooltipWithExtendedInfo from '../tooltip-with-extended-info/tooltip-with-extended-info';
import { isValidPublicKey } from 'casper-js-sdk';
const StyledTruncateBox = styled(TruncateBox)(() => ({
    height: '20px',
}));
const StyledBodyText = styled(BodyText)(({ theme }) => ({
    color: theme.styleguideColors.contentBlue,
    '& > *': {
        color: theme.styleguideColors.contentBlue,
    },
    '&:hover > *': {
        color: theme.styleguideColors.fillPrimaryRed,
    },
    '&:active > *': {
        color: theme.styleguideColors.fillPrimaryRedClick,
    },
}));
const AddressContent = ({ navigateToPath, csprName, hash, hashLength, align, minified, hashFontSize, }) => {
    if (!navigateToPath || navigateToPath === '') {
        const CSPR_NAME_TRUNCATION_LENGTH = 24;
        const copiedValue = csprName || hash || '';
        const truncatedCsprName = csprName && hashLength === HashLength.TINY
            ? truncateCSPRName(csprName, CSPR_NAME_TRUNCATION_LENGTH)
            : csprName;
        const formattedHash = hash ? formatHash(hash, hashLength) : null;
        return (_jsxs(FlexRow, { itemsSpacing: 4, align: align, children: [_jsx(BodyText, { size: 3, scale: hashFontSize, lineHeight: 'xs', monotype: !csprName, children: truncatedCsprName || formattedHash }), _jsx(Copy, { value: copiedValue, minified: minified })] }));
    }
    return (_jsx(StyledBodyText, { size: 3, scale: hashFontSize, monotype: !csprName, children: _jsx(HashLink, { href: navigateToPath, hash: hash, csprName: csprName && shortenCsprName(csprName, HashLength.TINY), hashLength: hashLength, minified: minified, align: align }) }));
};
/** @deprecated  */
export var HashFontSize;
(function (HashFontSize) {
    HashFontSize["default"] = "default";
    HashFontSize["big"] = "big";
})(HashFontSize || (HashFontSize = {}));
export const Address = React.forwardRef(function Address(props, ref) {
    const { hash, csprName, logo, name, loading, hashLength, minifiedCopyNotification, navigateToPath, tooltipCaption, hashFontSize, nameTruncateSize = 5, avatarSize = 'default', horizonalAlign = 'center', itemsSpacing = 12, } = props;
    if (loading || !hash) {
        return (_jsx(FlexRow, { align: "center", itemsSpacing: itemsSpacing, children: _jsx(Avatar, { hash: hash, loading: loading, size: avatarSize }) }));
    }
    if (hash === '00') {
        // hash == '00' means that it is a Immediate Switch Block
        // NOTE: as part of Casper network node v1.5, the node software now creates an "immediate switch block" on upgrades;
        // there are no rewards for this block. it simply captures the information after application of the upgrade,
        // which allows this to be deterministically detected
        return (_jsxs(FlexRow, { align: "center", itemsSpacing: itemsSpacing, children: [_jsx(Avatar, { hash: hash, loading: loading, size: avatarSize }), _jsxs(FlexColumn, { children: [_jsx(BodyText, { size: 2, monotype: true, lineHeight: 'xs', children: hash }), _jsx(BodyText, { size: 3, variation: "darkGray", noWrap: true, children: "System" })] })] }));
    }
    const keyTooltipCaption = tooltipCaption
        ? tooltipCaption
        : isValidPublicKey(hash)
            ? 'Public Key'
            : 'Account hash';
    return (_jsxs(FlexRow, { ref: ref, align: horizonalAlign, itemsSpacing: itemsSpacing, children: [logo ? (_jsx(Avatar, { src: logo, loading: loading, size: avatarSize, alt: 'Account logo' })) : (_jsx(Avatar, { hash: hash, loading: loading, size: avatarSize })), _jsx(TooltipWithExtendedInfo, { extendedLine: { title: csprName, caption: 'CSPR.name' }, tooltipCaption: keyTooltipCaption, hash: hash, children: _jsx(FlexColumn, { children: name ? (_jsxs(_Fragment, { children: [_jsx(AddressContent, { hashFontSize: hashFontSize, navigateToPath: navigateToPath, hash: hash, csprName: csprName && shortenCsprName(csprName, HashLength.TINY), hashLength: hashLength, minified: minifiedCopyNotification, align: horizonalAlign }), _jsx(FlexRow, { itemsSpacing: 6, align: horizonalAlign, children: _jsx(StyledTruncateBox, { size: nameTruncateSize, children: _jsx(BodyText, { scale: 'xs', lineHeight: 'xs', size: 3, variation: "darkGray", noWrap: true, children: name }) }) })] })) : (_jsx(AddressContent, { hashFontSize: hashFontSize, navigateToPath: navigateToPath, hash: hash, csprName: csprName && shortenCsprName(csprName, HashLength.TINY), hashLength: hashLength, minified: minifiedCopyNotification, align: horizonalAlign })) }) })] }));
});
Address.displayName = 'Address';
export default Address;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkcmVzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9hZGRyZXNzL2FkZHJlc3MudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUFFLE1BQU0sRUFBZSxNQUFNLGtCQUFrQixDQUFDO0FBRXZELE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sUUFBMkIsTUFBTSw0QkFBNEIsQ0FBQztBQUVyRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDdEQsT0FBTyxPQUF5QixNQUFNLDBCQUEwQixDQUFDO0FBQ2pFLE9BQU8sVUFBVSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3hELE9BQU8sRUFDTCxVQUFVLEVBQ1YsVUFBVSxFQUNWLGVBQWUsRUFDZixnQkFBZ0IsR0FDakIsTUFBTSwyQkFBMkIsQ0FBQztBQUVuQyxPQUFPLFdBQVcsTUFBTSxrQ0FBa0MsQ0FBQztBQUMzRCxPQUFPLElBQUksTUFBTSxrQkFBa0IsQ0FBQztBQUNwQyxPQUFPLHVCQUF1QixNQUFNLDBEQUEwRCxDQUFDO0FBQy9GLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQXdCakQsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuRCxNQUFNLEVBQUUsTUFBTTtDQUNmLENBQUMsQ0FBQyxDQUFDO0FBRUosTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN0RCxLQUFLLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLFdBQVc7SUFDekMsT0FBTyxFQUFFO1FBQ1AsS0FBSyxFQUFFLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxX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ckIsQ0FDSCxHQUNVLEdBQ1csSUFDbEIsQ0FDWCxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztBQUVoQyxlQUFlLE9BQU8sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBBdmF0YXIsIEF2YXRhclByb3BzIH0gZnJvbSAnLi4vYXZhdGFyL2F2YXRhcic7XG5cbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IEJvZHlUZXh0LCB7IEJvZHlUZXh0UHJvcHMgfSBmcm9tICcuLi9ib2R5LXRleHQvYm9keS10ZXh0LnRzeCc7XG5pbXBvcnQgVG9vbHRpcCBmcm9tICcuLi90b29sdGlwL3Rvb2x0aXAudHN4JztcbmltcG9ydCB7IEhhc2hMaW5rIH0gZnJvbSAnLi4vaGFzaC1saW5rL2hhc2gtbGluay50c3gnO1xuaW1wb3J0IEZsZXhSb3csIHsgRmxleFJvd1Byb3BzIH0gZnJvbSAnLi4vZmxleC1yb3cvZmxleC1yb3cudHN4JztcbmltcG9ydCBGbGV4Q29sdW1uIGZyb20gJy4uL2ZsZXgtY29sdW1uL2ZsZXgtY29sdW1uLnRzeCc7XG5pbXBvcnQge1xuICBmb3JtYXRIYXNoLFxuICBIYXNoTGVuZ3RoLFxuICBzaG9ydGVuQ3Nwck5hbWUsXG4gIHRydW5jYXRlQ1NQUk5hbWUsXG59IGZyb20gJy4uLy4uL3V0aWxzL2Zvcm1hdHRlcnMudHMnO1xuaW1wb3J0IHsgU2l6ZSB9IGZyb20gJy4uLy4uL3R5cGVzLnRzJztcbmltcG9ydCBUcnVuY2F0ZUJveCBmcm9tICcuLi90cnVuY2F0ZS1ib3gvdHJ1bmNhdGUtYm94LnRzeCc7XG5pbXBvcnQgQ29weSBmcm9tICcuLi9jb3B5L2NvcHkudHN4JztcbmltcG9ydCBUb29sdGlwV2l0aEV4dGVuZGVkSW5mbyBmcm9tICcuLi90b29sdGlwLXdpdGgtZXh0ZW5kZWQtaW5mby90b29sdGlwLXdpdGgtZXh0ZW5kZWQtaW5mbyc7XG5pbXBvcnQgeyBpc1ZhbGlkUHVibGljS2V5IH0gZnJvbSAnY2FzcGVyLWpzLXNkayc7XG5cbmludGVyZmFjZSBBZGRyZXNzUHJvcHMge1xuICBoYXNoOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkO1xuICBuYW1lPzogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBsb2dvPzogc3RyaW5nIHwgbnVsbDtcbiAgY3Nwck5hbWU/OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIHRvb2x0aXBDYXB0aW9uPzogc3RyaW5nO1xuICBhZGRpdGlvbmFsVG9vbHRpcEJsb2NrPzogUmVhY3QuUmVhY3RFbGVtZW50O1xuICBuYXZpZ2F0ZVRvUGF0aD86IHN0cmluZztcbiAgaGFzaExlbmd0aD86IEhhc2hMZW5ndGg7XG4gIG5hbWVUcnVuY2F0ZVNpemU/OiBTaXplO1xuICBhdmF0YXJTaXplPzogQXZhdGFyUHJvcHNbJ3NpemUnXTtcbiAgaGFzaEZvbnRTaXplPzogQm9keVRleHRQcm9wc1snc2NhbGUnXTtcbiAgbWluaWZpZWRDb3B5Tm90aWZpY2F0aW9uPzogYm9vbGVhbjtcbiAgaXRlbXNTcGFjaW5nPzogbnVtYmVyO1xuICBob3Jpem9uYWxBbGlnbj86IEZsZXhSb3dQcm9wc1snYWxpZ24nXTtcbiAgbG9hZGluZz86IGJvb2xlYW47XG4gIC8qKiBAZGVwcmVjYXRlZCB1c2UgKm5hdmlnYXRlVG9QYXRoKiBpbnN0ZWFkICovXG4gIG5hdmlnYXRpb25QYXRoPzoga2V5b2YgYW55O1xuICAvKiogQGRlcHJlY2F0ZWQgdXNlICptaW5pZmllZENvcHlOb3RpZmljYXRpb24qIGluc3RlYWQgKi9cbiAgY29weU5vdGlmeWluZ1N0eWxlPzogJ2Z1bGwnIHwgJ3RpbnknO1xufVxuXG5jb25zdCBTdHlsZWRUcnVuY2F0ZUJveCA9IHN0eWxlZChUcnVuY2F0ZUJveCkoKCkgPT4gKHtcbiAgaGVpZ2h0OiAnMjBweCcsXG59KSk7XG5cbmNvbnN0IFN0eWxlZEJvZHlUZXh0ID0gc3R5bGVkKEJvZHlUZXh0KSgoeyB0aGVtZSB9KSA9PiAoe1xuICBjb2xvcjogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50Qmx1ZSxcbiAgJyYgPiAqJzoge1xuICAgIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRCbHVlLFxuICB9LFxuICAnJjpob3ZlciA+IConOiB7XG4gICAgY29sb3I6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFByaW1hcnlSZWQsXG4gIH0sXG4gICcmOmFjdGl2ZSA+IConOiB7XG4gICAgY29sb3I6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFByaW1hcnlSZWRDbGljayxcbiAgfSxcbn0pKTtcblxuY29uc3QgQWRkcmVzc0NvbnRlbnQgPSAoe1xuICBuYXZpZ2F0ZVRvUGF0aCxcbiAgY3Nwck5hbWUsXG4gIGhhc2gsXG4gIGhhc2hMZW5ndGgsXG4gIGFsaWduLFxuICBtaW5pZmllZCxcbiAgaGFzaEZvbnRTaXplLFxufSkgPT4ge1xuICBpZiAoIW5hdmlnYXRlVG9QYXRoIHx8IG5hdmlnYXRlVG9QYXRoID09PSAnJykge1xuICAgIGNvbnN0IENTUFJfTkFNRV9UUlVOQ0FUSU9OX0xFTkdUSCA9IDI0O1xuICAgIGNvbnN0IGNvcGllZFZhbHVlID0gY3Nwck5hbWUgfHwgaGFzaCB8fCAnJztcblxuICAgIGNvbnN0IHRydW5jYXRlZENzcHJOYW1lID1cbiAgICAgIGNzcHJOYW1lICYmIGhhc2hMZW5ndGggPT09IEhhc2hMZW5ndGguVElOWVxuICAgICAgICA/IHRydW5jYXRlQ1NQUk5hbWUoY3Nwck5hbWUsIENTUFJfTkFNRV9UUlVOQ0FUSU9OX0xFTkdUSClcbiAgICAgICAgOiBjc3ByTmFtZTtcbiAgICBjb25zdCBmb3JtYXR0ZWRIYXNoID0gaGFzaCA/IGZvcm1hdEhhc2goaGFzaCwgaGFzaExlbmd0aCkgOiBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxGbGV4Um93IGl0ZW1zU3BhY2luZz17NH0gYWxpZ249e2FsaWdufT5cbiAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgc2l6ZT17M31cbiAgICAgICAgICBzY2FsZT17aGFzaEZvbnRTaXplfVxuICAgICAgICAgIGxpbmVIZWlnaHQ9eyd4cyd9XG4gICAgICAgICAgbW9ub3R5cGU9eyFjc3ByTmFtZX1cbiAgICAgICAgPlxuICAgICAgICAgIHt0cnVuY2F0ZWRDc3ByTmFtZSB8fCBmb3JtYXR0ZWRIYXNofVxuICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICA8Q29weSB2YWx1ZT17Y29waWVkVmFsdWV9IG1pbmlmaWVkPXttaW5pZmllZH0gLz5cbiAgICAgIDwvRmxleFJvdz5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8U3R5bGVkQm9keVRleHQgc2l6ZT17M30gc2NhbGU9e2hhc2hGb250U2l6ZX0gbW9ub3R5cGU9eyFjc3ByTmFtZX0+XG4gICAgICA8SGFzaExpbmtcbiAgICAgICAgaHJlZj17bmF2aWdhdGVUb1BhdGh9XG4gICAgICAgIGhhc2g9e2hhc2h9XG4gICAgICAgIGNzcHJOYW1lPXtjc3ByTmFtZSAmJiBzaG9ydGVuQ3Nwck5hbWUoY3Nwck5hbWUsIEhhc2hMZW5ndGguVElOWSl9XG4gICAgICAgIGhhc2hMZW5ndGg9e2hhc2hMZW5ndGh9XG4gICAgICAgIG1pbmlmaWVkPXttaW5pZmllZH1cbiAgICAgICAgYWxpZ249e2FsaWdufVxuICAgICAgLz5cbiAgICA8L1N0eWxlZEJvZHlUZXh0PlxuICApO1xufTtcblxuLyoqIEBkZXByZWNhdGVkICAqL1xuZXhwb3J0IGVudW0gSGFzaEZvbnRTaXplIHtcbiAgJ2RlZmF1bHQnID0gJ2RlZmF1bHQnLFxuICAnYmlnJyA9ICdiaWcnLFxufVxuXG4vKipcbiAqIEFkZHJlc3MgY29tcG9uZW50IGNhbiBiZSB1c2VkIHRvIGRpc3BsYXkgYSBwdWJsaWMga2V5IG9yIGhhc2ggYXNzb2NpYXRlZCB3aXRoIGFuIGFjY291bnQuXG4gKiBJdCBzdXBwb3J0cyB2YXJpb3VzIGNvbmZpZ3VyYXRpb25zLCBpbmNsdWRpbmcgbG9hZGluZyBzdGF0ZSwgbG9nbywgbmFtZSwgY3Nwck5hbWUsIGFuZCB0b29sdGlwLlxuICpcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gbG9hZGluZyAtIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBhZGRyZXNzIGNvbXBvbmVudCBpcyBpbiBhIGxvYWRpbmcgc3RhdGUuXG4gKiBAcGFyYW0ge3N0cmluZyB8IG51bGx9IGxvZ28gLSBUaGUgbG9nbyBhc3NvY2lhdGVkIHdpdGggdGhlIGFkZHJlc3MsIGlmIGF2YWlsYWJsZS5cbiAqIEBwYXJhbSB7c3RyaW5nIHwgdW5kZWZpbmVkfSBuYW1lIC0gVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGUgYWRkcmVzcy5cbiAqIEBwYXJhbSB7c3RyaW5nIHwgdW5kZWZpbmVkfSBbY3Nwck5hbWVdIC0gVGhlIENTUFIubmFtZSBhc3NvY2lhdGVkIHdpdGggdGhlIGFkZHJlc3MsIGlmIGFwcGxpY2FibGUuXG4gKiBAcGFyYW0ge3N0cmluZyB8IG51bGwgfCB1bmRlZmluZWR9IGhhc2ggLSBUaGUgcHVibGljIGtleSBvciBoYXNoIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWRkcmVzcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBbdG9vbHRpcENhcHRpb25dIC0gVGV4dCB0byBiZSBkaXNwbGF5ZWQgaW4gYSB0b29sdGlwIGZvciBhZGRpdGlvbmFsIGNvbnRleHQuXG4gKiBAcGFyYW0ge3N0cmluZ30gW25hdmlnYXRlVG9QYXRoXSAtIFRoZSBwYXRoIHRvIG5hdmlnYXRlIHRvIHdoZW4gaW50ZXJhY3Rpbmcgd2l0aCB0aGUgYWRkcmVzcy5cbiAqIEBwYXJhbSB7SGFzaExlbmd0aH0gW2hhc2hMZW5ndGhdIC0gU3BlY2lmaWVzIHRoZSBsZW5ndGggb2YgdGhlIGhhc2ggcmVwcmVzZW50YXRpb24uXG4gKiBAcGFyYW0ge1NpemV9IFtuYW1lVHJ1bmNhdGVTaXplXSAtIERlZmluZXMgdGhlIHNpemUgb2YgdGhlIG5hbWUgdGV4dC5cbiAqIEBwYXJhbSB7QXZhdGFyUHJvcHNbJ3NpemUnXX0gW2F2YXRhclNpemVdIC0gVGhlIHNpemUgb2YgdGhlIGF2YXRhciByZWxhdGVkIHRvIHRoZSBhZGRyZXNzLlxuICogQHBhcmFtIHtcInhzXCIgfCBcInNtXCIgfCBcIm1kXCIgfCBcImxnXCIgfCBcInhsXCIgfCB1bmRlZmluZWR9IFtoYXNoRm9udFNpemVdIC0gU3BlY2lmaWVzIHRoZSBmb250IHNpemUgdG8gZGlzcGxheSB0aGUgaGFzaC5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW21pbmlmaWVkQ29weU5vdGlmaWNhdGlvbl0gLSBEZXRlcm1pbmVzIGlmIHRoZSBhZGRyZXNzIGNvbXBvbmVudCBzaG91bGQgYmUgcmVuZGVyZWQgaW4gYSBtaW5pbWl6ZWQgc3R5bGUuXG4gKiBAcGFyYW0ge251bWJlcn0gW2l0ZW1zU3BhY2luZ10gLSBHYXAgYmV0d2VlbiBhdmF0YXIgYW5kIGhhc2guXG4gKiBAcGFyYW0gW2hvcml6b25hbEFsaWduXSAtIEhvcml6b250YWwgYWxpZ25tZW50IG9mIHRoZSBhZGRyZXNzIGNvbXBvbmVudC5cbiAqIEBwYXJhbSB7a2V5b2YgYW55fSBbbmF2aWdhdGlvblBhdGhdIC0gKipAZGVwcmVjYXRlZCoqIFVzZSBgbmF2aWdhdGVUb1BhdGhgIGluc3RlYWQuXG4gKiBAcGFyYW0geydmdWxsJyB8ICd0aW55J30gW2NvcHlOb3RpZnlpbmdTdHlsZV0gLSAqKkBkZXByZWNhdGVkKiogVXNlIGBtaW5pZmllZENvcHlOb3RpZmljYXRpb25gIGluc3RlYWQuXG4gKi9cblxudHlwZSBSZWYgPSBIVE1MRGl2RWxlbWVudDtcbmV4cG9ydCBjb25zdCBBZGRyZXNzID0gUmVhY3QuZm9yd2FyZFJlZjxSZWYsIEFkZHJlc3NQcm9wcz4oZnVuY3Rpb24gQWRkcmVzcyhcbiAgcHJvcHM6IEFkZHJlc3NQcm9wcyxcbiAgcmVmLFxuKSB7XG4gIGNvbnN0IHtcbiAgICBoYXNoLFxuICAgIGNzcHJOYW1lLFxuICAgIGxvZ28sXG4gICAgbmFtZSxcbiAgICBsb2FkaW5nLFxuICAgIGhhc2hMZW5ndGgsXG4gICAgbWluaWZpZWRDb3B5Tm90aWZpY2F0aW9uLFxuICAgIG5hdmlnYXRlVG9QYXRoLFxuICAgIHRvb2x0aXBDYXB0aW9uLFxuICAgIGhhc2hGb250U2l6ZSxcbiAgICBuYW1lVHJ1bmNhdGVTaXplID0gNSxcbiAgICBhdmF0YXJTaXplID0gJ2RlZmF1bHQnLFxuICAgIGhvcml6b25hbEFsaWduID0gJ2NlbnRlcicsXG4gICAgaXRlbXNTcGFjaW5nID0gMTIsXG4gIH0gPSBwcm9wcztcblxuICBpZiAobG9hZGluZyB8fCAhaGFzaCkge1xuICAgIHJldHVybiAoXG4gICAgICA8RmxleFJvdyBhbGlnbj1cImNlbnRlclwiIGl0ZW1zU3BhY2luZz17aXRlbXNTcGFjaW5nfT5cbiAgICAgICAgPEF2YXRhciBoYXNoPXtoYXNofSBsb2FkaW5nPXtsb2FkaW5nfSBzaXplPXthdmF0YXJTaXplfSAvPlxuICAgICAgPC9GbGV4Um93PlxuICAgICk7XG4gIH1cblxuICBpZiAoaGFzaCA9PT0gJzAwJykge1xuICAgIC8vIGhhc2ggPT0gJzAwJyBtZWFucyB0aGF0IGl0IGlzIGEgSW1tZWRpYXRlIFN3aXRjaCBCbG9ja1xuICAgIC8vIE5PVEU6IGFzIHBhcnQgb2YgQ2FzcGVyIG5ldHdvcmsgbm9kZSB2MS41LCB0aGUgbm9kZSBzb2Z0d2FyZSBub3cgY3JlYXRlcyBhbiBcImltbWVkaWF0ZSBzd2l0Y2ggYmxvY2tcIiBvbiB1cGdyYWRlcztcbiAgICAvLyB0aGVyZSBhcmUgbm8gcmV3YXJkcyBmb3IgdGhpcyBibG9jay4gaXQgc2ltcGx5IGNhcHR1cmVzIHRoZSBpbmZvcm1hdGlvbiBhZnRlciBhcHBsaWNhdGlvbiBvZiB0aGUgdXBncmFkZSxcbiAgICAvLyB3aGljaCBhbGxvd3MgdGhpcyB0byBiZSBkZXRlcm1pbmlzdGljYWxseSBkZXRlY3RlZFxuICAgIHJldHVybiAoXG4gICAgICA8RmxleFJvdyBhbGlnbj1cImNlbnRlclwiIGl0ZW1zU3BhY2luZz17aXRlbXNTcGFjaW5nfT5cbiAgICAgICAgPEF2YXRhciBoYXNoPXtoYXNofSBsb2FkaW5nPXtsb2FkaW5nfSBzaXplPXthdmF0YXJTaXplfSAvPlxuICAgICAgICA8RmxleENvbHVtbj5cbiAgICAgICAgICA8Qm9keVRleHQgc2l6ZT17Mn0gbW9ub3R5cGUgbGluZUhlaWdodD17J3hzJ30+XG4gICAgICAgICAgICB7aGFzaH1cbiAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgIDxCb2R5VGV4dCBzaXplPXszfSB2YXJpYXRpb249XCJkYXJrR3JheVwiIG5vV3JhcD5cbiAgICAgICAgICAgIFN5c3RlbVxuICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgIDwvRmxleENvbHVtbj5cbiAgICAgIDwvRmxleFJvdz5cbiAgICApO1xuICB9XG5cbiAgY29uc3Qga2V5VG9vbHRpcENhcHRpb24gPSB0b29sdGlwQ2FwdGlvblxuICAgID8gdG9vbHRpcENhcHRpb25cbiAgICA6IGlzVmFsaWRQdWJsaWNLZXkoaGFzaClcbiAgICAgID8gJ1B1YmxpYyBLZXknXG4gICAgICA6ICdBY2NvdW50IGhhc2gnO1xuXG4gIHJldHVybiAoXG4gICAgPEZsZXhSb3cgcmVmPXtyZWZ9IGFsaWduPXtob3Jpem9uYWxBbGlnbn0gaXRlbXNTcGFjaW5nPXtpdGVtc1NwYWNpbmd9PlxuICAgICAge2xvZ28gPyAoXG4gICAgICAgIDxBdmF0YXJcbiAgICAgICAgICBzcmM9e2xvZ299XG4gICAgICAgICAgbG9hZGluZz17bG9hZGluZ31cbiAgICAgICAgICBzaXplPXthdmF0YXJTaXplfVxuICAgICAgICAgIGFsdD17J0FjY291bnQgbG9nbyd9XG4gICAgICAgIC8+XG4gICAgICApIDogKFxuICAgICAgICA8QXZhdGFyIGhhc2g9e2hhc2h9IGxvYWRpbmc9e2xvYWRpbmd9IHNpemU9e2F2YXRhclNpemV9IC8+XG4gICAgICApfVxuXG4gICAgICA8VG9vbHRpcFdpdGhFeHRlbmRlZEluZm9cbiAgICAgICAgZXh0ZW5kZWRMaW5lPXt7IHRpdGxlOiBjc3ByTmFtZSwgY2FwdGlvbjogJ0NTUFIubmFtZScgfX1cbiAgICAgICAgdG9vbHRpcENhcHRpb249e2tleVRvb2x0aXBDYXB0aW9ufVxuICAgICAgICBoYXNoPXtoYXNofVxuICAgICAgPlxuICAgICAgICA8RmxleENvbHVtbj5cbiAgICAgICAgICB7bmFtZSA/IChcbiAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgIDxBZGRyZXNzQ29udGVudFxuICAgICAgICAgICAgICAgIGhhc2hGb250U2l6ZT17aGFzaEZvbnRTaXplfVxuICAgICAgICAgICAgICAgIG5hdmlnYXRlVG9QYXRoPXtuYXZpZ2F0ZVRvUGF0aH1cbiAgICAgICAgICAgICAgICBoYXNoPXtoYXNofVxuICAgICAgICAgICAgICAgIGNzcHJOYW1lPXtcbiAgICAgICAgICAgICAgICAgIGNzcHJOYW1lICYmIHNob3J0ZW5Dc3ByTmFtZShjc3ByTmFtZSwgSGFzaExlbmd0aC5USU5ZKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBoYXNoTGVuZ3RoPXtoYXNoTGVuZ3RofVxuICAgICAgICAgICAgICAgIG1pbmlmaWVkPXttaW5pZmllZENvcHlOb3RpZmljYXRpb259XG4gICAgICAgICAgICAgICAgYWxpZ249e2hvcml6b25hbEFsaWdufVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8RmxleFJvdyBpdGVtc1NwYWNpbmc9ezZ9IGFsaWduPXtob3Jpem9uYWxBbGlnbn0+XG4gICAgICAgICAgICAgICAgPFN0eWxlZFRydW5jYXRlQm94IHNpemU9e25hbWVUcnVuY2F0ZVNpemV9PlxuICAgICAgICAgICAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgICAgICAgICAgIHNjYWxlPXsneHMnfVxuICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0PXsneHMnfVxuICAgICAgICAgICAgICAgICAgICBzaXplPXszfVxuICAgICAgICAgICAgICAgICAgICB2YXJpYXRpb249XCJkYXJrR3JheVwiXG4gICAgICAgICAgICAgICAgICAgIG5vV3JhcFxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7bmFtZX1cbiAgICAgICAgICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgICAgICAgICAgPC9TdHlsZWRUcnVuY2F0ZUJveD5cbiAgICAgICAgICAgICAgPC9GbGV4Um93PlxuICAgICAgICAgICAgPC8+XG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDxBZGRyZXNzQ29udGVudFxuICAgICAgICAgICAgICBoYXNoRm9udFNpemU9e2hhc2hGb250U2l6ZX1cbiAgICAgICAgICAgICAgbmF2aWdhdGVUb1BhdGg9e25hdmlnYXRlVG9QYXRofVxuICAgICAgICAgICAgICBoYXNoPXtoYXNofVxuICAgICAgICAgICAgICBjc3ByTmFtZT17Y3Nwck5hbWUgJiYgc2hvcnRlbkNzcHJOYW1lKGNzcHJOYW1lLCBIYXNoTGVuZ3RoLlRJTlkpfVxuICAgICAgICAgICAgICBoYXNoTGVuZ3RoPXtoYXNoTGVuZ3RofVxuICAgICAgICAgICAgICBtaW5pZmllZD17bWluaWZpZWRDb3B5Tm90aWZpY2F0aW9ufVxuICAgICAgICAgICAgICBhbGlnbj17aG9yaXpvbmFsQWxpZ259XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvRmxleENvbHVtbj5cbiAgICAgIDwvVG9vbHRpcFdpdGhFeHRlbmRlZEluZm8+XG4gICAgPC9GbGV4Um93PlxuICApO1xufSk7XG5cbkFkZHJlc3MuZGlzcGxheU5hbWUgPSAnQWRkcmVzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IEFkZHJlc3M7XG4iXX0=