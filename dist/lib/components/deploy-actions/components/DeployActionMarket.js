import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import ContractIcon from '../../../components/contract-icon/contract-icon';
import { deriveAccountInfo } from '../../../utils/account.tsx';
import DeployFiatAmount from './DeployFiatAmount';
import { NftCollectionIdentifier } from './NftCollectionIdentifier';
import { NftTokenIds } from './NftTokenIds';
import { useDeployActionDataContext } from '../services/deploy-action-context';
import { CsprMarketEntryPoint } from '../../../types/NFTToken';
import { isNonNullable } from '../../../utils/guards';
import FlexRow from '../../flex-row/flex-row';
import BodyText from '../../body-text/body-text';
import Link from '../../link/link';
import { guardedDeriveSplitDataFromArguments } from '../../../utils/deploy-args';
import Address from '../../address/address';
const marketActionNameMap = {
    [CsprMarketEntryPoint.delist_token]: 'Delist',
    [CsprMarketEntryPoint.list_token]: 'List',
    [CsprMarketEntryPoint.accept_offer]: 'Accept offer',
    [CsprMarketEntryPoint.cancel_offer]: 'Cancel offer',
    [CsprMarketEntryPoint.make_offer]: 'Make offer',
};
const getNftTokenIdsFromArguments = (args) => {
    const hasTokens = args.tokens?.parsed || args.token_id?.parsed;
    if (hasTokens) {
        const tokens = args.tokens?.parsed
            ? args.tokens.parsed.map((token) => typeof token === 'string' ? token : token.key)
            : [];
        const ids = [...tokens, args.token_id?.parsed].filter(isNonNullable);
        return [...new Set(ids)];
    }
    return null;
};
const MarketContractIdentifier = ({ contractPackage, path, }) => {
    const { latest_version_contract_type_id, icon_url, contract_package_hash, name, } = contractPackage;
    return (_jsxs(FlexRow, { itemsSpacing: 4, align: 'center', children: [_jsx(ContractIcon, { contractTypeId: latest_version_contract_type_id, src: icon_url, loading: !contractPackage, size: "small" }), _jsx(BodyText, { size: 3, variation: 'darkGray', noWrap: true, scale: 'sm', children: contract_package_hash && (_jsx(Link, { href: path, ariaDescription: 'Link to contract package details', color: 'primaryBlue', children: name })) })] }));
};
const OfferMarketAction = ({ deploy, collectionHash, nftTokenIds, }) => {
    const { amount, entryPoint, args, timeTransactionCurrencyRate, contractPackage, } = deploy;
    const offererHash = guardedDeriveSplitDataFromArguments(args.offerer, 'Account');
    const { getAccountInfo, getPublicKeyAccountHash, getContractPackageInfoByHash, csprLiveDomainPath, } = useDeployActionDataContext();
    const accountInfo = offererHash && getAccountInfo(offererHash?.hash);
    const publicKey = offererHash && getPublicKeyAccountHash(offererHash?.hash);
    const accountInfoDetails = deriveAccountInfo(accountInfo?.account_info || accountInfo?.centralized_account_info);
    const logo = accountInfoDetails && accountInfoDetails.logo;
    const name = accountInfoDetails?.name;
    const csprName = accountInfo?.cspr_name;
    return (_jsxs(FlexRow, { align: 'center', itemsSpacing: 8, children: [_jsx(BodyText, { monotype: true, size: 3, wordBreak: true, noWrap: true, variation: 'black', children: marketActionNameMap[entryPoint?.name || ''] }), amount && (_jsxs(_Fragment, { children: [_jsx(BodyText, { size: 3, variation: "darkGray", children: "of" }), _jsx(DeployFiatAmount, { amount: amount, rate: timeTransactionCurrencyRate })] })), collectionHash && (_jsxs(_Fragment, { children: [_jsx(BodyText, { size: 3, variation: "darkGray", children: "for" }), _jsx(NftCollectionIdentifier, { path: `${csprLiveDomainPath}/contract-package/${collectionHash}`, contractPackage: getContractPackageInfoByHash(collectionHash) })] })), _jsx(NftTokenIds, { nftTokenIds: nftTokenIds, collectionHash: collectionHash, csprLiveDomainPath: csprLiveDomainPath }), offererHash && (_jsxs(FlexRow, { itemsSpacing: 6, align: 'center', children: [_jsx(BodyText, { size: 3, variation: 'darkGray', children: "from" }), _jsx(Address, { logo: logo, name: name, hash: publicKey || offererHash.hash, csprName: csprName, loading: !offererHash, navigateToPath: `${csprLiveDomainPath}/account/${publicKey || offererHash.hash}`, avatarSize: 'small', hashFontSize: 'sm', minifiedCopyNotification: true })] })), _jsx(BodyText, { size: 3, variation: 'darkGray', children: "on" }), _jsx(MarketContractIdentifier, { contractPackage: contractPackage, path: `${csprLiveDomainPath}/contract-package/${contractPackage.contract_package_hash}` })] }));
};
const ListMarketAction = ({ deploy, collectionHash, nftTokenIds, }) => {
    const { entryPoint, contractPackage } = deploy;
    const { csprLiveDomainPath, getContractPackageInfoByHash } = useDeployActionDataContext();
    const contractIdentifierPrefix = entryPoint?.name === CsprMarketEntryPoint.delist_token ? 'from' : 'on';
    return (_jsxs(FlexRow, { align: 'center', itemsSpacing: 8, children: [_jsx(BodyText, { monotype: true, size: 3, wordBreak: true, noWrap: true, variation: 'black', children: marketActionNameMap[entryPoint?.name || ''] }), collectionHash && (_jsx(NftCollectionIdentifier, { path: `${csprLiveDomainPath}/contract-package/${collectionHash}`, contractPackage: getContractPackageInfoByHash(collectionHash) })), _jsx(NftTokenIds, { nftTokenIds: nftTokenIds, collectionHash: collectionHash, csprLiveDomainPath: csprLiveDomainPath }), _jsx(BodyText, { size: 3, variation: 'darkGray', children: contractIdentifierPrefix }), _jsx(MarketContractIdentifier, { contractPackage: contractPackage, path: `${csprLiveDomainPath}/contract-package/${contractPackage.contract_package_hash}` })] }));
};
const DefaultMarketAction = ({ deploy }) => {
    const { entryPoint, contractPackage } = deploy;
    const { csprLiveDomainPath } = useDeployActionDataContext();
    return (_jsxs(FlexRow, { align: 'center', itemsSpacing: 8, children: [_jsx(BodyText, { monotype: true, size: 3, wordBreak: true, noWrap: true, variation: 'black', children: entryPoint?.name }), _jsx(BodyText, { size: 3, variation: 'darkGray', children: "with" }), _jsx(MarketContractIdentifier, { contractPackage: contractPackage, path: `${csprLiveDomainPath}/contract-package/${contractPackage.contract_package_hash}` })] }));
};
const DeployActionMarket = ({ deploy }) => {
    const { entryPoint, args } = deploy;
    const entryPointName = entryPoint?.name || '';
    const collectionHash = guardedDeriveSplitDataFromArguments(args.collection, 'Hash');
    const isOfferAction = entryPointName === CsprMarketEntryPoint.accept_offer ||
        entryPointName === CsprMarketEntryPoint.make_offer ||
        entryPointName === CsprMarketEntryPoint.cancel_offer;
    const isListAction = entryPointName === CsprMarketEntryPoint.delist_token ||
        entryPointName === CsprMarketEntryPoint.list_token;
    const nftTokenIds = getNftTokenIdsFromArguments(deploy.args);
    if (isOfferAction && collectionHash) {
        return (_jsx(OfferMarketAction, { deploy: deploy, collectionHash: collectionHash?.hash, nftTokenIds: nftTokenIds }));
    }
    if (isListAction && collectionHash) {
        return (_jsx(ListMarketAction, { deploy: deploy, collectionHash: collectionHash?.hash, nftTokenIds: nftTokenIds }));
    }
    return _jsx(DefaultMarketAction, { deploy: deploy });
};
export default DeployActionMarket;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGVwbG95QWN0aW9uTWFya2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb21wb25lbnRzL2RlcGxveS1hY3Rpb25zL2NvbXBvbmVudHMvRGVwbG95QWN0aW9uTWFya2V0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxZQUFZLE1BQU0saURBQWlELENBQUM7QUFDM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDL0QsT0FBTyxnQkFBZ0IsTUFBTSxvQkFBb0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVDLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV0RCxPQUFPLE9BQU8sTUFBTSx5QkFBeUIsQ0FBQztBQUM5QyxPQUFPLFFBQVEsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRCxPQUFPLElBQUksTUFBTSxpQkFBaUIsQ0FBQztBQUNuQyxPQUFPLEVBQUUsbUNBQW1DLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNqRixPQUFPLE9BQU8sTUFBTSx1QkFBdUIsQ0FBQztBQUU1QyxNQUFNLG1CQUFtQixHQUFHO0lBQzFCLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLEVBQUUsUUFBUTtJQUM3QyxDQUFDLG9CQUFvQixDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU07SUFDekMsQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsRUFBRSxjQUFjO0lBQ25ELENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLEVBQUUsY0FBYztJQUNuRCxDQUFDLG9CQUFv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Q0FBQyxDQUFDO0FBRUYsZUFBZSxrQkFBa0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQ29udHJhY3RJY29uIGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvY29udHJhY3QtaWNvbi9jb250cmFjdC1pY29uJztcbmltcG9ydCB7IGRlcml2ZUFjY291bnRJbmZvIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvYWNjb3VudC50c3gnO1xuaW1wb3J0IERlcGxveUZpYXRBbW91bnQgZnJvbSAnLi9EZXBsb3lGaWF0QW1vdW50JztcbmltcG9ydCB7IE5mdENvbGxlY3Rpb25JZGVudGlmaWVyIH0gZnJvbSAnLi9OZnRDb2xsZWN0aW9uSWRlbnRpZmllcic7XG5pbXBvcnQgeyBOZnRUb2tlbklkcyB9IGZyb20gJy4vTmZ0VG9rZW5JZHMnO1xuaW1wb3J0IHsgdXNlRGVwbG95QWN0aW9uRGF0YUNvbnRleHQgfSBmcm9tICcuLi9zZXJ2aWNlcy9kZXBsb3ktYWN0aW9uLWNvbnRleHQnO1xuaW1wb3J0IHsgQ3Nwck1hcmtldEVudHJ5UG9pbnQgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9ORlRUb2tlbic7XG5pbXBvcnQgeyBpc05vbk51bGxhYmxlIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZ3VhcmRzJztcbmltcG9ydCB7IERlcGxveSwgRGVwbG95Q29udHJhY3RQYWNrYWdlUmVzdWx0IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvdHlwZXMnO1xuaW1wb3J0IEZsZXhSb3cgZnJvbSAnLi4vLi4vZmxleC1yb3cvZmxleC1yb3cnO1xuaW1wb3J0IEJvZHlUZXh0IGZyb20gJy4uLy4uL2JvZHktdGV4dC9ib2R5LXRleHQnO1xuaW1wb3J0IExpbmsgZnJvbSAnLi4vLi4vbGluay9saW5rJztcbmltcG9ydCB7IGd1YXJkZWREZXJpdmVTcGxpdERhdGFGcm9tQXJndW1lbnRzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZGVwbG95LWFyZ3MnO1xuaW1wb3J0IEFkZHJlc3MgZnJvbSAnLi4vLi4vYWRkcmVzcy9hZGRyZXNzJztcblxuY29uc3QgbWFya2V0QWN0aW9uTmFtZU1hcCA9IHtcbiAgW0NzcHJNYXJrZXRFbnRyeVBvaW50LmRlbGlzdF90b2tlbl06ICdEZWxpc3QnLFxuICBbQ3Nwck1hcmtldEVudHJ5UG9pbnQubGlzdF90b2tlbl06ICdMaXN0JyxcbiAgW0NzcHJNYXJrZXRFbnRyeVBvaW50LmFjY2VwdF9vZmZlcl06ICdBY2NlcHQgb2ZmZXInLFxuICBbQ3Nwck1hcmtldEVudHJ5UG9pbnQuY2FuY2VsX29mZmVyXTogJ0NhbmNlbCBvZmZlcicsXG4gIFtDc3ByTWFya2V0RW50cnlQb2ludC5tYWtlX29mZmVyXTogJ01ha2Ugb2ZmZXInLFxufTtcblxuY29uc3QgZ2V0TmZ0VG9rZW5JZHNGcm9tQXJndW1lbnRzID0gKGFyZ3MpID0+IHtcbiAgY29uc3QgaGFzVG9rZW5zID0gYXJncy50b2tlbnM/LnBhcnNlZCB8fCBhcmdzLnRva2VuX2lkPy5wYXJzZWQ7XG4gIGlmIChoYXNUb2tlbnMpIHtcbiAgICBjb25zdCB0b2tlbnMgPSBhcmdzLnRva2Vucz8ucGFyc2VkXG4gICAgICA/IGFyZ3MudG9rZW5zLnBhcnNlZC5tYXAoKHRva2VuKSA9PlxuICAgICAgICAgIHR5cGVvZiB0b2tlbiA9PT0gJ3N0cmluZycgPyB0b2tlbiA6IHRva2VuLmtleSxcbiAgICAgICAgKVxuICAgICAgOiBbXTtcbiAgICBjb25zdCBpZHMgPSBbLi4udG9rZW5zLCBhcmdzLnRva2VuX2lkPy5wYXJzZWRdLmZpbHRlcihpc05vbk51bGxhYmxlKTtcblxuICAgIHJldHVybiBbLi4ubmV3IFNldChpZHMpXTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbnN0IE1hcmtldENvbnRyYWN0SWRlbnRpZmllciA9ICh7XG4gIGNvbnRyYWN0UGFja2FnZSxcbiAgcGF0aCxcbn06IHtcbiAgY29udHJhY3RQYWNrYWdlOiBEZXBsb3lDb250cmFjdFBhY2thZ2VSZXN1bHQ7XG4gIHBhdGg6IHN0cmluZztcbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIGxhdGVzdF92ZXJzaW9uX2NvbnRyYWN0X3R5cGVfaWQsXG4gICAgaWNvbl91cmwsXG4gICAgY29udHJhY3RfcGFja2FnZV9oYXNoLFxuICAgIG5hbWUsXG4gIH0gPSBjb250cmFjdFBhY2thZ2U7XG4gIHJldHVybiAoXG4gICAgPEZsZXhSb3cgaXRlbXNTcGFjaW5nPXs0fSBhbGlnbj17J2NlbnRlcid9PlxuICAgICAgPENvbnRyYWN0SWNvblxuICAgICAgICBjb250cmFjdFR5cGVJZD17bGF0ZXN0X3ZlcnNpb25fY29udHJhY3RfdHlwZV9pZH1cbiAgICAgICAgc3JjPXtpY29uX3VybH1cbiAgICAgICAgbG9hZGluZz17IWNvbnRyYWN0UGFja2FnZX1cbiAgICAgICAgc2l6ZT1cInNtYWxsXCJcbiAgICAgIC8+XG4gICAgICA8Qm9keVRleHQgc2l6ZT17M30gdmFyaWF0aW9uPXsnZGFya0dyYXknfSBub1dyYXAgc2NhbGU9eydzbSd9PlxuICAgICAgICB7Y29udHJhY3RfcGFja2FnZV9oYXNoICYmIChcbiAgICAgICAgICA8TGlua1xuICAgICAgICAgICAgaHJlZj17cGF0aH1cbiAgICAgICAgICAgIGFyaWFEZXNjcmlwdGlvbj17J0xpbmsgdG8gY29udHJhY3QgcGFja2FnZSBkZXRhaWxzJ31cbiAgICAgICAgICAgIGNvbG9yPXsncHJpbWFyeUJsdWUnfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtuYW1lfVxuICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgKX1cbiAgICAgIDwvQm9keVRleHQ+XG4gICAgPC9GbGV4Um93PlxuICApO1xufTtcblxuY29uc3QgT2ZmZXJNYXJrZXRBY3Rpb24gPSAoe1xuICBkZXBsb3ksXG4gIGNvbGxlY3Rpb25IYXNoLFxuICBuZnRUb2tlbklkcyxcbn06IHtcbiAgZGVwbG95OiBEZXBsb3k7XG4gIGNvbGxlY3Rpb25IYXNoOiBzdHJpbmc7XG4gIG5mdFRva2VuSWRzOiBzdHJpbmdbXSB8IG51bGw7XG59KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhbW91bnQsXG4gICAgZW50cnlQb2ludCxcbiAgICBhcmdzLFxuICAgIHRpbWVUcmFuc2FjdGlvbkN1cnJlbmN5UmF0ZSxcbiAgICBjb250cmFjdFBhY2thZ2UsXG4gIH0gPSBkZXBsb3k7XG5cbiAgY29uc3Qgb2ZmZXJlckhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLm9mZmVyZXIsXG4gICAgJ0FjY291bnQnLFxuICApO1xuXG4gIGNvbnN0IHtcbiAgICBnZXRBY2NvdW50SW5mbyxcbiAgICBnZXRQdWJsaWNLZXlBY2NvdW50SGFzaCxcbiAgICBnZXRDb250cmFjdFBhY2thZ2VJbmZvQnlIYXNoLFxuICAgIGNzcHJMaXZlRG9tYWluUGF0aCxcbiAgfSA9IHVzZURlcGxveUFjdGlvbkRhdGFDb250ZXh0KCk7XG5cbiAgY29uc3QgYWNjb3VudEluZm8gPSBvZmZlcmVySGFzaCAmJiBnZXRBY2NvdW50SW5mbyhvZmZlcmVySGFzaD8uaGFzaCk7XG4gIGNvbnN0IHB1YmxpY0tleSA9IG9mZmVyZXJIYXNoICYmIGdldFB1YmxpY0tleUFjY291bnRIYXNoKG9mZmVyZXJIYXNoPy5oYXNoKTtcbiAgY29uc3QgYWNjb3VudEluZm9EZXRhaWxzID0gZGVyaXZlQWNjb3VudEluZm8oXG4gICAgYWNjb3VudEluZm8/LmFjY291bnRfaW5mbyB8fCBhY2NvdW50SW5mbz8uY2VudHJhbGl6ZWRfYWNjb3VudF9pbmZvLFxuICApO1xuICBjb25zdCBsb2dvID0gYWNjb3VudEluZm9EZXRhaWxzICYmIGFjY291bnRJbmZvRGV0YWlscy5sb2dvO1xuICBjb25zdCBuYW1lID0gYWNjb3VudEluZm9EZXRhaWxzPy5uYW1lO1xuICBjb25zdCBjc3ByTmFtZSA9IGFjY291bnRJbmZvPy5jc3ByX25hbWU7XG5cbiAgcmV0dXJuIChcbiAgICA8RmxleFJvdyBhbGlnbj17J2NlbnRlcid9IGl0ZW1zU3BhY2luZz17OH0+XG4gICAgICA8Qm9keVRleHQgbW9ub3R5cGUgc2l6ZT17M30gd29yZEJyZWFrIG5vV3JhcCB2YXJpYXRpb249eydibGFjayd9PlxuICAgICAgICB7bWFya2V0QWN0aW9uTmFtZU1hcFtlbnRyeVBvaW50Py5uYW1lIHx8ICcnXX1cbiAgICAgIDwvQm9keVRleHQ+XG4gICAgICB7YW1vdW50ICYmIChcbiAgICAgICAgPD5cbiAgICAgICAgICA8Qm9keVRleHQgc2l6ZT17M30gdmFyaWF0aW9uPVwiZGFya0dyYXlcIj5cbiAgICAgICAgICAgIG9mXG4gICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICA8RGVwbG95RmlhdEFtb3VudFxuICAgICAgICAgICAgYW1vdW50PXthbW91bnR9XG4gICAgICAgICAgICByYXRlPXt0aW1lVHJhbnNhY3Rpb25DdXJyZW5jeVJhdGV9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC8+XG4gICAgICApfVxuICAgICAge2NvbGxlY3Rpb25IYXNoICYmIChcbiAgICAgICAgPD5cbiAgICAgICAgICA8Qm9keVRleHQgc2l6ZT17M30gdmFyaWF0aW9uPVwiZGFya0dyYXlcIj5cbiAgICAgICAgICAgIGZvclxuICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgICAgPE5mdENvbGxlY3Rpb25JZGVudGlmaWVyXG4gICAgICAgICAgICBwYXRoPXtgJHtjc3ByTGl2ZURvbWFpblBhdGh9L2NvbnRyYWN0LXBhY2thZ2UvJHtjb2xsZWN0aW9uSGFzaH1gfVxuICAgICAgICAgICAgY29udHJhY3RQYWNrYWdlPXtnZXRDb250cmFjdFBhY2thZ2VJbmZvQnlIYXNoKGNvbGxlY3Rpb25IYXNoKX1cbiAgICAgICAgICAvPlxuICAgICAgICA8Lz5cbiAgICAgICl9XG4gICAgICA8TmZ0VG9rZW5JZHNcbiAgICAgICAgbmZ0VG9rZW5JZHM9e25mdFRva2VuSWRzfVxuICAgICAgICBjb2xsZWN0aW9uSGFzaD17Y29sbGVjdGlvbkhhc2h9XG4gICAgICAgIGNzcHJMaXZlRG9tYWluUGF0aD17Y3NwckxpdmVEb21haW5QYXRofVxuICAgICAgLz5cbiAgICAgIHtvZmZlcmVySGFzaCAmJiAoXG4gICAgICAgIDxGbGV4Um93IGl0ZW1zU3BhY2luZz17Nn0gYWxpZ249eydjZW50ZXInfT5cbiAgICAgICAgICA8Qm9keVRleHQgc2l6ZT17M30gdmFyaWF0aW9uPXsnZGFya0dyYXknfT5cbiAgICAgICAgICAgIGZyb21cbiAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgIDxBZGRyZXNzXG4gICAgICAgICAgICBsb2dvPXtsb2dvfVxuICAgICAgICAgICAgbmFtZT17bmFtZX1cbiAgICAgICAgICAgIGhhc2g9e3B1YmxpY0tleSB8fCBvZmZlcmVySGFzaC5oYXNofVxuICAgICAgICAgICAgY3Nwck5hbWU9e2NzcHJOYW1lfVxuICAgICAgICAgICAgbG9hZGluZz17IW9mZmVyZXJIYXNofVxuICAgICAgICAgICAgbmF2aWdhdGVUb1BhdGg9e2Ake2NzcHJMaXZlRG9tYWluUGF0aH0vYWNjb3VudC8ke3B1YmxpY0tleSB8fCBvZmZlcmVySGFzaC5oYXNofWB9XG4gICAgICAgICAgICBhdmF0YXJTaXplPXsnc21hbGwnfVxuICAgICAgICAgICAgaGFzaEZvbnRTaXplPXsnc20nfVxuICAgICAgICAgICAgbWluaWZpZWRDb3B5Tm90aWZpY2F0aW9uXG4gICAgICAgICAgLz5cbiAgICAgICAgPC9GbGV4Um93PlxuICAgICAgKX1cbiAgICAgIDxCb2R5VGV4dCBzaXplPXszfSB2YXJpYXRpb249eydkYXJrR3JheSd9PlxuICAgICAgICBvblxuICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgIDxNYXJrZXRDb250cmFjdElkZW50aWZpZXJcbiAgICAgICAgY29udHJhY3RQYWNrYWdlPXtjb250cmFjdFBhY2thZ2V9XG4gICAgICAgIHBhdGg9e2Ake2NzcHJMaXZlRG9tYWluUGF0aH0vY29udHJhY3QtcGFja2FnZS8ke2NvbnRyYWN0UGFja2FnZS5jb250cmFjdF9wYWNrYWdlX2hhc2h9YH1cbiAgICAgIC8+XG4gICAgPC9GbGV4Um93PlxuICApO1xufTtcblxuY29uc3QgTGlzdE1hcmtldEFjdGlvbiA9ICh7XG4gIGRlcGxveSxcbiAgY29sbGVjdGlvbkhhc2gsXG4gIG5mdFRva2VuSWRzLFxufToge1xuICBkZXBsb3k6IERlcGxveTtcbiAgY29sbGVjdGlvbkhhc2g6IHN0cmluZztcbiAgbmZ0VG9rZW5JZHM6IHN0cmluZ1tdIHwgbnVsbDtcbn0pID0+IHtcbiAgY29uc3QgeyBlbnRyeVBvaW50LCBjb250cmFjdFBhY2thZ2UgfSA9IGRlcGxveTtcbiAgY29uc3QgeyBjc3ByTGl2ZURvbWFpblBhdGgsIGdldENvbnRyYWN0UGFja2FnZUluZm9CeUhhc2ggfSA9XG4gICAgdXNlRGVwbG95QWN0aW9uRGF0YUNvbnRleHQoKTtcbiAgY29uc3QgY29udHJhY3RJZGVudGlmaWVyUHJlZml4ID1cbiAgICBlbnRyeVBvaW50Py5uYW1lID09PSBDc3ByTWFya2V0RW50cnlQb2ludC5kZWxpc3RfdG9rZW4gPyAnZnJvbScgOiAnb24nO1xuXG4gIHJldHVybiAoXG4gICAgPEZsZXhSb3cgYWxpZ249eydjZW50ZXInfSBpdGVtc1NwYWNpbmc9ezh9PlxuICAgICAgPEJvZHlUZXh0IG1vbm90eXBlIHNpemU9ezN9IHdvcmRCcmVhayBub1dyYXAgdmFyaWF0aW9uPXsnYmxhY2snfT5cbiAgICAgICAge21hcmtldEFjdGlvbk5hbWVNYXBbZW50cnlQb2ludD8ubmFtZSB8fCAnJ119XG4gICAgICA8L0JvZHlUZXh0PlxuICAgICAge2NvbGxlY3Rpb25IYXNoICYmIChcbiAgICAgICAgPE5mdENvbGxlY3Rpb25JZGVudGlmaWVyXG4gICAgICAgICAgcGF0aD17YCR7Y3NwckxpdmVEb21haW5QYXRofS9jb250cmFjdC1wYWNrYWdlLyR7Y29sbGVjdGlvbkhhc2h9YH1cbiAgICAgICAgICBjb250cmFjdFBhY2thZ2U9e2dldENvbnRyYWN0UGFja2FnZUluZm9CeUhhc2goY29sbGVjdGlvbkhhc2gpfVxuICAgICAgICAvPlxuICAgICAgKX1cbiAgICAgIDxOZnRUb2tlbklkc1xuICAgICAgICBuZnRUb2tlbklkcz17bmZ0VG9rZW5JZHN9XG4gICAgICAgIGNvbGxlY3Rpb25IYXNoPXtjb2xsZWN0aW9uSGFzaH1cbiAgICAgICAgY3NwckxpdmVEb21haW5QYXRoPXtjc3ByTGl2ZURvbWFpblBhdGh9XG4gICAgICAvPlxuICAgICAgPEJvZHlUZXh0IHNpemU9ezN9IHZhcmlhdGlvbj17J2RhcmtHcmF5J30+XG4gICAgICAgIHtjb250cmFjdElkZW50aWZpZXJQcmVmaXh9XG4gICAgICA8L0JvZHlUZXh0PlxuICAgICAgPE1hcmtldENvbnRyYWN0SWRlbnRpZmllclxuICAgICAgICBjb250cmFjdFBhY2thZ2U9e2NvbnRyYWN0UGFja2FnZX1cbiAgICAgICAgcGF0aD17YCR7Y3NwckxpdmVEb21haW5QYXRofS9jb250cmFjdC1wYWNrYWdlLyR7Y29udHJhY3RQYWNrYWdlLmNvbnRyYWN0X3BhY2thZ2VfaGFzaH1gfVxuICAgICAgLz5cbiAgICA8L0ZsZXhSb3c+XG4gICk7XG59O1xuXG5jb25zdCBEZWZhdWx0TWFya2V0QWN0aW9uID0gKHsgZGVwbG95IH06IHsgZGVwbG95OiBEZXBsb3kgfSkgPT4ge1xuICBjb25zdCB7IGVudHJ5UG9pbnQsIGNvbnRyYWN0UGFja2FnZSB9ID0gZGVwbG95O1xuICBjb25zdCB7IGNzcHJMaXZlRG9tYWluUGF0aCB9ID0gdXNlRGVwbG95QWN0aW9uRGF0YUNvbnRleHQoKTtcbiAgcmV0dXJuIChcbiAgICA8RmxleFJvdyBhbGlnbj17J2NlbnRlcid9IGl0ZW1zU3BhY2luZz17OH0+XG4gICAgICA8Qm9keVRleHQgbW9ub3R5cGUgc2l6ZT17M30gd29yZEJyZWFrIG5vV3JhcCB2YXJpYXRpb249eydibGFjayd9PlxuICAgICAgICB7ZW50cnlQb2ludD8ubmFtZX1cbiAgICAgIDwvQm9keVRleHQ+XG4gICAgICA8Qm9keVRleHQgc2l6ZT17M30gdmFyaWF0aW9uPXsnZGFya0dyYXknfT5cbiAgICAgICAgd2l0aFxuICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgIDxNYXJrZXRDb250cmFjdElkZW50aWZpZXJcbiAgICAgICAgY29udHJhY3RQYWNrYWdlPXtjb250cmFjdFBhY2thZ2V9XG4gICAgICAgIHBhdGg9e2Ake2NzcHJMaXZlRG9tYWluUGF0aH0vY29udHJhY3QtcGFja2FnZS8ke2NvbnRyYWN0UGFja2FnZS5jb250cmFjdF9wYWNrYWdlX2hhc2h9YH1cbiAgICAgIC8+XG4gICAgPC9GbGV4Um93PlxuICApO1xufTtcblxuY29uc3QgRGVwbG95QWN0aW9uTWFya2V0ID0gKHsgZGVwbG95IH06IHsgZGVwbG95OiBEZXBsb3kgfSkgPT4ge1xuICBjb25zdCB7IGVudHJ5UG9pbnQsIGFyZ3MgfSA9IGRlcGxveTtcblxuICBjb25zdCBlbnRyeVBvaW50TmFtZSA9IGVudHJ5UG9pbnQ/Lm5hbWUgfHwgJyc7XG5cbiAgY29uc3QgY29sbGVjdGlvbkhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLmNvbGxlY3Rpb24sXG4gICAgJ0hhc2gnLFxuICApO1xuXG4gIGNvbnN0IGlzT2ZmZXJBY3Rpb24gPVxuICAgIGVudHJ5UG9pbnROYW1lID09PSBDc3ByTWFya2V0RW50cnlQb2ludC5hY2NlcHRfb2ZmZXIgfHxcbiAgICBlbnRyeVBvaW50TmFtZSA9PT0gQ3Nwck1hcmtldEVudHJ5UG9pbnQubWFrZV9vZmZlciB8fFxuICAgIGVudHJ5UG9pbnROYW1lID09PSBDc3ByTWFya2V0RW50cnlQb2ludC5jYW5jZWxfb2ZmZXI7XG5cbiAgY29uc3QgaXNMaXN0QWN0aW9uID1cbiAgICBlbnRyeVBvaW50TmFtZSA9PT0gQ3Nwck1hcmtldEVudHJ5UG9pbnQuZGVsaXN0X3Rva2VuIHx8XG4gICAgZW50cnlQb2ludE5hbWUgPT09IENzcHJNYXJrZXRFbnRyeVBvaW50Lmxpc3RfdG9rZW47XG5cbiAgY29uc3QgbmZ0VG9rZW5JZHMgPSBnZXROZnRUb2tlbklkc0Zyb21Bcmd1bWVudHMoZGVwbG95LmFyZ3MpO1xuXG4gIGlmIChpc09mZmVyQWN0aW9uICYmIGNvbGxlY3Rpb25IYXNoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxPZmZlck1hcmtldEFjdGlvblxuICAgICAgICBkZXBsb3k9e2RlcGxveX1cbiAgICAgICAgY29sbGVjdGlvbkhhc2g9e2NvbGxlY3Rpb25IYXNoPy5oYXNofVxuICAgICAgICBuZnRUb2tlbklkcz17bmZ0VG9rZW5JZHN9XG4gICAgICAvPlxuICAgICk7XG4gIH1cblxuICBpZiAoaXNMaXN0QWN0aW9uICYmIGNvbGxlY3Rpb25IYXNoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxMaXN0TWFya2V0QWN0aW9uXG4gICAgICAgIGRlcGxveT17ZGVwbG95fVxuICAgICAgICBjb2xsZWN0aW9uSGFzaD17Y29sbGVjdGlvbkhhc2g/Lmhhc2h9XG4gICAgICAgIG5mdFRva2VuSWRzPXtuZnRUb2tlbklkc31cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiA8RGVmYXVsdE1hcmtldEFjdGlvbiBkZXBsb3k9e2RlcGxveX0gLz47XG59O1xuXG5leHBvcnQgZGVmYXVsdCBEZXBsb3lBY3Rpb25NYXJrZXQ7XG4iXX0=