import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import styled from 'styled-components';
import Skeleton from 'react-loading-skeleton';
import DeployActionAssociatedKeys from './components/DeployActionAssociatedKeys';
import { DeployResultNft } from './components/DeployResultNft';
import { DeployResultCep18 } from './components/DeployResultCep18';
import TransferActionRow from './components/TransferActionRow';
import { DeployActionDataProvider } from './services/deploy-action-context';
import FlexRow from '../flex-row/flex-row';
import BodyText from '../body-text/body-text';
import FlexColumn from '../flex-column/flex-column';
import ExpandCollapsedButton from '../expand-collapsed/expand-collapsed-button';
import { getDeployStatus, Status } from '../deploy-status/deploy-status';
const MAXIMUM_VISIBLE_ROWS = 3;
var DeployResultRowType;
(function (DeployResultRowType) {
    DeployResultRowType[DeployResultRowType["NFT"] = 1] = "NFT";
    DeployResultRowType[DeployResultRowType["FT"] = 2] = "FT";
    DeployResultRowType[DeployResultRowType["UNI"] = 3] = "UNI";
    DeployResultRowType[DeployResultRowType["LS"] = 4] = "LS";
    DeployResultRowType[DeployResultRowType["NT"] = 5] = "NT";
})(DeployResultRowType || (DeployResultRowType = {}));
export var ResultRowVariation;
(function (ResultRowVariation) {
    ResultRowVariation["default"] = "default";
    ResultRowVariation["gray"] = "gray";
})(ResultRowVariation || (ResultRowVariation = {}));
const sortActionsByTypeAndOrder = (deploy) => {
    const nftActions = (deploy.nftActions || []).map((action) => ({
        ...action,
        type: DeployResultRowType.NFT,
    }));
    const ftActions = (deploy.ftActions || []).map((action) => ({
        ...action,
        type: DeployResultRowType.FT,
    }));
    const sortedTransfers = (deploy.transfers || [])
        .sort((transferA, transferB) => transferA.transfer_index - transferB.transfer_index)
        .map((action) => ({
        ...action,
        type: DeployResultRowType.NT,
    }));
    const sortedTokenActions = [...nftActions, ...ftActions].sort((actionA, actionB) => actionA.transform_idx - actionB.transform_idx);
    return [...sortedTransfers, ...sortedTokenActions];
};
const DefaultResultItem = styled(FlexRow)(({ theme }) => ({
    padding: '14px 0',
    ':not(:first-child):after': {
        content: "''",
        position: 'absolute',
        left: 0,
        right: 0,
        top: 0,
        borderBottom: theme.border.tableRowSeparator,
    },
    position: 'relative',
}));
const GrayResultItem = styled(FlexRow)(({ theme }) => ({
    borderRadius: '4px',
    background: `${theme.styleguideColors.backgroundSecondary}80`,
    padding: '10px 16px',
    position: 'relative',
    span: {
        fontSize: '13px',
    },
    '> *': {
        flexWrap: 'wrap',
    },
    ':not(:first-child)': {
        marginTop: '8px',
    },
}));
const ResultItemWrapper = ({ variation, ...props }) => {
    return variation === ResultRowVariation.default ? (_jsx(DefaultResultItem, { ...props })) : (_jsx(GrayResultItem, { ...props }));
};
export const DeployResultRowComponent = (props) => {
    const { deploy, deployRawData, loading, actionIdentificationHashes, variation = ResultRowVariation.default, shouldCollapse = false, actionComponents, } = props;
    const [isCollapsed, setCollapsed] = useState(shouldCollapse);
    const handleExpandList = () => {
        setCollapsed(!isCollapsed);
    };
    const deployStatus = getDeployStatus(deploy);
    if (deployStatus === Status.Error) {
        return null;
    }
    if (loading) {
        return (_jsx(ResultItemWrapper, { variation: variation, children: _jsx(BodyText, { size: 3, scale: 'xs', lineHeight: 'xs', children: _jsx(Skeleton, {}) }) }));
    }
    if (deploy.contractHash ===
        actionIdentificationHashes.associated_keys_contract_hash) {
        return (_jsx(ResultItemWrapper, { variation: variation, children: _jsx(DeployActionAssociatedKeys, { deploy: deploy, deployRawData: deployRawData, renderAsResultAction: true }) }));
    }
    const showResultRow = deploy.transfers || deploy.nftActions || deploy.ftActions;
    if (!showResultRow) {
        return null;
    }
    const sortedActions = sortActionsByTypeAndOrder(deploy);
    const getActionElementToRender = (action) => {
        switch (action.type) {
            case DeployResultRowType.NFT:
                return (_jsx(DeployResultNft, { nftAction: action }, action.transform_idx));
            case DeployResultRowType.FT:
                return (_jsx(DeployResultCep18, { ftAction: action }, action.transform_idx));
            case DeployResultRowType.NT:
                return (_jsx(TransferActionRow, { loading: loading, timeTransactionCurrencyRate: deploy.timeTransactionCurrencyRate, transfer: action, actionPoolAccountHash: actionIdentificationHashes.auction_pool_account_hash, renderAsResultAction: true }, action.transfer_index));
            default:
                return null;
        }
    };
    const sortedActionComponents = sortedActions.map((action) => getActionElementToRender(action));
    const combinedActionComponents = [
        ...sortedActionComponents,
        ...(actionComponents || []),
    ];
    return (_jsxs(FlexColumn, { children: [combinedActionComponents?.length
                ? combinedActionComponents
                    .filter((action, i) => isCollapsed ? i < MAXIMUM_VISIBLE_ROWS : true)
                    .map((action, idx) => (_jsx(ResultItemWrapper, { variation: variation, children: action }, `actions-${idx}`)))
                : null, shouldCollapse &&
                combinedActionComponents?.length > MAXIMUM_VISIBLE_ROWS ? (_jsx(ExpandCollapsedButton, { collapsedLabel: _jsxs(_Fragment, { children: [_jsx(_Fragment, { children: "View all " }), combinedActionComponents?.length, _jsx(_Fragment, { children: " results" })] }), expandedLabel: _jsx(_Fragment, { children: "Collapse results " }), onExpand: handleExpandList })) : null] }));
};
export const DeployResultRow = (props) => {
    const { getAccountInfo, getContractPackageInfoByHash, getContractInfoByHash, csprLiveDomainPath, ...rest } = props;
    return (_jsx(DeployActionDataProvider, { getAccountInfo: getAccountInfo, getContractPackageInfoByHash: getContractPackageInfoByHash, getContractInfoByHash: getContractInfoByHash, csprLiveDomainPath: csprLiveDomainPath, children: _jsx(DeployResultRowComponent, { ...rest }) }));
};
export default DeployResultRow;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVwbG95LXJlc3VsdC1yb3cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZGVwbG95LWFjdGlvbnMvZGVwbG95LXJlc3VsdC1yb3cudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFjLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQ3hDLE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sUUFBUSxNQUFNLHdCQUF3QixDQUFDO0FBQzlDLE9BQU8sMEJBQTBCLE1BQU0seUNBQXlDLENBQUM7QUFDakYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ25FLE9BQU8saUJBQWlCLE1BQU0sZ0NBQWdDLENBQUM7QUFFL0QsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFXNUUsT0FBTyxPQUFPLE1BQU0sc0JBQXNCLENBQUM7QUFDM0MsT0FBTyxRQUFRLE1BQU0sd0JBQXdCLENBQUM7QUFDOUMsT0FBTyxVQUFVLE1BQU0sNEJBQTRCLENBQUM7QUFDcEQsT0FBTyxxQkFBcUIsTUFBTSw2Q0FBNkMsQ0FBQztBQUNoRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRXpFLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxDQUFDO0FBRS9CLElBQUssbUJBTUo7QUFORCxXQUFLLG1CQUFtQjtJQUN0QiwyREFBUyxDQUFBO0lBQ1QseURBQVEsQ0FBQTtJQUNSLDJEQUFTLENBQUE7SUFDVCx5REFBUSxDQUFBO0lBQ1IseURBQVEsQ0FBQTtBQUNWLENBQUMsRUFOSSxtQkFBbUIsS0FBbkIsbUJBQW1CLFFBTXZCO0FBRUQsTUFBTSxDQUFOLElBQVksa0JBR1g7QUFIRCxXQUFZLGtCQUFrQjtJQUM1Qix5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cUIsRUFBRSxxQkFBcUIsRUFDNUMsa0JBQWtCLEVBQUUsa0JBQWtCLFlBRXRDLEtBQUMsd0JBQXdCLE9BQUssSUFBSSxHQUFJLEdBQ2IsQ0FDNUIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGVBQWUsZUFBZSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgU2tlbGV0b24gZnJvbSAncmVhY3QtbG9hZGluZy1za2VsZXRvbic7XG5pbXBvcnQgRGVwbG95QWN0aW9uQXNzb2NpYXRlZEtleXMgZnJvbSAnLi9jb21wb25lbnRzL0RlcGxveUFjdGlvbkFzc29jaWF0ZWRLZXlzJztcbmltcG9ydCB7IERlcGxveVJlc3VsdE5mdCB9IGZyb20gJy4vY29tcG9uZW50cy9EZXBsb3lSZXN1bHROZnQnO1xuaW1wb3J0IHsgRGVwbG95UmVzdWx0Q2VwMTggfSBmcm9tICcuL2NvbXBvbmVudHMvRGVwbG95UmVzdWx0Q2VwMTgnO1xuaW1wb3J0IFRyYW5zZmVyQWN0aW9uUm93IGZyb20gJy4vY29tcG9uZW50cy9UcmFuc2ZlckFjdGlvblJvdyc7XG5pbXBvcnQgeyBBY3Rpb25JZGVudGlmaWNhdGlvbkhhc2hlc1R5cGUgfSBmcm9tICcuL2RlcGxveS1hY3Rpb24tcm93JztcbmltcG9ydCB7IERlcGxveUFjdGlvbkRhdGFQcm92aWRlciB9IGZyb20gJy4vc2VydmljZXMvZGVwbG95LWFjdGlvbi1jb250ZXh0JztcbmltcG9ydCB7XG4gIEFjY291bnRJbmZvUmVzdWx0LFxuICBDb250cmFjdFJlc3VsdCxcbiAgRGF0YVJlc3BvbnNlLFxuICBEZXBsb3ksIERlcGxveUNvbnRyYWN0UGFja2FnZVJlc3VsdCxcbiAgRGVwbG95VHJhbnNmZXJSZXN1bHQsXG4gIEZUQWN0aW9uc1Jlc3VsdCxcbiAgR2V0RGVwbG95UmVzdWx0LFxuICBOZnRBY3Rpb25zUmVzdWx0LFxufSBmcm9tICcuLi8uLi90eXBlcy90eXBlcyc7XG5pbXBvcnQgRmxleFJvdyBmcm9tICcuLi9mbGV4LXJvdy9mbGV4LXJvdyc7XG5pbXBvcnQgQm9keVRleHQgZnJvbSAnLi4vYm9keS10ZXh0L2JvZHktdGV4dCc7XG5pbXBvcnQgRmxleENvbHVtbiBmcm9tICcuLi9mbGV4LWNvbHVtbi9mbGV4LWNvbHVtbic7XG5pbXBvcnQgRXhwYW5kQ29sbGFwc2VkQnV0dG9uIGZyb20gJy4uL2V4cGFuZC1jb2xsYXBzZWQvZXhwYW5kLWNvbGxhcHNlZC1idXR0b24nO1xuaW1wb3J0IHsgZ2V0RGVwbG95U3RhdHVzLCBTdGF0dXMgfSBmcm9tICcuLi9kZXBsb3ktc3RhdHVzL2RlcGxveS1zdGF0dXMnO1xuXG5jb25zdCBNQVhJTVVNX1ZJU0lCTEVfUk9XUyA9IDM7XG5cbmVudW0gRGVwbG95UmVzdWx0Um93VHlwZSB7XG4gICdORlQnID0gMSxcbiAgJ0ZUJyA9IDIsXG4gICdVTkknID0gMyxcbiAgJ0xTJyA9IDQsXG4gICdOVCcgPSA1LFxufVxuXG5leHBvcnQgZW51bSBSZXN1bHRSb3dWYXJpYXRpb24ge1xuICBkZWZhdWx0ID0gJ2RlZmF1bHQnLFxuICBncmF5ID0gJ2dyYXknLFxufVxuXG5jb25zdCBzb3J0QWN0aW9uc0J5VHlwZUFuZE9yZGVyID0gKGRlcGxveTogRGVwbG95KSA9PiB7XG4gIGNvbnN0IG5mdEFjdGlvbnM6IE5mdEFjdGlvbnNSZXN1bHRbXSA9IChkZXBsb3kubmZ0QWN0aW9ucyB8fCBbXSkubWFwKFxuICAgIChhY3Rpb24pID0+ICh7XG4gICAgICAuLi5hY3Rpb24sXG4gICAgICB0eXBlOiBEZXBsb3lSZXN1bHRSb3dUeXBlLk5GVCxcbiAgICB9KSxcbiAgKTtcbiAgY29uc3QgZnRBY3Rpb25zOiBGVEFjdGlvbnNSZXN1bHRbXSA9IChkZXBsb3kuZnRBY3Rpb25zIHx8IFtdKS5tYXAoXG4gICAgKGFjdGlvbikgPT4gKHtcbiAgICAgIC4uLmFjdGlvbixcbiAgICAgIHR5cGU6IERlcGxveVJlc3VsdFJvd1R5cGUuRlQsXG4gICAgfSksXG4gICk7XG5cbiAgY29uc3Qgc29ydGVkVHJhbnNmZXJzOiBEZXBsb3lUcmFuc2ZlclJlc3VsdFtdID0gKGRlcGxveS50cmFuc2ZlcnMgfHwgW10pXG4gICAgLnNvcnQoXG4gICAgICAodHJhbnNmZXJBLCB0cmFuc2ZlckIpID0+XG4gICAgICAgIHRyYW5zZmVyQS50cmFuc2Zlcl9pbmRleCAtIHRyYW5zZmVyQi50cmFuc2Zlcl9pbmRleCxcbiAgICApXG4gICAgLm1hcCgoYWN0aW9uKSA9PiAoe1xuICAgICAgLi4uYWN0aW9uLFxuICAgICAgdHlwZTogRGVwbG95UmVzdWx0Um93VHlwZS5OVCxcbiAgICB9KSk7XG5cbiAgY29uc3Qgc29ydGVkVG9rZW5BY3Rpb25zID0gWy4uLm5mdEFjdGlvbnMsIC4uLmZ0QWN0aW9uc10uc29ydChcbiAgICAoYWN0aW9uQSwgYWN0aW9uQikgPT4gYWN0aW9uQS50cmFuc2Zvcm1faWR4IC0gYWN0aW9uQi50cmFuc2Zvcm1faWR4LFxuICApO1xuXG4gIHJldHVybiBbLi4uc29ydGVkVHJhbnNmZXJzLCAuLi5zb3J0ZWRUb2tlbkFjdGlvbnNdO1xufTtcblxuY29uc3QgRGVmYXVsdFJlc3VsdEl0ZW0gPSBzdHlsZWQoRmxleFJvdykoKHsgdGhlbWUgfSkgPT4gKHtcbiAgcGFkZGluZzogJzE0cHggMCcsXG4gICc6bm90KDpmaXJzdC1jaGlsZCk6YWZ0ZXInOiB7XG4gICAgY29udGVudDogXCInJ1wiLFxuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgIGxlZnQ6IDAsXG4gICAgcmlnaHQ6IDAsXG4gICAgdG9wOiAwLFxuICAgIGJvcmRlckJvdHRvbTogdGhlbWUuYm9yZGVyLnRhYmxlUm93U2VwYXJhdG9yLFxuICB9LFxuXG4gIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxufSkpO1xuXG5jb25zdCBHcmF5UmVzdWx0SXRlbSA9IHN0eWxlZChGbGV4Um93KSgoeyB0aGVtZSB9KSA9PiAoe1xuICBib3JkZXJSYWRpdXM6ICc0cHgnLFxuICBiYWNrZ3JvdW5kOiBgJHt0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmJhY2tncm91bmRTZWNvbmRhcnl9ODBgLFxuICBwYWRkaW5nOiAnMTBweCAxNnB4JyxcbiAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gIHNwYW46IHtcbiAgICBmb250U2l6ZTogJzEzcHgnLFxuICB9LFxuICAnPiAqJzoge1xuICAgIGZsZXhXcmFwOiAnd3JhcCcsXG4gIH0sXG4gICc6bm90KDpmaXJzdC1jaGlsZCknOiB7XG4gICAgbWFyZ2luVG9wOiAnOHB4JyxcbiAgfSxcbn0pKTtcblxuY29uc3QgUmVzdWx0SXRlbVdyYXBwZXIgPSAoeyB2YXJpYXRpb24sIC4uLnByb3BzIH0pID0+IHtcbiAgcmV0dXJuIHZhcmlhdGlvbiA9PT0gUmVzdWx0Um93VmFyaWF0aW9uLmRlZmF1bHQgPyAoXG4gICAgPERlZmF1bHRSZXN1bHRJdGVtIHsuLi5wcm9wc30gLz5cbiAgKSA6IChcbiAgICA8R3JheVJlc3VsdEl0ZW0gey4uLnByb3BzfSAvPlxuICApO1xufTtcblxuaW50ZXJmYWNlIERlcGxveVJlc3VsdFJvd0NvbXBvbmVudFByb3BzIHtcbiAgZGVwbG95OiBEZXBsb3k7XG4gIGxvYWRpbmc6IGJvb2xlYW47XG4gIGFjdGlvbklkZW50aWZpY2F0aW9uSGFzaGVzOiBBY3Rpb25JZGVudGlmaWNhdGlvbkhhc2hlc1R5cGU7XG4gIGRlcGxveVJhd0RhdGE/OiBEYXRhUmVzcG9uc2U8R2V0RGVwbG95UmVzdWx0PiB8IG51bGw7XG4gIGFjdGlvbkNvbXBvbmVudHM/OiBSZWFjdC5SZWFjdEVsZW1lbnRbXSB8IG51bGw7XG4gIHZhcmlhdGlvbj86IFJlc3VsdFJvd1ZhcmlhdGlvbjtcbiAgc2hvdWxkQ29sbGFwc2U/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgRGVwbG95UmVzdWx0Um93Q29tcG9uZW50ID0gKFxuICBwcm9wczogRGVwbG95UmVzdWx0Um93Q29tcG9uZW50UHJvcHMsXG4pID0+IHtcbiAgY29uc3Qge1xuICAgIGRlcGxveSxcbiAgICBkZXBsb3lSYXdEYXRhLFxuICAgIGxvYWRpbmcsXG4gICAgYWN0aW9uSWRlbnRpZmljYXRpb25IYXNoZXMsXG4gICAgdmFyaWF0aW9uID0gUmVzdWx0Um93VmFyaWF0aW9uLmRlZmF1bHQsXG4gICAgc2hvdWxkQ29sbGFwc2UgPSBmYWxzZSxcbiAgICBhY3Rpb25Db21wb25lbnRzLFxuICB9ID0gcHJvcHM7XG4gIGNvbnN0IFtpc0NvbGxhcHNlZCwgc2V0Q29sbGFwc2VkXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHNob3VsZENvbGxhcHNlKTtcbiAgY29uc3QgaGFuZGxlRXhwYW5kTGlzdCA9ICgpID0+IHtcbiAgICBzZXRDb2xsYXBzZWQoIWlzQ29sbGFwc2VkKTtcbiAgfTtcblxuICBjb25zdCBkZXBsb3lTdGF0dXMgPSBnZXREZXBsb3lTdGF0dXMoZGVwbG95KTtcblxuICBpZiAoZGVwbG95U3RhdHVzID09PSBTdGF0dXMuRXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmIChsb2FkaW5nKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxSZXN1bHRJdGVtV3JhcHBlciB2YXJpYXRpb249e3ZhcmlhdGlvbn0+XG4gICAgICAgIDxCb2R5VGV4dCBzaXplPXszfSBzY2FsZT17J3hzJ30gbGluZUhlaWdodD17J3hzJ30+XG4gICAgICAgICAgPFNrZWxldG9uIC8+XG4gICAgICAgIDwvQm9keVRleHQ+XG4gICAgICA8L1Jlc3VsdEl0ZW1XcmFwcGVyPlxuICAgICk7XG4gIH1cblxuICBpZiAoXG4gICAgZGVwbG95LmNvbnRyYWN0SGFzaCA9PT1cbiAgICBhY3Rpb25JZGVudGlmaWNhdGlvbkhhc2hlcy5hc3NvY2lhdGVkX2tleXNfY29udHJhY3RfaGFzaFxuICApIHtcbiAgICByZXR1cm4gKFxuICAgICAgPFJlc3VsdEl0ZW1XcmFwcGVyIHZhcmlhdGlvbj17dmFyaWF0aW9ufT5cbiAgICAgICAgPERlcGxveUFjdGlvbkFzc29jaWF0ZWRLZXlzXG4gICAgICAgICAgZGVwbG95PXtkZXBsb3l9XG4gICAgICAgICAgZGVwbG95UmF3RGF0YT17ZGVwbG95UmF3RGF0YX1cbiAgICAgICAgICByZW5kZXJBc1Jlc3VsdEFjdGlvblxuICAgICAgICAvPlxuICAgICAgPC9SZXN1bHRJdGVtV3JhcHBlcj5cbiAgICApO1xuICB9XG5cbiAgY29uc3Qgc2hvd1Jlc3VsdFJvdyA9XG4gICAgZGVwbG95LnRyYW5zZmVycyB8fCBkZXBsb3kubmZ0QWN0aW9ucyB8fCBkZXBsb3kuZnRBY3Rpb25zO1xuXG4gIGlmICghc2hvd1Jlc3VsdFJvdykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3Qgc29ydGVkQWN0aW9ucyA9IHNvcnRBY3Rpb25zQnlUeXBlQW5kT3JkZXIoZGVwbG95KTtcblxuICBjb25zdCBnZXRBY3Rpb25FbGVtZW50VG9SZW5kZXIgPSAoYWN0aW9uKSA9PiB7XG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgY2FzZSBEZXBsb3lSZXN1bHRSb3dUeXBlLk5GVDpcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8RGVwbG95UmVzdWx0TmZ0IGtleT17YWN0aW9uLnRyYW5zZm9ybV9pZHh9IG5mdEFjdGlvbj17YWN0aW9ufSAvPlxuICAgICAgICApO1xuICAgICAgY2FzZSBEZXBsb3lSZXN1bHRSb3dUeXBlLkZUOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxEZXBsb3lSZXN1bHRDZXAxOCBrZXk9e2FjdGlvbi50cmFuc2Zvcm1faWR4fSBmdEFjdGlvbj17YWN0aW9ufSAvPlxuICAgICAgICApO1xuICAgICAgY2FzZSBEZXBsb3lSZXN1bHRSb3dUeXBlLk5UOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxUcmFuc2ZlckFjdGlvblJvd1xuICAgICAgICAgICAga2V5PXthY3Rpb24udHJhbnNmZXJfaW5kZXh9XG4gICAgICAgICAgICBsb2FkaW5nPXtsb2FkaW5nfVxuICAgICAgICAgICAgdGltZVRyYW5zYWN0aW9uQ3VycmVuY3lSYXRlPXtkZXBsb3kudGltZVRyYW5zYWN0aW9uQ3VycmVuY3lSYXRlfVxuICAgICAgICAgICAgdHJhbnNmZXI9e2FjdGlvbn1cbiAgICAgICAgICAgIGFjdGlvblBvb2xBY2NvdW50SGFzaD17XG4gICAgICAgICAgICAgIGFjdGlvbklkZW50aWZpY2F0aW9uSGFzaGVzLmF1Y3Rpb25fcG9vbF9hY2NvdW50X2hhc2hcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbmRlckFzUmVzdWx0QWN0aW9uXG4gICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzb3J0ZWRBY3Rpb25Db21wb25lbnRzID0gc29ydGVkQWN0aW9ucy5tYXAoKGFjdGlvbikgPT5cbiAgICBnZXRBY3Rpb25FbGVtZW50VG9SZW5kZXIoYWN0aW9uKSxcbiAgKTtcblxuICBjb25zdCBjb21iaW5lZEFjdGlvbkNvbXBvbmVudHMgPSBbXG4gICAgLi4uc29ydGVkQWN0aW9uQ29tcG9uZW50cyxcbiAgICAuLi4oYWN0aW9uQ29tcG9uZW50cyB8fCBbXSksXG4gIF07XG5cbiAgcmV0dXJuIChcbiAgICA8RmxleENvbHVtbj5cbiAgICAgIHtjb21iaW5lZEFjdGlvbkNvbXBvbmVudHM/Lmxlbmd0aFxuICAgICAgICA/IGNvbWJpbmVkQWN0aW9uQ29tcG9uZW50c1xuICAgICAgICAgICAgLmZpbHRlcigoYWN0aW9uLCBpKSA9PlxuICAgICAgICAgICAgICBpc0NvbGxhcHNlZCA/IGkgPCBNQVhJTVVNX1ZJU0lCTEVfUk9XUyA6IHRydWUsXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAubWFwKChhY3Rpb24sIGlkeCkgPT4gKFxuICAgICAgICAgICAgICA8UmVzdWx0SXRlbVdyYXBwZXIga2V5PXtgYWN0aW9ucy0ke2lkeH1gfSB2YXJpYXRpb249e3ZhcmlhdGlvbn0+XG4gICAgICAgICAgICAgICAge2FjdGlvbn1cbiAgICAgICAgICAgICAgPC9SZXN1bHRJdGVtV3JhcHBlcj5cbiAgICAgICAgICAgICkpXG4gICAgICAgIDogbnVsbH1cbiAgICAgIHtzaG91bGRDb2xsYXBzZSAmJlxuICAgICAgY29tYmluZWRBY3Rpb25Db21wb25lbnRzPy5sZW5ndGggPiBNQVhJTVVNX1ZJU0lCTEVfUk9XUyA/IChcbiAgICAgICAgPEV4cGFuZENvbGxhcHNlZEJ1dHRvblxuICAgICAgICAgIGNvbGxhcHNlZExhYmVsPXtcbiAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgIDw+VmlldyBhbGwgPC8+XG4gICAgICAgICAgICAgIHtjb21iaW5lZEFjdGlvbkNvbXBvbmVudHM/Lmxlbmd0aH1cbiAgICAgICAgICAgICAgPD4gcmVzdWx0czwvPlxuICAgICAgICAgICAgPC8+XG4gICAgICAgICAgfVxuICAgICAgICAgIGV4cGFuZGVkTGFiZWw9ezw+Q29sbGFwc2UgcmVzdWx0cyA8Lz59XG4gICAgICAgICAgb25FeHBhbmQ9e2hhbmRsZUV4cGFuZExpc3R9XG4gICAgICAgIC8+XG4gICAgICApIDogbnVsbH1cbiAgICA8L0ZsZXhDb2x1bW4+XG4gICk7XG59O1xuXG50eXBlIERlcGxveVJlc3VsdFJvd1Byb3BzID0gRGVwbG95UmVzdWx0Um93Q29tcG9uZW50UHJvcHMgJiB7XG4gIGdldEFjY291bnRJbmZvOiAocHVibGljS2V5OiBzdHJpbmcpID0+IEFjY291bnRJbmZvUmVzdWx0IHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgZ2V0Q29udHJhY3RQYWNrYWdlSW5mb0J5SGFzaD86IChcbiAgICBjb250cmFjdEhhc2g6IHN0cmluZyxcbiAgKSA9PiBEZXBsb3lDb250cmFjdFBhY2thZ2VSZXN1bHQgfCBudWxsIHwgdW5kZWZpbmVkO1xuICBnZXRDb250cmFjdEluZm9CeUhhc2g/OiAoXG4gICAgICBjb250cmFjdEhhc2g6IHN0cmluZyxcbiAgKSA9PiBDb250cmFjdFJlc3VsdCB8IG51bGwgfCB1bmRlZmluZWQ7XG4gIGNzcHJMaXZlRG9tYWluUGF0aDogc3RyaW5nO1xufTtcblxuZXhwb3J0IGNvbnN0IERlcGxveVJlc3VsdFJvdyA9IChwcm9wczogRGVwbG95UmVzdWx0Um93UHJvcHMpID0+IHtcbiAgY29uc3Qge1xuICAgIGdldEFjY291bnRJbmZvLFxuICAgIGdldENvbnRyYWN0UGFja2FnZUluZm9CeUhhc2gsXG4gICAgZ2V0Q29udHJhY3RJbmZvQnlIYXNoLFxuICAgIGNzcHJMaXZlRG9tYWluUGF0aCxcbiAgICAuLi5yZXN0XG4gIH0gPSBwcm9wcztcbiAgcmV0dXJuIChcbiAgICA8RGVwbG95QWN0aW9uRGF0YVByb3ZpZGVyXG4gICAgICBnZXRBY2NvdW50SW5mbz17Z2V0QWNjb3VudEluZm99XG4gICAgICBnZXRDb250cmFjdFBhY2thZ2VJbmZvQnlIYXNoPXtnZXRDb250cmFjdFBhY2thZ2VJbmZvQnlIYXNofVxuICAgICAgZ2V0Q29udHJhY3RJbmZvQnlIYXNoPXtnZXRDb250cmFjdEluZm9CeUhhc2h9XG4gICAgICBjc3ByTGl2ZURvbWFpblBhdGg9e2NzcHJMaXZlRG9tYWluUGF0aH1cbiAgICA+XG4gICAgICA8RGVwbG95UmVzdWx0Um93Q29tcG9uZW50IHsuLi5yZXN0fSAvPlxuICAgIDwvRGVwbG95QWN0aW9uRGF0YVByb3ZpZGVyPlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgRGVwbG95UmVzdWx0Um93OyJdfQ==