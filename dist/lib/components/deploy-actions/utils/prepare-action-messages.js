import { TransactorHashType } from '../../../types/types';
import { FTEntryPointType } from '../../../types/FTToken';
import { getNftTokenIdsFromArguments, guardedDeriveSplitDataFromArguments, } from '../../../utils/deploy-args';
import { NftTokenEntryPoint } from '../../../types/NFTToken';
const getCep18TransactorsDataFromArgs = (args) => {
    const recipientHash = guardedDeriveSplitDataFromArguments(args.recipient, 'Hash');
    const recipientAccountHash = guardedDeriveSplitDataFromArguments(args.recipient, 'Account');
    const ownerHash = guardedDeriveSplitDataFromArguments(args.owner, 'Account');
    const spenderHash = guardedDeriveSplitDataFromArguments(args.spender, 'Hash');
    return {
        recipientHash,
        recipientAccountHash,
        ownerHash,
        spenderHash,
    };
};
export const prepareFtActionMessageDataForDeployDetails = (deploy, getPublicKeyByAccountHash) => {
    const { entryPoint, args, contractPackage } = deploy;
    const entryPointName = entryPoint?.name || '';
    const amount = deploy.args.amount?.parsed;
    const actionName = {
        [FTEntryPointType.transfer]: 'Transfer',
        [FTEntryPointType.approve]: 'Approve transfer rights',
        [FTEntryPointType.burn]: 'Burn',
        [FTEntryPointType.mint]: 'Mint',
    };
    const contractPrefixesMap = {
        [FTEntryPointType.transfer]: 'of',
        [FTEntryPointType.burn]: 'of',
        [FTEntryPointType.mint]: 'of',
        [FTEntryPointType.approve]: 'for',
    };
    const senderPrefixesMap = {
        [FTEntryPointType.transfer]: 'from',
        [FTEntryPointType.burn]: 'owned by',
        [FTEntryPointType.mint]: 'to',
        [FTEntryPointType.approve]: 'to',
    };
    const { recipientHash, recipientAccountHash, ownerHash, spenderHash } = getCep18TransactorsDataFromArgs(args);
    if (actionName[entryPointName] === undefined ||
        !amount ||
        !(recipientHash || recipientAccountHash || ownerHash || spenderHash)) {
        return null;
    }
    const tokenSymbol = contractPackage.metadata?.symbol;
    const senderPrefix = senderPrefixesMap[entryPointName];
    const contractPrefix = contractPrefixesMap[entryPointName];
    const actionOutcome = {
        amount,
        ...(tokenSymbol && { symbol: tokenSymbol }),
        ...(contractPrefix && { contractPrefix }),
        ...(ownerHash?.hash && {
            prefix1: senderPrefix,
            account1: {
                hash: ownerHash?.hash,
                publicKey: ownerHash?.hash && getPublicKeyByAccountHash(ownerHash.hash),
                hashType: TransactorHashType.account,
            },
        }),
        ...(spenderHash?.hash && {
            prefix1: senderPrefix,
            account1: {
                hash: spenderHash?.hash,
                hashType: TransactorHashType.hash,
            },
        }),
        // here could be a case when recipientAccountHash and recipientHash are both present
        // so, we need to avoid overwriting recipientAccountHash with recipientHash
        ...(recipientAccountHash?.hash
            ? {
                prefix2: 'to',
                account2: {
                    hash: recipientAccountHash?.hash,
                    publicKey: recipientAccountHash?.hash &&
                        getPublicKeyByAccountHash(recipientAccountHash.hash),
                    hashType: TransactorHashType.account,
                },
            }
            : {
                prefix2: 'to',
                account2: {
                    hash: recipientHash?.hash,
                    hashType: TransactorHashType.hash,
                },
            }),
    };
    return {
        entryPointName: entryPointName,
        actionName: actionName[entryPointName] || entryPointName,
        ...actionOutcome,
    };
};
const getNftTransactorsDataFromArgs = (args) => {
    const tokenOwner = guardedDeriveSplitDataFromArguments(args.token_owner, 'Account');
    const owner = guardedDeriveSplitDataFromArguments(args.owner, 'Account');
    const from = guardedDeriveSplitDataFromArguments(args.from, 'Account');
    const sourceKey = guardedDeriveSplitDataFromArguments(args.source_key, 'Account');
    const targetKey = guardedDeriveSplitDataFromArguments(args.target_key, 'Account');
    const recipientHash = guardedDeriveSplitDataFromArguments(args.recipient, 'Account');
    const accountSpenderHash = guardedDeriveSplitDataFromArguments(args.spender, 'Account');
    const contractSpenderHash = guardedDeriveSplitDataFromArguments(args.spender, 'Hash');
    const operatorHash = guardedDeriveSplitDataFromArguments(args.operator, 'Hash');
    const to = guardedDeriveSplitDataFromArguments(args.to, 'Account');
    return {
        tokenOwner,
        owner,
        sourceKey,
        targetKey,
        recipientHash,
        contractSpenderHash,
        operatorHash,
        accountSpenderHash,
        from,
        to,
    };
};
export const prepareNftActionMessageDataForDeployDetails = (deploy, getPublicKeyByAccountHash) => {
    const { entryPoint, args } = deploy;
    const entryPointName = entryPoint?.name || '';
    const actionName = {
        [NftTokenEntryPoint.transfer]: 'Transfer',
        [NftTokenEntryPoint.transfer_from]: 'Transfer',
        [NftTokenEntryPoint.approve]: 'Approve transfer rights',
        [NftTokenEntryPoint.burn]: 'Burn',
        [NftTokenEntryPoint.mint]: 'Mint',
        [NftTokenEntryPoint.update_token_meta]: 'Update metadata',
        [NftTokenEntryPoint.set_approval_for_all]: 'Approve transfer rights',
    };
    const contractPrefixesMap = {
        [NftTokenEntryPoint.approve]: 'for',
        [NftTokenEntryPoint.update_token_meta]: 'for',
        [NftTokenEntryPoint.mint]: 'of',
        [NftTokenEntryPoint.set_approval_for_all]: 'of',
    };
    const senderPrefixesMap = {
        [NftTokenEntryPoint.transfer]: 'from',
        [NftTokenEntryPoint.transfer_from]: 'from',
        [NftTokenEntryPoint.burn]: 'owned by',
        [NftTokenEntryPoint.approve]: 'to',
        [NftTokenEntryPoint.mint]: 'to',
    };
    if (actionName[entryPointName] === undefined) {
        return null;
    }
    const nftTokenIds = getNftTokenIdsFromArguments(args);
    const { recipientHash, tokenOwner, contractSpenderHash, operatorHash, sourceKey, owner, targetKey, accountSpenderHash, from, to, } = getNftTransactorsDataFromArgs(args);
    const account1Hash = tokenOwner?.hash ||
        sourceKey?.hash ||
        owner?.hash ||
        accountSpenderHash?.hash ||
        from?.hash;
    const account2Hash = recipientHash?.hash || targetKey?.hash || to?.hash;
    const contractPrefix = contractPrefixesMap[entryPointName];
    const senderPrefix = senderPrefixesMap[entryPointName];
    const actionOutcome = {
        nftTokenIds: nftTokenIds,
        contractPrefix,
        ...(account1Hash && {
            prefix1: senderPrefix,
            account1: {
                hash: account1Hash,
                publicKey: account1Hash && getPublicKeyByAccountHash(account1Hash),
                hashType: TransactorHashType.account,
            },
        }),
        ...(contractSpenderHash?.hash && {
            prefix1: senderPrefix,
            account1: {
                hash: contractSpenderHash?.hash,
                hashType: TransactorHashType.hash,
            },
        }),
        ...(account2Hash && {
            account2: {
                hash: account2Hash,
                publicKey: account2Hash && getPublicKeyByAccountHash(account2Hash),
                hashType: TransactorHashType.account,
            },
        }),
        ...(operatorHash?.hash && {
            account2: {
                hash: operatorHash?.hash,
                hashType: TransactorHashType.hash,
            },
        }),
    };
    return {
        entryPointName: entryPointName,
        actionName: actionName[entryPointName] || entryPointName,
        ...actionOutcome,
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlcGFyZS1hY3Rpb24tbWVzc2FnZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZGVwbG95LWFjdGlvbnMvdXRpbHMvcHJlcGFyZS1hY3Rpb24tbWVzc2FnZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFVLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDMUQsT0FBTyxFQUNMLDJCQUEyQixFQUMzQixtQ0FBbUMsR0FDcEMsTUFBTSw0QkFBNEIsQ0FBQztBQUNwQyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQTRCN0QsTUFBTSwrQkFBK0IsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFO0lBQy9DLE1BQU0sYUFBYSxHQUFHLG1DQUFtQyxDQUN2RCxJQUFJLENBQUMsU0FBUyxFQUNkLE1BQU0sQ0FDUCxDQUFDO0lBQ0YsTUFBTSxvQkFBb0IsR0FBRyxtQ0FBbUMsQ0FDOUQsSUFBSSxDQUFDLFNBQVMsRUFDZCxTQUFTLENBQ1YsQ0FBQztJQUNGLE1BQU0sU0FBUyxHQUFHLG1DQUFtQyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDN0UsTUFBTSxXQUFXLEdBQUcsbUNBQW1DLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUU5RSxPQUFPO1FBQ0wsYUFBYTtRQUNiLG9CQUFvQjtRQUNwQixTQUFTO1FBQ1QsV0FBVztLQUNaLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSwwQ0FBMEMsR0FBRyxDQUN4RCxNQUFjLEVBQ2QseUJBQWdELEVBQzVCLEVBQUU7SUFDdEIsTUFBTSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLEdBQUcsTUFBTSxDQUFD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ZXNDb250ZW50IjpbImltcG9ydCB7IERlcGxveSwgVHJhbnNhY3Rvckhhc2hUeXBlIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvdHlwZXMnO1xuaW1wb3J0IHsgRlRFbnRyeVBvaW50VHlwZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL0ZUVG9rZW4nO1xuaW1wb3J0IHtcbiAgZ2V0TmZ0VG9rZW5JZHNGcm9tQXJndW1lbnRzLFxuICBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyxcbn0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZGVwbG95LWFyZ3MnO1xuaW1wb3J0IHsgTmZ0VG9rZW5FbnRyeVBvaW50IH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvTkZUVG9rZW4nO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VEYXRhQWNjb3VudCB7XG4gIGFjY291bnRIYXNoPzogc3RyaW5nO1xuICBwdWJsaWNLZXk/OiBzdHJpbmc7XG4gIGhhc2g/OiBzdHJpbmc7XG4gIGxvZ28/OiBzdHJpbmc7XG4gIHBhdGg/OiBzdHJpbmc7XG4gIGhhc2hUeXBlPzogVHJhbnNhY3Rvckhhc2hUeXBlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VEYXRhIHtcbiAgZW50cnlQb2ludE5hbWU/OiBzdHJpbmcgfCBudWxsO1xuICBhY3Rpb25OYW1lPzogc3RyaW5nO1xuICBudW1PZlRva2Vucz86IG51bWJlcjtcbiAgbnVtT2ZUb2tlbnNQcmVmaXg/OiBzdHJpbmcgfCBudWxsO1xuICBzeW1ib2w/OiBzdHJpbmc7XG4gIGNhbGxlclByZWZpeD86IHN0cmluZztcbiAgY2FsbGVyQWNjb3VudD86IE1lc3NhZ2VEYXRhQWNjb3VudDtcbiAgcHJlZml4MT86IHN0cmluZztcbiAgYWNjb3VudDE/OiBNZXNzYWdlRGF0YUFjY291bnQ7XG4gIHByZWZpeDI/OiBzdHJpbmc7XG4gIGFjY291bnQyPzogTWVzc2FnZURhdGFBY2NvdW50O1xuICBuZnRUb2tlbklkcz86IHN0cmluZ1tdIHwgbnVsbDtcbiAgY29udHJhY3RQcmVmaXg/OiBzdHJpbmc7XG4gIGFtb3VudD86IHN0cmluZztcbn1cblxuY29uc3QgZ2V0Q2VwMThUcmFuc2FjdG9yc0RhdGFGcm9tQXJncyA9IChhcmdzKSA9PiB7XG4gIGNvbnN0IHJlY2lwaWVudEhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLnJlY2lwaWVudCxcbiAgICAnSGFzaCcsXG4gICk7XG4gIGNvbnN0IHJlY2lwaWVudEFjY291bnRIYXNoID0gZ3VhcmRlZERlcml2ZVNwbGl0RGF0YUZyb21Bcmd1bWVudHMoXG4gICAgYXJncy5yZWNpcGllbnQsXG4gICAgJ0FjY291bnQnLFxuICApO1xuICBjb25zdCBvd25lckhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhhcmdzLm93bmVyLCAnQWNjb3VudCcpO1xuICBjb25zdCBzcGVuZGVySGFzaCA9IGd1YXJkZWREZXJpdmVTcGxpdERhdGFGcm9tQXJndW1lbnRzKGFyZ3Muc3BlbmRlciwgJ0hhc2gnKTtcblxuICByZXR1cm4ge1xuICAgIHJlY2lwaWVudEhhc2gsXG4gICAgcmVjaXBpZW50QWNjb3VudEhhc2gsXG4gICAgb3duZXJIYXNoLFxuICAgIHNwZW5kZXJIYXNoLFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IHByZXBhcmVGdEFjdGlvbk1lc3NhZ2VEYXRhRm9yRGVwbG95RGV0YWlscyA9IChcbiAgZGVwbG95OiBEZXBsb3ksXG4gIGdldFB1YmxpY0tleUJ5QWNjb3VudEhhc2g6IChoYXNoOiBzdHJpbmcpID0+IGFueSxcbik6IE1lc3NhZ2VEYXRhIHwgbnVsbCA9PiB7XG4gIGNvbnN0IHsgZW50cnlQb2ludCwgYXJncywgY29udHJhY3RQYWNrYWdlIH0gPSBkZXBsb3k7XG4gIGNvbnN0IGVudHJ5UG9pbnROYW1lID0gZW50cnlQb2ludD8ubmFtZSB8fCAnJztcbiAgY29uc3QgYW1vdW50ID0gZGVwbG95LmFyZ3MuYW1vdW50Py5wYXJzZWQgYXMgc3RyaW5nO1xuXG4gIGNvbnN0IGFjdGlvbk5hbWUgPSB7XG4gICAgW0ZURW50cnlQb2ludFR5cGUudHJhbnNmZXJdOiAnVHJhbnNmZXInLFxuICAgIFtGVEVudHJ5UG9pbnRUeXBlLmFwcHJvdmVdOiAnQXBwcm92ZSB0cmFuc2ZlciByaWdodHMnLFxuICAgIFtGVEVudHJ5UG9pbnRUeXBlLmJ1cm5dOiAnQnVybicsXG4gICAgW0ZURW50cnlQb2ludFR5cGUubWludF06ICdNaW50JyxcbiAgfTtcblxuICBjb25zdCBjb250cmFjdFByZWZpeGVzTWFwID0ge1xuICAgIFtGVEVudHJ5UG9pbnRUeXBlLnRyYW5zZmVyXTogJ29mJyxcbiAgICBbRlRFbnRyeVBvaW50VHlwZS5idXJuXTogJ29mJyxcbiAgICBbRlRFbnRyeVBvaW50VHlwZS5taW50XTogJ29mJyxcbiAgICBbRlRFbnRyeVBvaW50VHlwZS5hcHByb3ZlXTogJ2ZvcicsXG4gIH07XG5cbiAgY29uc3Qgc2VuZGVyUHJlZml4ZXNNYXAgPSB7XG4gICAgW0ZURW50cnlQb2ludFR5cGUudHJhbnNmZXJdOiAnZnJvbScsXG4gICAgW0ZURW50cnlQb2ludFR5cGUuYnVybl06ICdvd25lZCBieScsXG4gICAgW0ZURW50cnlQb2ludFR5cGUubWludF06ICd0bycsXG4gICAgW0ZURW50cnlQb2ludFR5cGUuYXBwcm92ZV06ICd0bycsXG4gIH07XG5cbiAgY29uc3QgeyByZWNpcGllbnRIYXNoLCByZWNpcGllbnRBY2NvdW50SGFzaCwgb3duZXJIYXNoLCBzcGVuZGVySGFzaCB9ID1cbiAgICBnZXRDZXAxOFRyYW5zYWN0b3JzRGF0YUZyb21BcmdzKGFyZ3MpO1xuXG4gIGlmIChcbiAgICBhY3Rpb25OYW1lW2VudHJ5UG9pbnROYW1lXSA9PT0gdW5kZWZpbmVkIHx8XG4gICAgIWFtb3VudCB8fFxuICAgICEocmVjaXBpZW50SGFzaCB8fCByZWNpcGllbnRBY2NvdW50SGFzaCB8fCBvd25lckhhc2ggfHwgc3BlbmRlckhhc2gpXG4gICkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgdG9rZW5TeW1ib2wgPSBjb250cmFjdFBhY2thZ2UubWV0YWRhdGE/LnN5bWJvbDtcbiAgY29uc3Qgc2VuZGVyUHJlZml4ID0gc2VuZGVyUHJlZml4ZXNNYXBbZW50cnlQb2ludE5hbWVdO1xuICBjb25zdCBjb250cmFjdFByZWZpeCA9IGNvbnRyYWN0UHJlZml4ZXNNYXBbZW50cnlQb2ludE5hbWVdO1xuXG4gIGNvbnN0IGFjdGlvbk91dGNvbWU6IFBhcnRpYWw8TWVzc2FnZURhdGE+ID0ge1xuICAgIGFtb3VudCxcbiAgICAuLi4odG9rZW5TeW1ib2wgJiYgeyBzeW1ib2w6IHRva2VuU3ltYm9sIH0pLFxuICAgIC4uLihjb250cmFjdFByZWZpeCAmJiB7IGNvbnRyYWN0UHJlZml4IH0pLFxuICAgIC4uLihvd25lckhhc2g/Lmhhc2ggJiYge1xuICAgICAgcHJlZml4MTogc2VuZGVyUHJlZml4LFxuICAgICAgYWNjb3VudDE6IHtcbiAgICAgICAgaGFzaDogb3duZXJIYXNoPy5oYXNoLFxuICAgICAgICBwdWJsaWNLZXk6IG93bmVySGFzaD8uaGFzaCAmJiBnZXRQdWJsaWNLZXlCeUFjY291bnRIYXNoKG93bmVySGFzaC5oYXNoKSxcbiAgICAgICAgaGFzaFR5cGU6IFRyYW5zYWN0b3JIYXNoVHlwZS5hY2NvdW50LFxuICAgICAgfSxcbiAgICB9KSxcbiAgICAuLi4oc3BlbmRlckhhc2g/Lmhhc2ggJiYge1xuICAgICAgcHJlZml4MTogc2VuZGVyUHJlZml4LFxuICAgICAgYWNjb3VudDE6IHtcbiAgICAgICAgaGFzaDogc3BlbmRlckhhc2g/Lmhhc2gsXG4gICAgICAgIGhhc2hUeXBlOiBUcmFuc2FjdG9ySGFzaFR5cGUuaGFzaCxcbiAgICAgIH0sXG4gICAgfSksXG4gICAgLy8gaGVyZSBjb3VsZCBiZSBhIGNhc2Ugd2hlbiByZWNpcGllbnRBY2NvdW50SGFzaCBhbmQgcmVjaXBpZW50SGFzaCBhcmUgYm90aCBwcmVzZW50XG4gICAgLy8gc28sIHdlIG5lZWQgdG8gYXZvaWQgb3ZlcndyaXRpbmcgcmVjaXBpZW50QWNjb3VudEhhc2ggd2l0aCByZWNpcGllbnRIYXNoXG4gICAgLi4uKHJlY2lwaWVudEFjY291bnRIYXNoPy5oYXNoXG4gICAgICA/IHtcbiAgICAgICAgICBwcmVmaXgyOiAndG8nLFxuICAgICAgICAgIGFjY291bnQyOiB7XG4gICAgICAgICAgICBoYXNoOiByZWNpcGllbnRBY2NvdW50SGFzaD8uaGFzaCxcbiAgICAgICAgICAgIHB1YmxpY0tleTpcbiAgICAgICAgICAgICAgcmVjaXBpZW50QWNjb3VudEhhc2g/Lmhhc2ggJiZcbiAgICAgICAgICAgICAgZ2V0UHVibGljS2V5QnlBY2NvdW50SGFzaChyZWNpcGllbnRBY2NvdW50SGFzaC5oYXNoKSxcbiAgICAgICAgICAgIGhhc2hUeXBlOiBUcmFuc2FjdG9ySGFzaFR5cGUuYWNjb3VudCxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICA6IHtcbiAgICAgICAgICBwcmVmaXgyOiAndG8nLFxuICAgICAgICAgIGFjY291bnQyOiB7XG4gICAgICAgICAgICBoYXNoOiByZWNpcGllbnRIYXNoPy5oYXNoLFxuICAgICAgICAgICAgaGFzaFR5cGU6IFRyYW5zYWN0b3JIYXNoVHlwZS5oYXNoLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZW50cnlQb2ludE5hbWU6IGVudHJ5UG9pbnROYW1lLFxuICAgIGFjdGlvbk5hbWU6IGFjdGlvbk5hbWVbZW50cnlQb2ludE5hbWVdIHx8IGVudHJ5UG9pbnROYW1lLFxuICAgIC4uLmFjdGlvbk91dGNvbWUsXG4gIH07XG59O1xuXG5jb25zdCBnZXROZnRUcmFuc2FjdG9yc0RhdGFGcm9tQXJncyA9IChhcmdzKSA9PiB7XG4gIGNvbnN0IHRva2VuT3duZXIgPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLnRva2VuX293bmVyLFxuICAgICdBY2NvdW50JyxcbiAgKTtcbiAgY29uc3Qgb3duZXIgPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhhcmdzLm93bmVyLCAnQWNjb3VudCcpO1xuICBjb25zdCBmcm9tID0gZ3VhcmRlZERlcml2ZVNwbGl0RGF0YUZyb21Bcmd1bWVudHMoYXJncy5mcm9tLCAnQWNjb3VudCcpO1xuXG4gIGNvbnN0IHNvdXJjZUtleSA9IGd1YXJkZWREZXJpdmVTcGxpdERhdGFGcm9tQXJndW1lbnRzKFxuICAgIGFyZ3Muc291cmNlX2tleSxcbiAgICAnQWNjb3VudCcsXG4gICk7XG5cbiAgY29uc3QgdGFyZ2V0S2V5ID0gZ3VhcmRlZERlcml2ZVNwbGl0RGF0YUZyb21Bcmd1bWVudHMoXG4gICAgYXJncy50YXJnZXRfa2V5LFxuICAgICdBY2NvdW50JyxcbiAgKTtcbiAgY29uc3QgcmVjaXBpZW50SGFzaCA9IGd1YXJkZWREZXJpdmVTcGxpdERhdGFGcm9tQXJndW1lbnRzKFxuICAgIGFyZ3MucmVjaXBpZW50LFxuICAgICdBY2NvdW50JyxcbiAgKTtcblxuICBjb25zdCBhY2NvdW50U3BlbmRlckhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLnNwZW5kZXIsXG4gICAgJ0FjY291bnQnLFxuICApO1xuXG4gIGNvbnN0IGNvbnRyYWN0U3BlbmRlckhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLnNwZW5kZXIsXG4gICAgJ0hhc2gnLFxuICApO1xuICBjb25zdCBvcGVyYXRvckhhc2ggPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhcbiAgICBhcmdzLm9wZXJhdG9yLFxuICAgICdIYXNoJyxcbiAgKTtcbiAgY29uc3QgdG8gPSBndWFyZGVkRGVyaXZlU3BsaXREYXRhRnJvbUFyZ3VtZW50cyhhcmdzLnRvLCAnQWNjb3VudCcpO1xuXG4gIHJldHVybiB7XG4gICAgdG9rZW5Pd25lcixcbiAgICBvd25lcixcbiAgICBzb3VyY2VLZXksXG4gICAgdGFyZ2V0S2V5LFxuICAgIHJlY2lwaWVudEhhc2gsXG4gICAgY29udHJhY3RTcGVuZGVySGFzaCxcbiAgICBvcGVyYXRvckhhc2gsXG4gICAgYWNjb3VudFNwZW5kZXJIYXNoLFxuICAgIGZyb20sXG4gICAgdG8sXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgcHJlcGFyZU5mdEFjdGlvbk1lc3NhZ2VEYXRhRm9yRGVwbG95RGV0YWlscyA9IChcbiAgZGVwbG95OiBEZXBsb3ksXG4gIGdldFB1YmxpY0tleUJ5QWNjb3VudEhhc2g6IChoYXNoOiBzdHJpbmcpID0+IGFueSxcbik6IE1lc3NhZ2VEYXRhIHwgbnVsbCA9PiB7XG4gIGNvbnN0IHsgZW50cnlQb2ludCwgYXJncyB9ID0gZGVwbG95O1xuICBjb25zdCBlbnRyeVBvaW50TmFtZSA9IGVudHJ5UG9pbnQ/Lm5hbWUgfHwgJyc7XG5cbiAgY29uc3QgYWN0aW9uTmFtZSA9IHtcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LnRyYW5zZmVyXTogJ1RyYW5zZmVyJyxcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LnRyYW5zZmVyX2Zyb21dOiAnVHJhbnNmZXInLFxuICAgIFtOZnRUb2tlbkVudHJ5UG9pbnQuYXBwcm92ZV06ICdBcHByb3ZlIHRyYW5zZmVyIHJpZ2h0cycsXG4gICAgW05mdFRva2VuRW50cnlQb2ludC5idXJuXTogJ0J1cm4nLFxuICAgIFtOZnRUb2tlbkVudHJ5UG9pbnQubWludF06ICdNaW50JyxcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LnVwZGF0ZV90b2tlbl9tZXRhXTogJ1VwZGF0ZSBtZXRhZGF0YScsXG4gICAgW05mdFRva2VuRW50cnlQb2ludC5zZXRfYXBwcm92YWxfZm9yX2FsbF06ICdBcHByb3ZlIHRyYW5zZmVyIHJpZ2h0cycsXG4gIH07XG5cbiAgY29uc3QgY29udHJhY3RQcmVmaXhlc01hcCA9IHtcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LmFwcHJvdmVdOiAnZm9yJyxcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LnVwZGF0ZV90b2tlbl9tZXRhXTogJ2ZvcicsXG4gICAgW05mdFRva2VuRW50cnlQb2ludC5taW50XTogJ29mJyxcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LnNldF9hcHByb3ZhbF9mb3JfYWxsXTogJ29mJyxcbiAgfTtcblxuICBjb25zdCBzZW5kZXJQcmVmaXhlc01hcCA9IHtcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LnRyYW5zZmVyXTogJ2Zyb20nLFxuICAgIFtOZnRUb2tlbkVudHJ5UG9pbnQudHJhbnNmZXJfZnJvbV06ICdmcm9tJyxcbiAgICBbTmZ0VG9rZW5FbnRyeVBvaW50LmJ1cm5dOiAnb3duZWQgYnknLFxuICAgIFtOZnRUb2tlbkVudHJ5UG9pbnQuYXBwcm92ZV06ICd0bycsXG4gICAgW05mdFRva2VuRW50cnlQb2ludC5taW50XTogJ3RvJyxcbiAgfTtcblxuICBpZiAoYWN0aW9uTmFtZVtlbnRyeVBvaW50TmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgbmZ0VG9rZW5JZHMgPSBnZXROZnRUb2tlbklkc0Zyb21Bcmd1bWVudHMoYXJncyk7XG4gIGNvbnN0IHtcbiAgICByZWNpcGllbnRIYXNoLFxuICAgIHRva2VuT3duZXIsXG4gICAgY29udHJhY3RTcGVuZGVySGFzaCxcbiAgICBvcGVyYXRvckhhc2gsXG4gICAgc291cmNlS2V5LFxuICAgIG93bmVyLFxuICAgIHRhcmdldEtleSxcbiAgICBhY2NvdW50U3BlbmRlckhhc2gsXG4gICAgZnJvbSxcbiAgICB0byxcbiAgfSA9IGdldE5mdFRyYW5zYWN0b3JzRGF0YUZyb21BcmdzKGFyZ3MpO1xuXG4gIGNvbnN0IGFjY291bnQxSGFzaCA9XG4gICAgdG9rZW5Pd25lcj8uaGFzaCB8fFxuICAgIHNvdXJjZUtleT8uaGFzaCB8fFxuICAgIG93bmVyPy5oYXNoIHx8XG4gICAgYWNjb3VudFNwZW5kZXJIYXNoPy5oYXNoIHx8XG4gICAgZnJvbT8uaGFzaDtcbiAgY29uc3QgYWNjb3VudDJIYXNoID0gcmVjaXBpZW50SGFzaD8uaGFzaCB8fCB0YXJnZXRLZXk/Lmhhc2ggfHwgdG8/Lmhhc2g7XG5cbiAgY29uc3QgY29udHJhY3RQcmVmaXggPSBjb250cmFjdFByZWZpeGVzTWFwW2VudHJ5UG9pbnROYW1lXTtcbiAgY29uc3Qgc2VuZGVyUHJlZml4ID0gc2VuZGVyUHJlZml4ZXNNYXBbZW50cnlQb2ludE5hbWVdO1xuXG4gIGNvbnN0IGFjdGlvbk91dGNvbWU6IFBhcnRpYWw8TWVzc2FnZURhdGE+ID0ge1xuICAgIG5mdFRva2VuSWRzOiBuZnRUb2tlbklkcyxcbiAgICBjb250cmFjdFByZWZpeCxcbiAgICAuLi4oYWNjb3VudDFIYXNoICYmIHtcbiAgICAgIHByZWZpeDE6IHNlbmRlclByZWZpeCxcbiAgICAgIGFjY291bnQxOiB7XG4gICAgICAgIGhhc2g6IGFjY291bnQxSGFzaCxcbiAgICAgICAgcHVibGljS2V5OiBhY2NvdW50MUhhc2ggJiYgZ2V0UHVibGljS2V5QnlBY2NvdW50SGFzaChhY2NvdW50MUhhc2gpLFxuICAgICAgICBoYXNoVHlwZTogVHJhbnNhY3Rvckhhc2hUeXBlLmFjY291bnQsXG4gICAgICB9LFxuICAgIH0pLFxuICAgIC4uLihjb250cmFjdFNwZW5kZXJIYXNoPy5oYXNoICYmIHtcbiAgICAgIHByZWZpeDE6IHNlbmRlclByZWZpeCxcbiAgICAgIGFjY291bnQxOiB7XG4gICAgICAgIGhhc2g6IGNvbnRyYWN0U3BlbmRlckhhc2g/Lmhhc2gsXG4gICAgICAgIGhhc2hUeXBlOiBUcmFuc2FjdG9ySGFzaFR5cGUuaGFzaCxcbiAgICAgIH0sXG4gICAgfSksXG4gICAgLi4uKGFjY291bnQySGFzaCAmJiB7XG4gICAgICBhY2NvdW50Mjoge1xuICAgICAgICBoYXNoOiBhY2NvdW50Mkhhc2gsXG4gICAgICAgIHB1YmxpY0tleTogYWNjb3VudDJIYXNoICYmIGdldFB1YmxpY0tleUJ5QWNjb3VudEhhc2goYWNjb3VudDJIYXNoKSxcbiAgICAgICAgaGFzaFR5cGU6IFRyYW5zYWN0b3JIYXNoVHlwZS5hY2NvdW50LFxuICAgICAgfSxcbiAgICB9KSxcbiAgICAuLi4ob3BlcmF0b3JIYXNoPy5oYXNoICYmIHtcbiAgICAgIGFjY291bnQyOiB7XG4gICAgICAgIGhhc2g6IG9wZXJhdG9ySGFzaD8uaGFzaCxcbiAgICAgICAgaGFzaFR5cGU6IFRyYW5zYWN0b3JIYXNoVHlwZS5oYXNoLFxuICAgICAgfSxcbiAgICB9KSxcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGVudHJ5UG9pbnROYW1lOiBlbnRyeVBvaW50TmFtZSxcbiAgICBhY3Rpb25OYW1lOiBhY3Rpb25OYW1lW2VudHJ5UG9pbnROYW1lXSB8fCBlbnRyeVBvaW50TmFtZSxcbiAgICAuLi5hY3Rpb25PdXRjb21lLFxuICB9O1xufTtcbiJdfQ==