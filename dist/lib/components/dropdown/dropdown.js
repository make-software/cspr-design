import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect } from 'react';
import Downshift, { useMultipleSelection, useSelect, } from 'downshift';
import styled from 'styled-components';
import isEqual from 'fast-deep-equal';
import BodyText from '../body-text/body-text';
import FlexRow from '../flex-row/flex-row';
import SvgIcon from '../svg-icon/svg-icon';
import FlexColumn from '../flex-column/flex-column';
import { InputInteractionType, useGetInputInteractionType, } from '../../utils/input-interaction-type';
import UpIcon from '../../assets/icons/ic-arrow-up.svg';
import DownIcon from '../../assets/icons/ic-arrow-down.svg';
import CheckmarkIcon from '../../assets/icons/ic-checkmark.svg';
import DeleteIcon from '../../assets/icons/ic-delete.svg';
const StyledDropdown = styled.div(({ theme, disabled, isFixedDropdown }) => ({
    outline: 'none',
    position: isFixedDropdown ? 'relative' : 'unset',
    ...(disabled && {
        opacity: '0.5',
        pointerEvents: 'none',
    }),
}));
const Container = styled(FlexRow)(({ theme, isOpen }) => ({
    borderRadius: theme.borderRadius.base,
    border: 'none',
    height: 36,
    padding: '0 16px',
    background: theme.styleguideColors.fillSecondary,
    ':hover, :active': {
        background: theme.styleguideColors.fillSecondary,
        svg: {
            color: theme.styleguideColors.fillPrimaryRed,
        },
    },
}));
const ItemsContainer = styled.div(({ theme, isOpen, isFixedDropdown }) => ({
    display: isOpen ? 'inherit' : 'none',
    marginTop: 4,
    borderRadius: theme.borderRadius.base,
    background: theme.styleguideColors.fillSecondary,
    ...(isFixedDropdown && {
        position: 'absolute',
        top: '60px',
        width: '100%',
        zIndex: 1,
    }),
}));
const ItemContainer = styled(FlexRow)(({ theme, isHighlighted }) => ({
    cursor: 'pointer',
    minHeight: 36,
    padding: '8px 16px',
    ':hover, :active': {
        background: theme.styleguideColors.fillSecondaryBlueHover,
        fontWeight: 600,
    },
    ...(isHighlighted && {
        '&:not(:hover)': {
            border: `1px solid ${theme.styleguideColors.contentBlue}`,
            borderRadius: theme.borderRadius.base,
        },
    }),
}));
const DeleteSvgIcon = styled(SvgIcon)(({ theme }) => ({
    path: {
        stroke: theme.styleguideColors.contentSecondary,
    },
    ':hover, :active': {
        path: {
            stroke: theme.styleguideColors.fillPrimaryRed,
        },
    },
}));
const ClearSvgIcon = styled(SvgIcon)(({ theme }) => ({
    path: {
        stroke: theme.styleguideColors.contentPrimary,
    },
}));
const MultiSelectContainer = styled(FlexRow)(({ theme }) => ({
    borderRadius: theme.borderRadius.base,
    padding: '8px',
    background: theme.styleguideColors.fillSecondary,
    ':hover, :active': {
        svg: {
            color: theme.styleguideColors.fillPrimaryRed,
        },
    },
}));
const PlaceholderWrapper = styled.span(({ theme }) => ({
    padding: '0 8px',
}));
const ChipItemContainer = styled.span(({ theme }) => ({
    borderRadius: theme.borderRadius.base,
    cursor: 'pointer',
    padding: '2px 8px',
    background: theme.styleguideColors.fillTertiary,
    color: theme.styleguideColors.contentPrimary,
}));
const OverflowWrapper = styled.span(({ theme }) => ({
    overflow: 'hidden',
    whiteSpace: 'nowrap',
    textOverflow: 'ellipsis',
}));
const DropdownIconWrapper = styled(FlexRow)(({ theme }) => ({
    paddingRight: '8px',
    marginLeft: '8px',
}));
const CheckIcon = styled(SvgIcon)(({ theme }) => ({
    path: {
        fill: theme.styleguideColors.contentBlue,
    },
}));
const MultiSelectDeleteIcon = styled(SvgIcon)(({ theme }) => ({
    path: {
        stroke: theme.styleguideColors.contentBlue,
    },
    ':hover, :active': {
        path: {
            stroke: theme.styleguideColors.contentRed,
        },
    },
}));
const getChangeEvent = (value) => {
    return {
        target: {
            name: undefined,
            value,
        },
    };
};
export function Dropdown(props) {
    const { id, items, placeholder, label, areItemsRemovable, value, style, onSelect, onRemove, noItemsMessage = 'No Options!', isFixedDropdown = false, } = props;
    const getChangeEvent = (value) => {
        return {
            target: {
                name: undefined,
                value,
            },
        };
    };
    const handleRemoveItem = (item, ev, downshift) => {
        ev.preventDefault();
        ev.stopPropagation();
        const value = item && itemValueGetter(item);
        onRemove && onRemove(getChangeEvent(value));
    };
    const itemValueGetter = (item) => item.value;
    const itemNameGetter = (item) => item.label;
    const handleItemSelect = (item) => {
        onSelect && onSelect(item);
    };
    const getItemToString = (item) => {
        if (item === null)
            return '';
        return typeof item === 'string' ? item : item.label;
    };
    const inputInteractionTypeRef = useGetInputInteractionType();
    return (_jsx(Downshift, { itemToString: getItemToString, onSelect: handleItemSelect, selectedItem: value, selectedItemChanged: (prevItem, item) => !isEqual(prevItem, item), children: (downshift) => {
            const { getItemProps, getMenuProps, isOpen, selectedItem, getRootProps, getToggleButtonProps, highlightedIndex, } = downshift;
            const noItems = !(items && items.length);
            const handleFocus = (ev) => {
                !isOpen && downshift.openMenu();
            };
            return (_jsxs(StyledDropdown, { ...getRootProps({ refKey: 'innerRef' }), style: style, isFixedDropdown: isFixedDropdown, children: [label && (_jsx(BodyText, { lineHeight: 'xs', size: 1, "aria-label": label, id: id, tabIndex: 0, children: label })), _jsxs(Container, { align: "center", justify: "space-between", ...getToggleButtonProps(), isOpen: isOpen, itemsSpacing: 10, tabIndex: 0, children: [_jsx(BodyText, { size: 3, lineHeight: 'xs', variation: selectedItem ? 'inherit' : 'darkGray', style: {
                                    overflow: 'hidden',
                                    whiteSpace: 'nowrap',
                                    textOverflow: 'ellipsis',
                                }, children: itemNameGetter(selectedItem) || placeholder }), _jsx(SvgIcon, { src: isOpen ? UpIcon : DownIcon, rotate: isOpen, onKeyDown: (ev) => {
                                    if (ev.key === 'Enter') {
                                        handleFocus(ev);
                                    }
                                }, tabIndex: 0, alt: 'Arrow icon', role: 'img', "aria-labelledby": id, "aria-haspopup": "listbox", "aria-expanded": isOpen })] }), _jsx(ItemsContainer, { ...getMenuProps(), isOpen: isOpen, isFixedDropdown: isFixedDropdown, "aria-labelledby": id, children: isOpen &&
                            (noItems ? (_jsx("div", { style: { padding: '8px 16px', pointerEvents: 'none' }, children: _jsx(BodyText, { size: 3, scale: 'xs', lineHeight: 'xs', variation: "darkGray", children: noItemsMessage }) })) : (items.map((item, idx) => {
                                const isSelected = isEqual(item, selectedItem);
                                const isHighlighted = inputInteractionTypeRef.current ===
                                    InputInteractionType.keyboard &&
                                    highlightedIndex !== null &&
                                    highlightedIndex === idx;
                                return (_jsxs(ItemContainer, { align: "center", justify: "space-between", itemsSpacing: 10, ...getItemProps({ item, index: idx }), isHighlighted: isHighlighted, children: [_jsx(BodyText, { size: isSelected ? 1 : 3, style: {
                                                overflow: 'hidden',
                                                whiteSpace: 'nowrap',
                                                textOverflow: 'ellipsis',
                                            }, scale: 'xs', lineHeight: 'xs', children: itemNameGetter(item) }), areItemsRemovable && (_jsx(DeleteSvgIcon, { src: DeleteIcon, onClick: (ev) => handleRemoveItem(item, ev, downshift) }))] }, `${item}-${idx}`));
                            }))) })] }));
        } }));
}
export function MultiSelectDropdown(props) {
    const { id, items, value, label, placeholder, disabled, onSelect, onChange, onRemove, onClearAllItems, isFixedDropdown = false, } = props;
    const { getSelectedItemProps, getDropdownProps, addSelectedItem, removeSelectedItem, selectedItems, setSelectedItems, reset, } = useMultipleSelection({
        initialSelectedItems: value,
        onSelectedItemsChange: (changes) => {
            onSelect && onSelect(getChangeEvent(changes.selectedItems));
        },
    });
    const { isOpen, selectedItem, getToggleButtonProps, getLabelProps, getMenuProps, getItemProps, openMenu, highlightedIndex, } = useSelect({
        selectedItem: null,
        defaultHighlightedIndex: 0, // after selection, highlight the first item.
        items,
        stateReducer: (state, actionAndChanges) => {
            const { changes, type } = actionAndChanges;
            switch (type) {
                case useSelect.stateChangeTypes.ToggleButtonKeyDownEnter:
                case useSelect.stateChangeTypes.ToggleButtonKeyDownSpaceButton:
                case useSelect.stateChangeTypes.ItemClick:
                    return {
                        ...changes,
                        isOpen: true, // keep the menu open after selection.
                    };
                default:
                    return changes;
            }
        },
        onStateChange: ({ type, selectedItem: newSelectedItem }) => {
            switch (type) {
                case useSelect.stateChangeTypes.ToggleButtonKeyDownEnter:
                case useSelect.stateChangeTypes.ToggleButtonKeyDownSpaceButton:
                case useSelect.stateChangeTypes.ItemClick:
                    {
                        const isAlreadySelected = selectedItems.some((i) => i.value === newSelectedItem?.value);
                        if (newSelectedItem) {
                            if (isAlreadySelected) {
                                setSelectedItems(selectedItems.filter((i) => i.value !== newSelectedItem.value));
                                onRemove && onRemove(getChangeEvent(newSelectedItem));
                            }
                            else {
                                addSelectedItem(newSelectedItem);
                                onChange && onChange(getChangeEvent(newSelectedItem));
                            }
                        }
                    }
                    break;
                default:
                    break;
            }
        },
    });
    //Align resetting selected values if they were reset in parent
    useEffect(() => {
        if (!value || value.length < 1) {
            reset();
        }
    }, [value]);
    const handleClearAll = () => {
        onClearAllItems && onClearAllItems(getChangeEvent(null));
        reset();
    };
    const handleFocus = (ev) => {
        ev.stopPropagation();
        if (disabled) {
            return;
        }
        !isOpen && openMenu();
    };
    const inputInteractionTypeRef = useGetInputInteractionType();
    return (_jsx(StyledDropdown, { disabled: disabled, isFixedDropdown: isFixedDropdown, children: _jsxs(FlexColumn, { itemsSpacing: 4, children: [label && (_jsx(BodyText, { lineHeight: 'xs', ...getLabelProps(), size: 1, id: id, children: label })), _jsxs("div", { children: [_jsxs(MultiSelectContainer, { align: "center", justify: "space-between", ...getToggleButtonProps({
                                ...getDropdownProps({ preventKeyAction: isOpen }),
                                onClick: (e) => e.stopPropagation(),
                                isOpen,
                            }), children: [_jsx("span", { children: _jsx(BodyText, { lineHeight: 'xs', size: 3, variation: selectedItem ? 'inherit' : 'darkGray', children: _jsx(OverflowWrapper, { children: _jsx(FlexRow, { gap: 8, wrap: 'wrap', children: selectedItems.length === 0 ? (_jsx(PlaceholderWrapper, { children: placeholder })) : (selectedItems.map((selectedItem, index) => (_jsx(ChipItemContainer, { ...getSelectedItemProps({ selectedItem, index }), children: _jsxs(FlexRow, { align: 'center', gap: 4, children: [selectedItem?.chipName && (_jsx(BodyText, { lineHeight: 'xs', size: 1, variation: 'black', children: selectedItem.chipName })), selectedItem?.chipLabel || selectedItem?.label, _jsx(MultiSelectDeleteIcon, { onClick: (event) => {
                                                                    event.preventDefault();
                                                                    event.stopPropagation();
                                                                    removeSelectedItem(selectedItem);
                                                                    onRemove &&
                                                                        onRemove(getChangeEvent(selectedItem));
                                                                }, size: 14, src: DeleteIcon, alt: 'Cross icon to clear', role: 'img' })] }) }, `selected-item-${index}`)))) }) }) }) }), _jsxs(DropdownIconWrapper, { children: [onClearAllItems && !!selectedItems.length && (_jsx(ClearSvgIcon, { src: DeleteIcon, onClick: handleClearAll, marginRight: true, role: 'img', alt: 'Cross icon to clear items' })), _jsx(SvgIcon, { size: 16, src: isOpen ? UpIcon : DownIcon, rotate: isOpen, onKeyDown: (ev) => {
                                                if (ev.key === 'Enter') {
                                                    handleFocus(ev);
                                                }
                                            }, tabIndex: 0, alt: 'Arrow icon', "aria-labelledby": id, "aria-haspopup": "listbox", "aria-expanded": isOpen, role: 'button' })] })] }), _jsx(ItemsContainer, { ...getMenuProps(), isOpen: isOpen, isFixedDropdown: isFixedDropdown, children: isOpen &&
                                items.map((item, index) => {
                                    const isSelected = selectedItems?.some((i) => i.value === item.value);
                                    const isHighlighted = inputInteractionTypeRef.current ===
                                        InputInteractionType.keyboard &&
                                        highlightedIndex !== null &&
                                        highlightedIndex === index;
                                    return (_jsxs(ItemContainer, { align: "center", justify: "space-between", itemsSpacing: 10, ...getItemProps({ item, index }), isHighlighted: isHighlighted, children: [_jsx(BodyText, { size: isSelected ? 1 : 3, lineHeight: 'xs', scale: 'xs', children: item.label }), isSelected && _jsx(CheckIcon, { size: 14, src: CheckmarkIcon })] }, `${item.value}${index}`));
                                }) })] })] }) }));
}
export default Dropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZHJvcGRvd24vZHJvcGRvd24udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFjLEVBQUUsU0FBUyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQ3pDLE9BQU8sU0FBUyxFQUFFLEVBRWhCLG9CQUFvQixFQUNwQixTQUFTLEdBQ1YsTUFBTSxXQUFXLENBQUM7QUFDbkIsT0FBTyxNQUFNLE1BQU0sbUJBQW1CLENBQUM7QUFDdkMsT0FBTyxPQUFPLE1BQU0saUJBQWlCLENBQUM7QUFJdEMsT0FBTyxRQUFRLE1BQU0sd0JBQXdCLENBQUM7QUFDOUMsT0FBTyxPQUF5QixNQUFNLHNCQUFzQixDQUFDO0FBQzdELE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sVUFBVSxNQUFNLDRCQUE0QixDQUFDO0FBQ3BELE9BQU8sRUFDTCxvQkFBb0IsRUFDcEIsMEJBQTBCLEdBQzNCLE1BQU0sb0NBQW9DLENBQUM7QUFFNUMsT0FBTyxNQUFNLE1BQU0sb0NBQW9DLENBQUM7QUFDeEQsT0FBTyxRQUFRLE1BQU0sc0NBQXNDLENBQUM7QUFDNUQsT0FBTyxhQUFhLE1BQU0scUNBQXFDLENBQUM7QUFDaEUsT0FBTyxVQUFVLE1BQU0sa0NBQWtDLENBQUM7QUFFMUQsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FHOUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDNUMsT0FBTyxFQUFFLE1BQU07SUFDZixRQUFRLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE9BQU87SUFDaEQsR0FBRyxDQUFDLFFBQVEsSUFBSTtRQUNkLE9BQU8sRUFBRSxLQUFLO1FBQ2QsYUFBYSxFQUFFLE1BQU07S0FDdEIsQ0FBQztDQUNI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dkIsWUFBWSxFQUFFLEVBQUUsS0FFWixZQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFDakMsYUFBYSxFQUFFLGFBQWEsYUFFNUIsS0FBQyxRQUFRLElBQ1AsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQ3hCLFVBQVUsRUFBRSxJQUFJLEVBQ2hCLEtBQUssRUFBRSxJQUFJLFlBRVYsSUFBSSxDQUFDLEtBQUssR0FDRixFQUNWLFVBQVUsSUFBSSxLQUFDLFNBQVMsSUFBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxhQUFhLEdBQUksS0FYckQsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssRUFBRSxDQVlkLENBQ2pCLENBQUM7Z0NBQ0osQ0FBQyxDQUFDLEdBQ1csSUFDYixJQUNLLEdBQ0UsQ0FDbEIsQ0FBQztBQUNKLENBQUM7QUFFRCxlQUFlLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgRG93bnNoaWZ0LCB7XG4gIENvbnRyb2xsZXJTdGF0ZUFuZEhlbHBlcnMsXG4gIHVzZU11bHRpcGxlU2VsZWN0aW9uLFxuICB1c2VTZWxlY3QsXG59IGZyb20gJ2Rvd25zaGlmdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBpc0VxdWFsIGZyb20gJ2Zhc3QtZGVlcC1lcXVhbCc7XG5cbmltcG9ydCB7IEJhc2VQcm9wcyB9IGZyb20gJy4uLy4uL3R5cGVzJztcblxuaW1wb3J0IEJvZHlUZXh0IGZyb20gJy4uL2JvZHktdGV4dC9ib2R5LXRleHQnO1xuaW1wb3J0IEZsZXhSb3csIHsgRmxleFJvd1Byb3BzIH0gZnJvbSAnLi4vZmxleC1yb3cvZmxleC1yb3cnO1xuaW1wb3J0IFN2Z0ljb24gZnJvbSAnLi4vc3ZnLWljb24vc3ZnLWljb24nO1xuaW1wb3J0IEZsZXhDb2x1bW4gZnJvbSAnLi4vZmxleC1jb2x1bW4vZmxleC1jb2x1bW4nO1xuaW1wb3J0IHtcbiAgSW5wdXRJbnRlcmFjdGlvblR5cGUsXG4gIHVzZUdldElucHV0SW50ZXJhY3Rpb25UeXBlLFxufSBmcm9tICcuLi8uLi91dGlscy9pbnB1dC1pbnRlcmFjdGlvbi10eXBlJztcblxuaW1wb3J0IFVwSWNvbiBmcm9tICcuLi8uLi9hc3NldHMvaWNvbnMvaWMtYXJyb3ctdXAuc3ZnJztcbmltcG9ydCBEb3duSWNvbiBmcm9tICcuLi8uLi9hc3NldHMvaWNvbnMvaWMtYXJyb3ctZG93bi5zdmcnO1xuaW1wb3J0IENoZWNrbWFya0ljb24gZnJvbSAnLi4vLi4vYXNzZXRzL2ljb25zL2ljLWNoZWNrbWFyay5zdmcnO1xuaW1wb3J0IERlbGV0ZUljb24gZnJvbSAnLi4vLi4vYXNzZXRzL2ljb25zL2ljLWRlbGV0ZS5zdmcnO1xuXG5jb25zdCBTdHlsZWREcm9wZG93biA9IHN0eWxlZC5kaXY8e1xuICBpc0ZpeGVkRHJvcGRvd24/OiBib29sZWFuO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG59PigoeyB0aGVtZSwgZGlzYWJsZWQsIGlzRml4ZWREcm9wZG93biB9KSA9PiAoe1xuICBvdXRsaW5lOiAnbm9uZScsXG4gIHBvc2l0aW9uOiBpc0ZpeGVkRHJvcGRvd24gPyAncmVsYXRpdmUnIDogJ3Vuc2V0JyxcbiAgLi4uKGRpc2FibGVkICYmIHtcbiAgICBvcGFjaXR5OiAnMC41JyxcbiAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScsXG4gIH0pLFxufSkpO1xuXG5jb25zdCBDb250YWluZXIgPSBzdHlsZWQoRmxleFJvdyk8eyBpc09wZW46IGJvb2xlYW4gfT4oKHsgdGhlbWUsIGlzT3BlbiB9KSA9PiAoe1xuICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICBib3JkZXI6ICdub25lJyxcbiAgaGVpZ2h0OiAzNixcbiAgcGFkZGluZzogJzAgMTZweCcsXG4gIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgc3ZnOiB7XG4gICAgICBjb2xvcjogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsUHJpbWFyeVJlZCxcbiAgICB9LFxuICB9LFxufSkpO1xuXG5jb25zdCBJdGVtc0NvbnRhaW5lciA9IHN0eWxlZC5kaXY8e1xuICBpc09wZW46IGJvb2xlYW47XG4gIGlzRml4ZWREcm9wZG93bj86IGJvb2xlYW47XG59PigoeyB0aGVtZSwgaXNPcGVuLCBpc0ZpeGVkRHJvcGRvd24gfSkgPT4gKHtcbiAgZGlzcGxheTogaXNPcGVuID8gJ2luaGVyaXQnIDogJ25vbmUnLFxuICBtYXJnaW5Ub3A6IDQsXG4gIGJvcmRlclJhZGl1czogdGhlbWUuYm9yZGVyUmFkaXVzLmJhc2UsXG4gIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgLi4uKGlzRml4ZWREcm9wZG93biAmJiB7XG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgdG9wOiAnNjBweCcsXG4gICAgd2lkdGg6ICcxMDAlJyxcbiAgICB6SW5kZXg6IDEsXG4gIH0pLFxufSkpO1xuXG5jb25zdCBJdGVtQ29udGFpbmVyID0gc3R5bGVkKEZsZXhSb3cpPFxuICBGbGV4Um93UHJvcHMgJiB7IGlzSGlnaGxpZ2h0ZWQ/OiBib29sZWFuIH1cbj4oKHsgdGhlbWUsIGlzSGlnaGxpZ2h0ZWQgfSkgPT4gKHtcbiAgY3Vyc29yOiAncG9pbnRlcicsXG4gIG1pbkhlaWdodDogMzYsXG4gIHBhZGRpbmc6ICc4cHggMTZweCcsXG4gICc6aG92ZXIsIDphY3RpdmUnOiB7XG4gICAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5Qmx1ZUhvdmVyLFxuICAgIGZvbnRXZWlnaHQ6IDYwMCxcbiAgfSxcbiAgLi4uKGlzSGlnaGxpZ2h0ZWQgJiYge1xuICAgICcmOm5vdCg6aG92ZXIpJzoge1xuICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkICR7dGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50Qmx1ZX1gLFxuICAgICAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgICB9LFxuICB9KSxcbn0pKTtcblxuY29uc3QgRGVsZXRlU3ZnSWNvbiA9IHN0eWxlZChTdmdJY29uKSgoeyB0aGVtZSB9KSA9PiAoe1xuICBwYXRoOiB7XG4gICAgc3Ryb2tlOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRTZWNvbmRhcnksXG4gIH0sXG4gICc6aG92ZXIsIDphY3RpdmUnOiB7XG4gICAgcGF0aDoge1xuICAgICAgc3Ryb2tlOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxQcmltYXJ5UmVkLFxuICAgIH0sXG4gIH0sXG59KSk7XG5cbmNvbnN0IENsZWFyU3ZnSWNvbiA9IHN0eWxlZChTdmdJY29uKSgoeyB0aGVtZSB9KSA9PiAoe1xuICBwYXRoOiB7XG4gICAgc3Ryb2tlOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxuICB9LFxufSkpO1xuXG5jb25zdCBNdWx0aVNlbGVjdENvbnRhaW5lciA9IHN0eWxlZChGbGV4Um93KTx7IGlzT3BlbjogYm9vbGVhbiB9PihcbiAgKHsgdGhlbWUgfSkgPT4gKHtcbiAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICAgIHBhZGRpbmc6ICc4cHgnLFxuICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgICAnOmhvdmVyLCA6YWN0aXZlJzoge1xuICAgICAgc3ZnOiB7XG4gICAgICAgIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxQcmltYXJ5UmVkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KSxcbik7XG5cbmNvbnN0IFBsYWNlaG9sZGVyV3JhcHBlciA9IHN0eWxlZC5zcGFuKCh7IHRoZW1lIH0pID0+ICh7XG4gIHBhZGRpbmc6ICcwIDhweCcsXG59KSk7XG5cbmNvbnN0IENoaXBJdGVtQ29udGFpbmVyID0gc3R5bGVkLnNwYW4oKHsgdGhlbWUgfSkgPT4gKHtcbiAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgY3Vyc29yOiAncG9pbnRlcicsXG4gIHBhZGRpbmc6ICcycHggOHB4JyxcbiAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsVGVydGlhcnksXG4gIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxufSkpO1xuXG5jb25zdCBPdmVyZmxvd1dyYXBwZXIgPSBzdHlsZWQuc3BhbigoeyB0aGVtZSB9KSA9PiAoe1xuICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICB0ZXh0T3ZlcmZsb3c6ICdlbGxpcHNpcycsXG59KSk7XG5cbmNvbnN0IERyb3Bkb3duSWNvbldyYXBwZXIgPSBzdHlsZWQoRmxleFJvdykoKHsgdGhlbWUgfSkgPT4gKHtcbiAgcGFkZGluZ1JpZ2h0OiAnOHB4JyxcbiAgbWFyZ2luTGVmdDogJzhweCcsXG59KSk7XG5cbmNvbnN0IENoZWNrSWNvbiA9IHN0eWxlZChTdmdJY29uKSgoeyB0aGVtZSB9KSA9PiAoe1xuICBwYXRoOiB7XG4gICAgZmlsbDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50Qmx1ZSxcbiAgfSxcbn0pKTtcblxuY29uc3QgTXVsdGlTZWxlY3REZWxldGVJY29uID0gc3R5bGVkKFN2Z0ljb24pKCh7IHRoZW1lIH0pID0+ICh7XG4gIHBhdGg6IHtcbiAgICBzdHJva2U6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudEJsdWUsXG4gIH0sXG4gICc6aG92ZXIsIDphY3RpdmUnOiB7XG4gICAgcGF0aDoge1xuICAgICAgc3Ryb2tlOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRSZWQsXG4gICAgfSxcbiAgfSxcbn0pKTtcblxuZXhwb3J0IHR5cGUgRHJvcGRvd25WYWx1ZSA9IHsgdmFsdWU6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9O1xuZXhwb3J0IHR5cGUgRHJvcGRvd25JdGVtPFQgPSBEcm9wZG93blZhbHVlPiA9IFQ7XG5cbmV4cG9ydCB0eXBlIERyb3Bkb3duRXZlbnRWYWx1ZSA9IHtcbiAgdGFyZ2V0OiB7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICB2YWx1ZTogRHJvcGRvd25WYWx1ZSB8IG51bGw7XG4gIH07XG59O1xuXG4vKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cbmV4cG9ydCBpbnRlcmZhY2UgRHJvcGRvd25Qcm9wcyBleHRlbmRzIEJhc2VQcm9wcyB7XG4gIGlkPzogc3RyaW5nO1xuICBpdGVtczogRHJvcGRvd25WYWx1ZVtdO1xuICB2YWx1ZT86IERyb3Bkb3duVmFsdWUgfCBudWxsO1xuICBsYWJlbD86IHN0cmluZztcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIGFyZUl0ZW1zUmVtb3ZhYmxlPzogYm9vbGVhbjtcbiAgb25DaGFuZ2U/OiAoZXY6IERyb3Bkb3duRXZlbnRWYWx1ZSkgPT4gdm9pZDtcbiAgb25TZWxlY3Q/OiAoZXY6IERyb3Bkb3duRXZlbnRWYWx1ZSkgPT4gdm9pZDtcbiAgb25SZW1vdmU/OiAoZXY6IERyb3Bkb3duRXZlbnRWYWx1ZSkgPT4gdm9pZDtcblxuICBub0l0ZW1zTWVzc2FnZT86IHN0cmluZztcbiAgaXNGaXhlZERyb3Bkb3duPzogYm9vbGVhbjtcbn1cblxuY29uc3QgZ2V0Q2hhbmdlRXZlbnQgPSAodmFsdWU6IGFueSk6IERyb3Bkb3duRXZlbnRWYWx1ZSA9PiB7XG4gIHJldHVybiB7XG4gICAgdGFyZ2V0OiB7XG4gICAgICBuYW1lOiB1bmRlZmluZWQsXG4gICAgICB2YWx1ZSxcbiAgICB9LFxuICB9O1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIERyb3Bkb3duKHByb3BzOiBEcm9wZG93blByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBpZCxcbiAgICBpdGVtcyxcbiAgICBwbGFjZWhvbGRlcixcbiAgICBsYWJlbCxcbiAgICBhcmVJdGVtc1JlbW92YWJsZSxcbiAgICB2YWx1ZSxcbiAgICBzdHlsZSxcbiAgICBvblNlbGVjdCxcbiAgICBvblJlbW92ZSxcbiAgICBub0l0ZW1zTWVzc2FnZSA9ICdObyBPcHRpb25zIScsXG4gICAgaXNGaXhlZERyb3Bkb3duID0gZmFsc2UsXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCBnZXRDaGFuZ2VFdmVudCA9ICh2YWx1ZTogRHJvcGRvd25WYWx1ZSB8IG51bGwpOiBEcm9wZG93bkV2ZW50VmFsdWUgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICB0YXJnZXQ6IHtcbiAgICAgICAgbmFtZTogdW5kZWZpbmVkLFxuICAgICAgICB2YWx1ZSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVSZW1vdmVJdGVtID0gKFxuICAgIGl0ZW06IERyb3Bkb3duSXRlbSxcbiAgICBldixcbiAgICBkb3duc2hpZnQ6IENvbnRyb2xsZXJTdGF0ZUFuZEhlbHBlcnM8RHJvcGRvd25JdGVtPixcbiAgKSA9PiB7XG4gICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIGNvbnN0IHZhbHVlID0gaXRlbSAmJiBpdGVtVmFsdWVHZXR0ZXIoaXRlbSk7XG4gICAgb25SZW1vdmUgJiYgb25SZW1vdmUoZ2V0Q2hhbmdlRXZlbnQodmFsdWUpKTtcbiAgfTtcblxuICBjb25zdCBpdGVtVmFsdWVHZXR0ZXIgPSAoaXRlbSkgPT4gaXRlbS52YWx1ZTtcbiAgY29uc3QgaXRlbU5hbWVHZXR0ZXIgPSAoaXRlbSkgPT4gaXRlbS5sYWJlbDtcblxuICBjb25zdCBoYW5kbGVJdGVtU2VsZWN0ID0gKGl0ZW0pID0+IHtcbiAgICBvblNlbGVjdCAmJiBvblNlbGVjdChpdGVtKTtcbiAgfTtcblxuICBjb25zdCBnZXRJdGVtVG9TdHJpbmcgPSAoaXRlbSkgPT4ge1xuICAgIGlmIChpdGVtID09PSBudWxsKSByZXR1cm4gJyc7XG4gICAgcmV0dXJuIHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmxhYmVsO1xuICB9O1xuXG4gIGNvbnN0IGlucHV0SW50ZXJhY3Rpb25UeXBlUmVmID0gdXNlR2V0SW5wdXRJbnRlcmFjdGlvblR5cGUoKTtcblxuICByZXR1cm4gKFxuICAgIDxEb3duc2hpZnRcbiAgICAgIGl0ZW1Ub1N0cmluZz17Z2V0SXRlbVRvU3RyaW5nfVxuICAgICAgb25TZWxlY3Q9e2hhbmRsZUl0ZW1TZWxlY3R9XG4gICAgICBzZWxlY3RlZEl0ZW09e3ZhbHVlfVxuICAgICAgc2VsZWN0ZWRJdGVtQ2hhbmdlZD17KHByZXZJdGVtLCBpdGVtKSA9PiAhaXNFcXVhbChwcmV2SXRlbSwgaXRlbSl9XG4gICAgPlxuICAgICAgeyhkb3duc2hpZnQpID0+IHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIGdldEl0ZW1Qcm9wcyxcbiAgICAgICAgICBnZXRNZW51UHJvcHMsXG4gICAgICAgICAgaXNPcGVuLFxuICAgICAgICAgIHNlbGVjdGVkSXRlbSxcbiAgICAgICAgICBnZXRSb290UHJvcHMsXG4gICAgICAgICAgZ2V0VG9nZ2xlQnV0dG9uUHJvcHMsXG4gICAgICAgICAgaGlnaGxpZ2h0ZWRJbmRleCxcbiAgICAgICAgfSA9IGRvd25zaGlmdDtcblxuICAgICAgICBjb25zdCBub0l0ZW1zID0gIShpdGVtcyAmJiBpdGVtcy5sZW5ndGgpO1xuXG4gICAgICAgIGNvbnN0IGhhbmRsZUZvY3VzID0gKGV2KSA9PiB7XG4gICAgICAgICAgIWlzT3BlbiAmJiBkb3duc2hpZnQub3Blbk1lbnUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxTdHlsZWREcm9wZG93blxuICAgICAgICAgICAgey4uLmdldFJvb3RQcm9wcyh7IHJlZktleTogJ2lubmVyUmVmJyB9KX1cbiAgICAgICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgICAgICAgIGlzRml4ZWREcm9wZG93bj17aXNGaXhlZERyb3Bkb3dufVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtsYWJlbCAmJiAoXG4gICAgICAgICAgICAgIDxCb2R5VGV4dFxuICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ9eyd4cyd9XG4gICAgICAgICAgICAgICAgc2l6ZT17MX1cbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXtsYWJlbH1cbiAgICAgICAgICAgICAgICBpZD17aWR9XG4gICAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7bGFiZWx9XG4gICAgICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgPENvbnRhaW5lclxuICAgICAgICAgICAgICBhbGlnbj1cImNlbnRlclwiXG4gICAgICAgICAgICAgIGp1c3RpZnk9XCJzcGFjZS1iZXR3ZWVuXCJcbiAgICAgICAgICAgICAgey4uLmdldFRvZ2dsZUJ1dHRvblByb3BzKCl9XG4gICAgICAgICAgICAgIGlzT3Blbj17aXNPcGVufVxuICAgICAgICAgICAgICBpdGVtc1NwYWNpbmc9ezEwfVxuICAgICAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgICAgICAgc2l6ZT17M31cbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0PXsneHMnfVxuICAgICAgICAgICAgICAgIHZhcmlhdGlvbj17c2VsZWN0ZWRJdGVtID8gJ2luaGVyaXQnIDogJ2RhcmtHcmF5J31cbiAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcsXG4gICAgICAgICAgICAgICAgICB0ZXh0T3ZlcmZsb3c6ICdlbGxpcHNpcycsXG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHtpdGVtTmFtZUdldHRlcihzZWxlY3RlZEl0ZW0pIHx8IHBsYWNlaG9sZGVyfVxuICAgICAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgICAgICA8U3ZnSWNvblxuICAgICAgICAgICAgICAgIHNyYz17aXNPcGVuID8gVXBJY29uIDogRG93bkljb259XG4gICAgICAgICAgICAgICAgcm90YXRlPXtpc09wZW59XG4gICAgICAgICAgICAgICAgb25LZXlEb3duPXsoZXYpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChldi5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRm9jdXMoZXYpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgICAgYWx0PXsnQXJyb3cgaWNvbid9XG4gICAgICAgICAgICAgICAgcm9sZT17J2ltZyd9XG4gICAgICAgICAgICAgICAgYXJpYS1sYWJlbGxlZGJ5PXtpZH1cbiAgICAgICAgICAgICAgICBhcmlhLWhhc3BvcHVwPVwibGlzdGJveFwiXG4gICAgICAgICAgICAgICAgYXJpYS1leHBhbmRlZD17aXNPcGVufVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Db250YWluZXI+XG4gICAgICAgICAgICA8SXRlbXNDb250YWluZXJcbiAgICAgICAgICAgICAgey4uLmdldE1lbnVQcm9wcygpfVxuICAgICAgICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgICAgICAgaXNGaXhlZERyb3Bkb3duPXtpc0ZpeGVkRHJvcGRvd259XG4gICAgICAgICAgICAgIGFyaWEtbGFiZWxsZWRieT17aWR9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtpc09wZW4gJiZcbiAgICAgICAgICAgICAgICAobm9JdGVtcyA/IChcbiAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogJzhweCAxNnB4JywgcG9pbnRlckV2ZW50czogJ25vbmUnIH19PlxuICAgICAgICAgICAgICAgICAgICA8Qm9keVRleHRcbiAgICAgICAgICAgICAgICAgICAgICBzaXplPXszfVxuICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPXsneHMnfVxuICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ9eyd4cyd9XG4gICAgICAgICAgICAgICAgICAgICAgdmFyaWF0aW9uPVwiZGFya0dyYXlcIlxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAge25vSXRlbXNNZXNzYWdlfVxuICAgICAgICAgICAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICAgIGl0ZW1zLm1hcCgoaXRlbSwgaWR4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBpc0VxdWFsKGl0ZW0sIHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSGlnaGxpZ2h0ZWQgPVxuICAgICAgICAgICAgICAgICAgICAgIGlucHV0SW50ZXJhY3Rpb25UeXBlUmVmLmN1cnJlbnQgPT09XG4gICAgICAgICAgICAgICAgICAgICAgICBJbnB1dEludGVyYWN0aW9uVHlwZS5rZXlib2FyZCAmJlxuICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkSW5kZXggIT09IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZEluZGV4ID09PSBpZHg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgPEl0ZW1Db250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17YCR7aXRlbX0tJHtpZHh9YH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduPVwiY2VudGVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGp1c3RpZnk9XCJzcGFjZS1iZXR3ZWVuXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zU3BhY2luZz17MTB9XG4gICAgICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0SXRlbVByb3BzKHsgaXRlbSwgaW5kZXg6IGlkeCB9KX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSGlnaGxpZ2h0ZWQ9e2lzSGlnaGxpZ2h0ZWR9XG4gICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU9e2lzU2VsZWN0ZWQgPyAxIDogM31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodD17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge2l0ZW1OYW1lR2V0dGVyKGl0ZW0pfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHthcmVJdGVtc1JlbW92YWJsZSAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxEZWxldGVTdmdJY29uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXtEZWxldGVJY29ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhldikgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVJlbW92ZUl0ZW0oaXRlbSwgZXYsIGRvd25zaGlmdClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgIDwvSXRlbUNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICA8L0l0ZW1zQ29udGFpbmVyPlxuICAgICAgICAgIDwvU3R5bGVkRHJvcGRvd24+XG4gICAgICAgICk7XG4gICAgICB9fVxuICAgIDwvRG93bnNoaWZ0PlxuICApO1xufVxuXG5leHBvcnQgdHlwZSBNdWx0aURyb3Bkb3duVmFsdWUgPSB7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGNoaXBMYWJlbD86IHN0cmluZztcbiAgY2hpcE5hbWU/OiBzdHJpbmc7XG4gIHZhbHVlOiBhbnk7XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIE11bHRpU2VsZWN0RHJvcGRvd25Qcm9wcyBleHRlbmRzIEJhc2VQcm9wcyB7XG4gIGlkPzogc3RyaW5nO1xuICB2YWx1ZT86IE11bHRpRHJvcGRvd25WYWx1ZVtdO1xuICBpdGVtczogTXVsdGlEcm9wZG93blZhbHVlW107XG4gIGxhYmVsPzogc3RyaW5nIHwgSlNYLkVsZW1lbnQ7XG4gIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIG9uQ2hhbmdlPzogKGV2OiBEcm9wZG93bkV2ZW50VmFsdWUpID0+IHZvaWQ7XG4gIG9uU2VsZWN0PzogKGV2OiBEcm9wZG93bkV2ZW50VmFsdWUpID0+IHZvaWQ7XG4gIG9uUmVtb3ZlPzogKGV2OiBEcm9wZG93bkV2ZW50VmFsdWUpID0+IHZvaWQ7XG4gIG9uQ2xlYXJBbGxJdGVtcz86IChldjogRHJvcGRvd25FdmVudFZhbHVlKSA9PiB2b2lkO1xuICBpc0ZpeGVkRHJvcGRvd24/OiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gTXVsdGlTZWxlY3REcm9wZG93bihwcm9wczogTXVsdGlTZWxlY3REcm9wZG93blByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBpZCxcbiAgICBpdGVtcyxcbiAgICB2YWx1ZSxcbiAgICBsYWJlbCxcbiAgICBwbGFjZWhvbGRlcixcbiAgICBkaXNhYmxlZCxcbiAgICBvblNlbGVjdCxcbiAgICBvbkNoYW5nZSxcbiAgICBvblJlbW92ZSxcbiAgICBvbkNsZWFyQWxsSXRlbXMsXG4gICAgaXNGaXhlZERyb3Bkb3duID0gZmFsc2UsXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCB7XG4gICAgZ2V0U2VsZWN0ZWRJdGVtUHJvcHMsXG4gICAgZ2V0RHJvcGRvd25Qcm9wcyxcbiAgICBhZGRTZWxlY3RlZEl0ZW0sXG4gICAgcmVtb3ZlU2VsZWN0ZWRJdGVtLFxuICAgIHNlbGVjdGVkSXRlbXMsXG4gICAgc2V0U2VsZWN0ZWRJdGVtcyxcbiAgICByZXNldCxcbiAgfSA9IHVzZU11bHRpcGxlU2VsZWN0aW9uPE11bHRpRHJvcGRvd25WYWx1ZT4oe1xuICAgIGluaXRpYWxTZWxlY3RlZEl0ZW1zOiB2YWx1ZSxcbiAgICBvblNlbGVjdGVkSXRlbXNDaGFuZ2U6IChjaGFuZ2VzKSA9PiB7XG4gICAgICBvblNlbGVjdCAmJiBvblNlbGVjdChnZXRDaGFuZ2VFdmVudChjaGFuZ2VzLnNlbGVjdGVkSXRlbXMpKTtcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCB7XG4gICAgaXNPcGVuLFxuICAgIHNlbGVjdGVkSXRlbSxcbiAgICBnZXRUb2dnbGVCdXR0b25Qcm9wcyxcbiAgICBnZXRMYWJlbFByb3BzLFxuICAgIGdldE1lbnVQcm9wcyxcbiAgICBnZXRJdGVtUHJvcHMsXG4gICAgb3Blbk1lbnUsXG4gICAgaGlnaGxpZ2h0ZWRJbmRleCxcbiAgfSA9IHVzZVNlbGVjdCh7XG4gICAgc2VsZWN0ZWRJdGVtOiBudWxsLFxuICAgIGRlZmF1bHRIaWdobGlnaHRlZEluZGV4OiAwLCAvLyBhZnRlciBzZWxlY3Rpb24sIGhpZ2hsaWdodCB0aGUgZmlyc3QgaXRlbS5cbiAgICBpdGVtcyxcbiAgICBzdGF0ZVJlZHVjZXI6IChzdGF0ZSwgYWN0aW9uQW5kQ2hhbmdlcykgPT4ge1xuICAgICAgY29uc3QgeyBjaGFuZ2VzLCB0eXBlIH0gPSBhY3Rpb25BbmRDaGFuZ2VzO1xuICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgdXNlU2VsZWN0LnN0YXRlQ2hhbmdlVHlwZXMuVG9nZ2xlQnV0dG9uS2V5RG93bkVudGVyOlxuICAgICAgICBjYXNlIHVzZVNlbGVjdC5zdGF0ZUNoYW5nZVR5cGVzLlRvZ2dsZUJ1dHRvbktleURvd25TcGFjZUJ1dHRvbjpcbiAgICAgICAgY2FzZSB1c2VTZWxlY3Quc3RhdGVDaGFuZ2VUeXBlcy5JdGVtQ2xpY2s6XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLmNoYW5nZXMsXG4gICAgICAgICAgICBpc09wZW46IHRydWUsIC8vIGtlZXAgdGhlIG1lbnUgb3BlbiBhZnRlciBzZWxlY3Rpb24uXG4gICAgICAgICAgfTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gY2hhbmdlcztcbiAgICAgIH1cbiAgICB9LFxuICAgIG9uU3RhdGVDaGFuZ2U6ICh7IHR5cGUsIHNlbGVjdGVkSXRlbTogbmV3U2VsZWN0ZWRJdGVtIH0pID0+IHtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIHVzZVNlbGVjdC5zdGF0ZUNoYW5nZVR5cGVzLlRvZ2dsZUJ1dHRvbktleURvd25FbnRlcjpcbiAgICAgICAgY2FzZSB1c2VTZWxlY3Quc3RhdGVDaGFuZ2VUeXBlcy5Ub2dnbGVCdXR0b25LZXlEb3duU3BhY2VCdXR0b246XG4gICAgICAgIGNhc2UgdXNlU2VsZWN0LnN0YXRlQ2hhbmdlVHlwZXMuSXRlbUNsaWNrOlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IGlzQWxyZWFkeVNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtcy5zb21lKFxuICAgICAgICAgICAgICAoaSkgPT4gaS52YWx1ZSA9PT0gbmV3U2VsZWN0ZWRJdGVtPy52YWx1ZSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChuZXdTZWxlY3RlZEl0ZW0pIHtcbiAgICAgICAgICAgICAgaWYgKGlzQWxyZWFkeVNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRJdGVtcyhcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMuZmlsdGVyKFxuICAgICAgICAgICAgICAgICAgICAoaSkgPT4gaS52YWx1ZSAhPT0gbmV3U2VsZWN0ZWRJdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIG9uUmVtb3ZlICYmIG9uUmVtb3ZlKGdldENoYW5nZUV2ZW50KG5ld1NlbGVjdGVkSXRlbSkpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFkZFNlbGVjdGVkSXRlbShuZXdTZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgICAgIG9uQ2hhbmdlICYmIG9uQ2hhbmdlKGdldENoYW5nZUV2ZW50KG5ld1NlbGVjdGVkSXRlbSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0sXG4gIH0pO1xuXG4gIC8vQWxpZ24gcmVzZXR0aW5nIHNlbGVjdGVkIHZhbHVlcyBpZiB0aGV5IHdlcmUgcmVzZXQgaW4gcGFyZW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS5sZW5ndGggPCAxKSB7XG4gICAgICByZXNldCgpO1xuICAgIH1cbiAgfSwgW3ZhbHVlXSk7XG5cbiAgY29uc3QgaGFuZGxlQ2xlYXJBbGwgPSAoKSA9PiB7XG4gICAgb25DbGVhckFsbEl0ZW1zICYmIG9uQ2xlYXJBbGxJdGVtcyhnZXRDaGFuZ2VFdmVudChudWxsKSk7XG4gICAgcmVzZXQoKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVGb2N1cyA9IChldikgPT4ge1xuICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmIChkaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAhaXNPcGVuICYmIG9wZW5NZW51KCk7XG4gIH07XG5cbiAgY29uc3QgaW5wdXRJbnRlcmFjdGlvblR5cGVSZWYgPSB1c2VHZXRJbnB1dEludGVyYWN0aW9uVHlwZSgpO1xuXG4gIHJldHVybiAoXG4gICAgPFN0eWxlZERyb3Bkb3duIGRpc2FibGVkPXtkaXNhYmxlZH0gaXNGaXhlZERyb3Bkb3duPXtpc0ZpeGVkRHJvcGRvd259PlxuICAgICAgPEZsZXhDb2x1bW4gaXRlbXNTcGFjaW5nPXs0fT5cbiAgICAgICAge2xhYmVsICYmIChcbiAgICAgICAgICA8Qm9keVRleHQgbGluZUhlaWdodD17J3hzJ30gey4uLmdldExhYmVsUHJvcHMoKX0gc2l6ZT17MX0gaWQ9e2lkfT5cbiAgICAgICAgICAgIHtsYWJlbH1cbiAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICApfVxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxNdWx0aVNlbGVjdENvbnRhaW5lclxuICAgICAgICAgICAgYWxpZ249XCJjZW50ZXJcIlxuICAgICAgICAgICAganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIlxuICAgICAgICAgICAgey4uLmdldFRvZ2dsZUJ1dHRvblByb3BzKHtcbiAgICAgICAgICAgICAgLi4uZ2V0RHJvcGRvd25Qcm9wcyh7IHByZXZlbnRLZXlBY3Rpb246IGlzT3BlbiB9KSxcbiAgICAgICAgICAgICAgb25DbGljazogKGUpID0+IGUuc3RvcFByb3BhZ2F0aW9uKCksXG4gICAgICAgICAgICAgIGlzT3BlbixcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICA8Qm9keVRleHRcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0PXsneHMnfVxuICAgICAgICAgICAgICAgIHNpemU9ezN9XG4gICAgICAgICAgICAgICAgdmFyaWF0aW9uPXtzZWxlY3RlZEl0ZW0gPyAnaW5oZXJpdCcgOiAnZGFya0dyYXknfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPE92ZXJmbG93V3JhcHBlcj5cbiAgICAgICAgICAgICAgICAgIDxGbGV4Um93IGdhcD17OH0gd3JhcD17J3dyYXAnfT5cbiAgICAgICAgICAgICAgICAgICAge3NlbGVjdGVkSXRlbXMubGVuZ3RoID09PSAwID8gKFxuICAgICAgICAgICAgICAgICAgICAgIDxQbGFjZWhvbGRlcldyYXBwZXI+e3BsYWNlaG9sZGVyfTwvUGxhY2Vob2xkZXJXcmFwcGVyPlxuICAgICAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMubWFwKChzZWxlY3RlZEl0ZW0sIGluZGV4KSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8Q2hpcEl0ZW1Db250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtgc2VsZWN0ZWQtaXRlbS0ke2luZGV4fWB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHsuLi5nZXRTZWxlY3RlZEl0ZW1Qcm9wcyh7IHNlbGVjdGVkSXRlbSwgaW5kZXggfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxGbGV4Um93IGFsaWduPXsnY2VudGVyJ30gZ2FwPXs0fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2VsZWN0ZWRJdGVtPy5jaGlwTmFtZSAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm9keVRleHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodD17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT17MX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWF0aW9uPXsnYmxhY2snfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2VsZWN0ZWRJdGVtLmNoaXBOYW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZEl0ZW0/LmNoaXBMYWJlbCB8fCBzZWxlY3RlZEl0ZW0/LmxhYmVsfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxNdWx0aVNlbGVjdERlbGV0ZUljb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlU2VsZWN0ZWRJdGVtKHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uUmVtb3ZlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZW1vdmUoZ2V0Q2hhbmdlRXZlbnQoc2VsZWN0ZWRJdGVtKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT17MTR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmM9e0RlbGV0ZUljb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQ9eydDcm9zcyBpY29uIHRvIGNsZWFyJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU9eydpbWcnfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvRmxleFJvdz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQ2hpcEl0ZW1Db250YWluZXI+XG4gICAgICAgICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgIDwvRmxleFJvdz5cbiAgICAgICAgICAgICAgICA8L092ZXJmbG93V3JhcHBlcj5cbiAgICAgICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIDxEcm9wZG93bkljb25XcmFwcGVyPlxuICAgICAgICAgICAgICB7b25DbGVhckFsbEl0ZW1zICYmICEhc2VsZWN0ZWRJdGVtcy5sZW5ndGggJiYgKFxuICAgICAgICAgICAgICAgIDxDbGVhclN2Z0ljb25cbiAgICAgICAgICAgICAgICAgIHNyYz17RGVsZXRlSWNvbn1cbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsZWFyQWxsfVxuICAgICAgICAgICAgICAgICAgbWFyZ2luUmlnaHRcbiAgICAgICAgICAgICAgICAgIHJvbGU9eydpbWcnfVxuICAgICAgICAgICAgICAgICAgYWx0PXsnQ3Jvc3MgaWNvbiB0byBjbGVhciBpdGVtcyd9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgPFN2Z0ljb25cbiAgICAgICAgICAgICAgICBzaXplPXsxNn1cbiAgICAgICAgICAgICAgICBzcmM9e2lzT3BlbiA/IFVwSWNvbiA6IERvd25JY29ufVxuICAgICAgICAgICAgICAgIHJvdGF0ZT17aXNPcGVufVxuICAgICAgICAgICAgICAgIG9uS2V5RG93bj17KGV2KSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoZXYua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUZvY3VzKGV2KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIHRhYkluZGV4PXswfVxuICAgICAgICAgICAgICAgIGFsdD17J0Fycm93IGljb24nfVxuICAgICAgICAgICAgICAgIGFyaWEtbGFiZWxsZWRieT17aWR9XG4gICAgICAgICAgICAgICAgYXJpYS1oYXNwb3B1cD1cImxpc3Rib3hcIlxuICAgICAgICAgICAgICAgIGFyaWEtZXhwYW5kZWQ9e2lzT3Blbn1cbiAgICAgICAgICAgICAgICByb2xlPXsnYnV0dG9uJ31cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvRHJvcGRvd25JY29uV3JhcHBlcj5cbiAgICAgICAgICA8L011bHRpU2VsZWN0Q29udGFpbmVyPlxuICAgICAgICAgIDxJdGVtc0NvbnRhaW5lclxuICAgICAgICAgICAgey4uLmdldE1lbnVQcm9wcygpfVxuICAgICAgICAgICAgaXNPcGVuPXtpc09wZW59XG4gICAgICAgICAgICBpc0ZpeGVkRHJvcGRvd249e2lzRml4ZWREcm9wZG93bn1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7aXNPcGVuICYmXG4gICAgICAgICAgICAgIGl0ZW1zLm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1NlbGVjdGVkID0gc2VsZWN0ZWRJdGVtcz8uc29tZShcbiAgICAgICAgICAgICAgICAgIChpKSA9PiBpLnZhbHVlID09PSBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNIaWdobGlnaHRlZCA9XG4gICAgICAgICAgICAgICAgICBpbnB1dEludGVyYWN0aW9uVHlwZVJlZi5jdXJyZW50ID09PVxuICAgICAgICAgICAgICAgICAgICBJbnB1dEludGVyYWN0aW9uVHlwZS5rZXlib2FyZCAmJlxuICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWRJbmRleCAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWRJbmRleCA9PT0gaW5kZXg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgIDxJdGVtQ29udGFpbmVyXG4gICAgICAgICAgICAgICAgICAgIGFsaWduPVwiY2VudGVyXCJcbiAgICAgICAgICAgICAgICAgICAganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIlxuICAgICAgICAgICAgICAgICAgICBpdGVtc1NwYWNpbmc9ezEwfVxuICAgICAgICAgICAgICAgICAgICBrZXk9e2Ake2l0ZW0udmFsdWV9JHtpbmRleH1gfVxuICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0SXRlbVByb3BzKHsgaXRlbSwgaW5kZXggfSl9XG4gICAgICAgICAgICAgICAgICAgIGlzSGlnaGxpZ2h0ZWQ9e2lzSGlnaGxpZ2h0ZWR9XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxCb2R5VGV4dFxuICAgICAgICAgICAgICAgICAgICAgIHNpemU9e2lzU2VsZWN0ZWQgPyAxIDogM31cbiAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0PXsneHMnfVxuICAgICAgICAgICAgICAgICAgICAgIHNjYWxlPXsneHMnfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAge2l0ZW0ubGFiZWx9XG4gICAgICAgICAgICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgICAgICAgICAgICAgIHtpc1NlbGVjdGVkICYmIDxDaGVja0ljb24gc2l6ZT17MTR9IHNyYz17Q2hlY2ttYXJrSWNvbn0gLz59XG4gICAgICAgICAgICAgICAgICA8L0l0ZW1Db250YWluZXI+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgPC9JdGVtc0NvbnRhaW5lcj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L0ZsZXhDb2x1bW4+XG4gICAgPC9TdHlsZWREcm9wZG93bj5cbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgRHJvcGRvd247XG4iXX0=