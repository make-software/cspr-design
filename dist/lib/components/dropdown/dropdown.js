import { __assign } from "tslib";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect } from 'react';
import Downshift, { useMultipleSelection, useSelect } from 'downshift';
import styled from 'styled-components';
import isEqual from 'fast-deep-equal';
import BodyText from '../body-text/body-text';
import FlexRow from '../flex-row/flex-row';
import SvgIcon from '../svg-icon/svg-icon';
import FlexColumn from '../flex-column/flex-column';
import { InputInteractionType, useGetInputInteractionType } from "../../utils/input-interaction-type";
import UpIcon from '../../assets/icons/ic-arrow-up.svg';
import DownIcon from '../../assets/icons/ic-arrow-down.svg';
import CheckmarkIcon from '../../assets/icons/ic-checkmark.svg';
import DeleteIcon from '../../assets/icons/ic-delete.svg';
var StyledDropdown = styled.div(function (_a) {
    var theme = _a.theme, disabled = _a.disabled, isFixedDropdown = _a.isFixedDropdown;
    return (__assign({ outline: 'none', position: isFixedDropdown ? 'relative' : 'unset' }, (disabled && {
        opacity: '0.5',
        pointerEvents: 'none',
    })));
});
var Container = styled(FlexRow)(function (_a) {
    var theme = _a.theme, isOpen = _a.isOpen;
    return ({
        borderRadius: theme.borderRadius.base,
        border: 'none',
        height: 36,
        padding: '0 16px',
        background: theme.styleguideColors.fillSecondary,
        ':hover, :active': {
            background: theme.styleguideColors.fillSecondary,
            svg: {
                color: theme.styleguideColors.fillPrimaryRed,
            },
        },
    });
});
var ItemsContainer = styled.div(function (_a) {
    var theme = _a.theme, isOpen = _a.isOpen, isFixedDropdown = _a.isFixedDropdown;
    return (__assign({ display: isOpen ? 'inherit' : 'none', marginTop: 4, borderRadius: theme.borderRadius.base, background: theme.styleguideColors.fillSecondary }, (isFixedDropdown && {
        position: 'absolute',
        top: '60px',
        width: '100%',
        zIndex: 1,
    })));
});
var ItemContainer = styled(FlexRow)(function (_a) {
    var theme = _a.theme, isHighlighted = _a.isHighlighted;
    return (__assign({ cursor: 'pointer', minHeight: 36, padding: '8px 16px', ':hover, :active': {
            background: theme.styleguideColors.fillSecondaryBlueHover,
            fontWeight: 600,
        } }, (isHighlighted && {
        '&:not(:hover)': {
            border: "1px solid ".concat(theme.styleguideColors.contentBlue),
            borderRadius: theme.borderRadius.base,
        },
    })));
});
var DeleteSvgIcon = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        path: {
            stroke: theme.styleguideColors.contentSecondary,
        },
        ':hover, :active': {
            path: {
                stroke: theme.styleguideColors.fillPrimaryRed,
            },
        },
    });
});
var ClearSvgIcon = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        path: {
            stroke: theme.styleguideColors.contentPrimary,
        },
    });
});
var MultiSelectContainer = styled(FlexRow)(function (_a) {
    var theme = _a.theme;
    return ({
        borderRadius: theme.borderRadius.base,
        padding: '8px',
        background: theme.styleguideColors.fillSecondary,
        ':hover, :active': {
            svg: {
                color: theme.styleguideColors.fillPrimaryRed,
            },
        },
    });
});
var PlaceholderWrapper = styled.span(function (_a) {
    var theme = _a.theme;
    return ({
        padding: '0 8px',
    });
});
var ChipItemContainer = styled.span(function (_a) {
    var theme = _a.theme;
    return ({
        borderRadius: theme.borderRadius.base,
        cursor: 'pointer',
        padding: '2px 8px',
        background: theme.styleguideColors.fillTertriary,
        color: theme.styleguideColors.contentPrimary,
    });
});
var OverflowWrapper = styled.span(function (_a) {
    var theme = _a.theme;
    return ({
        overflow: 'hidden',
        whiteSpace: 'nowrap',
        textOverflow: 'ellipsis',
    });
});
var DropdownIconWrapper = styled(FlexRow)(function (_a) {
    var theme = _a.theme;
    return ({
        paddingRight: '8px',
        marginLeft: '8px',
    });
});
var CheckIcon = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        path: {
            fill: theme.styleguideColors.contentBlue,
        },
    });
});
var MultiSelectDeleteIcon = styled(SvgIcon)(function (_a) {
    var theme = _a.theme;
    return ({
        path: {
            stroke: theme.styleguideColors.contentBlue,
        },
        ':hover, :active': {
            path: {
                stroke: theme.styleguideColors.contentRed,
            },
        },
    });
});
var getChangeEvent = function (value) {
    return {
        target: {
            name: undefined,
            value: value,
        },
    };
};
export function Dropdown(props) {
    var id = props.id, items = props.items, placeholder = props.placeholder, label = props.label, areItemsRemovable = props.areItemsRemovable, value = props.value, style = props.style, onSelect = props.onSelect, onRemove = props.onRemove, _a = props.noItemsMessage, noItemsMessage = _a === void 0 ? 'No Options!' : _a, _b = props.isFixedDropdown, isFixedDropdown = _b === void 0 ? false : _b;
    var getChangeEvent = function (value) {
        return {
            target: {
                name: undefined,
                value: value,
            },
        };
    };
    var handleRemoveItem = function (item, ev, downshift) {
        ev.preventDefault();
        ev.stopPropagation();
        var value = item && itemValueGetter(item);
        onRemove && onRemove(getChangeEvent(value));
    };
    var itemValueGetter = function (item) { return item.value; };
    var itemNameGetter = function (item) { return item.label; };
    var handleItemSelect = function (item) {
        onSelect && onSelect(item);
    };
    var getItemToString = function (item) {
        if (item === null)
            return '';
        return typeof item === 'string' ? item : item.label;
    };
    var inputInteractionTypeRef = useGetInputInteractionType();
    return (_jsx(Downshift, __assign({ itemToString: getItemToString, onSelect: handleItemSelect, selectedItem: value, selectedItemChanged: function (prevItem, item) { return !isEqual(prevItem, item); } }, { children: function (downshift) {
            var getItemProps = downshift.getItemProps, getMenuProps = downshift.getMenuProps, isOpen = downshift.isOpen, selectedItem = downshift.selectedItem, getRootProps = downshift.getRootProps, getToggleButtonProps = downshift.getToggleButtonProps, highlightedIndex = downshift.highlightedIndex;
            var noItems = !(items && items.length);
            var handleFocus = function (ev) {
                !isOpen && downshift.openMenu();
            };
            return (_jsxs(StyledDropdown, __assign({}, getRootProps({ refKey: 'innerRef' }), { style: style, isFixedDropdown: isFixedDropdown }, { children: [label && (_jsx(BodyText, __assign({ lineHeight: 'xs', size: 1, "aria-label": label, id: id, tabIndex: 0 }, { children: label }))), _jsxs(Container, __assign({ align: "center", justify: "space-between" }, getToggleButtonProps(), { isOpen: isOpen, itemsSpacing: 10, tabIndex: 0 }, { children: [_jsx(BodyText, __assign({ size: 3, lineHeight: 'xs', variation: selectedItem ? 'inherit' : 'darkGray', style: {
                                    overflow: 'hidden',
                                    whiteSpace: 'nowrap',
                                    textOverflow: 'ellipsis',
                                } }, { children: itemNameGetter(selectedItem) || placeholder })), _jsx(SvgIcon, { src: isOpen ? UpIcon : DownIcon, rotate: isOpen, onKeyDown: function (ev) {
                                    if (ev.key === 'Enter') {
                                        handleFocus(ev);
                                    }
                                }, tabIndex: 0, alt: 'Arrow icon', role: 'img', "aria-labelledby": id, "aria-haspopup": "listbox", "aria-expanded": isOpen })] })), _jsx(ItemsContainer, __assign({}, getMenuProps(), { isOpen: isOpen, isFixedDropdown: isFixedDropdown, "aria-labelledby": id }, { children: isOpen &&
                            (noItems ? (_jsx("div", __assign({ style: { padding: '8px 16px', pointerEvents: 'none' } }, { children: _jsx(BodyText, __assign({ size: 3, scale: 'xs', lineHeight: 'xs', variation: "darkGray" }, { children: noItemsMessage })) }))) : (items.map(function (item, idx) {
                                var isSelected = isEqual(item, selectedItem);
                                var isHighlighted = inputInteractionTypeRef.current === InputInteractionType.keyboard &&
                                    highlightedIndex !== null &&
                                    highlightedIndex === idx;
                                return (_jsxs(ItemContainer, __assign({ align: "center", justify: "space-between", itemsSpacing: 10 }, getItemProps({ item: item, index: idx }), { isHighlighted: isHighlighted }, { children: [_jsx(BodyText, __assign({ size: isSelected ? 1 : 3, style: {
                                                overflow: 'hidden',
                                                whiteSpace: 'nowrap',
                                                textOverflow: 'ellipsis',
                                            }, scale: 'xs', lineHeight: 'xs' }, { children: itemNameGetter(item) })), areItemsRemovable && (_jsx(DeleteSvgIcon, { src: DeleteIcon, onClick: function (ev) {
                                                return handleRemoveItem(item, ev, downshift);
                                            } }))] }), "".concat(item, "-").concat(idx)));
                            }))) }))] })));
        } })));
}
export function MultiSelectDropdown(props) {
    var id = props.id, items = props.items, value = props.value, label = props.label, placeholder = props.placeholder, disabled = props.disabled, onSelect = props.onSelect, onChange = props.onChange, onRemove = props.onRemove, onClearAllItems = props.onClearAllItems, _a = props.isFixedDropdown, isFixedDropdown = _a === void 0 ? false : _a;
    var _b = useMultipleSelection({
        initialSelectedItems: value,
        onSelectedItemsChange: function (changes) {
            onSelect && onSelect(getChangeEvent(changes.selectedItems));
        },
    }), getSelectedItemProps = _b.getSelectedItemProps, getDropdownProps = _b.getDropdownProps, addSelectedItem = _b.addSelectedItem, removeSelectedItem = _b.removeSelectedItem, selectedItems = _b.selectedItems, setSelectedItems = _b.setSelectedItems, reset = _b.reset;
    var _c = useSelect({
        selectedItem: null,
        defaultHighlightedIndex: 0,
        items: items,
        stateReducer: function (state, actionAndChanges) {
            var changes = actionAndChanges.changes, type = actionAndChanges.type;
            switch (type) {
                case useSelect.stateChangeTypes.ToggleButtonKeyDownEnter:
                case useSelect.stateChangeTypes.ToggleButtonKeyDownSpaceButton:
                case useSelect.stateChangeTypes.ItemClick:
                    return __assign(__assign({}, changes), { isOpen: true });
                default:
                    return changes;
            }
        },
        onStateChange: function (_a) {
            var type = _a.type, newSelectedItem = _a.selectedItem;
            switch (type) {
                case useSelect.stateChangeTypes.ToggleButtonKeyDownEnter:
                case useSelect.stateChangeTypes.ToggleButtonKeyDownSpaceButton:
                case useSelect.stateChangeTypes.ItemClick:
                    {
                        var isAlreadySelected = selectedItems.some(function (i) { return i.value === (newSelectedItem === null || newSelectedItem === void 0 ? void 0 : newSelectedItem.value); });
                        if (newSelectedItem) {
                            if (isAlreadySelected) {
                                setSelectedItems(selectedItems.filter(function (i) { return i.value !== newSelectedItem.value; }));
                                onRemove && onRemove(getChangeEvent(newSelectedItem));
                            }
                            else {
                                addSelectedItem(newSelectedItem);
                                onChange && onChange(getChangeEvent(newSelectedItem));
                            }
                        }
                    }
                    break;
                default:
                    break;
            }
        },
    }), isOpen = _c.isOpen, selectedItem = _c.selectedItem, getToggleButtonProps = _c.getToggleButtonProps, getLabelProps = _c.getLabelProps, getMenuProps = _c.getMenuProps, getItemProps = _c.getItemProps, openMenu = _c.openMenu, highlightedIndex = _c.highlightedIndex;
    //Align resetting selected values if they were reset in parent
    useEffect(function () {
        if (!value || value.length < 1) {
            reset();
        }
    }, [value]);
    var handleClearAll = function () {
        onClearAllItems && onClearAllItems(getChangeEvent(null));
        reset();
    };
    var handleFocus = function (ev) {
        ev.stopPropagation();
        if (disabled) {
            return;
        }
        !isOpen && openMenu();
    };
    var inputInteractionTypeRef = useGetInputInteractionType();
    return (_jsx(StyledDropdown, __assign({ disabled: disabled, isFixedDropdown: isFixedDropdown }, { children: _jsxs(FlexColumn, __assign({ itemsSpacing: 4 }, { children: [label && (_jsx(BodyText, __assign({ lineHeight: 'xs' }, getLabelProps(), { size: 1, id: id }, { children: label }))), _jsxs("div", { children: [_jsxs(MultiSelectContainer, __assign({ align: "center", justify: "space-between" }, getToggleButtonProps(__assign(__assign({}, getDropdownProps({ preventKeyAction: isOpen })), { onClick: function (e) { return e.stopPropagation(); }, isOpen: isOpen })), { children: [_jsx("span", { children: _jsx(BodyText, __assign({ lineHeight: 'xs', size: 3, variation: selectedItem ? 'inherit' : 'darkGray' }, { children: _jsx(OverflowWrapper, { children: _jsx(FlexRow, __assign({ gap: 8, wrap: 'wrap' }, { children: selectedItems.length === 0 ? (_jsx(PlaceholderWrapper, { children: placeholder })) : (selectedItems.map(function (selectedItem, index) { return (_jsx(ChipItemContainer, __assign({}, getSelectedItemProps({ selectedItem: selectedItem, index: index }), { children: _jsxs(FlexRow, __assign({ align: 'center', gap: 4 }, { children: [(selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.chipName) && (_jsx(BodyText, __assign({ lineHeight: 'xs', size: 1, variation: 'black' }, { children: selectedItem.chipName }))), (selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.chipLabel) || (selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.label), _jsx(MultiSelectDeleteIcon, { onClick: function (event) {
                                                                    event.preventDefault();
                                                                    event.stopPropagation();
                                                                    removeSelectedItem(selectedItem);
                                                                    onRemove &&
                                                                        onRemove(getChangeEvent(selectedItem));
                                                                }, size: 14, src: "assets/icons/ic-cross.svg", alt: 'Cross icon to clear', role: 'img' })] })) }), "selected-item-".concat(index))); })) })) }) })) }), _jsxs(DropdownIconWrapper, { children: [onClearAllItems && !!selectedItems.length && (_jsx(ClearSvgIcon, { src: DeleteIcon, onClick: handleClearAll, marginRight: true, role: 'img', alt: 'Cross icon to clear items' })), _jsx(SvgIcon, { size: 16, src: isOpen ? UpIcon : DownIcon, rotate: isOpen, onKeyDown: function (ev) {
                                                if (ev.key === 'Enter') {
                                                    handleFocus(ev);
                                                }
                                            }, tabIndex: 0, alt: 'Arrow icon', "aria-labelledby": id, "aria-haspopup": "listbox", "aria-expanded": isOpen, role: 'button' })] })] })), _jsx(ItemsContainer, __assign({}, getMenuProps(), { isOpen: isOpen, isFixedDropdown: isFixedDropdown }, { children: isOpen &&
                                items.map(function (item, index) {
                                    var isSelected = selectedItems === null || selectedItems === void 0 ? void 0 : selectedItems.some(function (i) { return i.value === item.value; });
                                    var isHighlighted = inputInteractionTypeRef.current === InputInteractionType.keyboard &&
                                        highlightedIndex !== null &&
                                        highlightedIndex === index;
                                    return (_jsxs(ItemContainer, __assign({ align: "center", justify: "space-between", itemsSpacing: 10 }, getItemProps({ item: item, index: index }), { isHighlighted: isHighlighted }, { children: [_jsx(BodyText, __assign({ size: isSelected ? 1 : 3, lineHeight: 'xs', scale: 'xs' }, { children: item.label })), isSelected && _jsx(CheckIcon, { size: 14, src: CheckmarkIcon })] }), "".concat(item.value).concat(index)));
                                }) }))] })] })) })));
}
export default Dropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL2NvbXBvbmVudHMvZHJvcGRvd24vZHJvcGRvd24udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBYyxFQUFDLFNBQVMsRUFBQyxNQUFNLE9BQU8sQ0FBQztBQUN2QyxPQUFPLFNBQVMsRUFBRSxFQUE0QixvQkFBb0IsRUFBRSxTQUFTLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFDaEcsT0FBTyxNQUFNLE1BQU0sbUJBQW1CLENBQUM7QUFDdkMsT0FBTyxPQUFPLE1BQU0saUJBQWlCLENBQUM7QUFJdEMsT0FBTyxRQUFRLE1BQU0sd0JBQXdCLENBQUM7QUFDOUMsT0FBTyxPQUF1QixNQUFNLHNCQUFzQixDQUFDO0FBQzNELE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sVUFBVSxNQUFNLDRCQUE0QixDQUFDO0FBQ3BELE9BQU8sRUFBQyxvQkFBb0IsRUFBRSwwQkFBMEIsRUFBQyxNQUFNLG9DQUFvQyxDQUFDO0FBRXBHLE9BQU8sTUFBTSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hELE9BQU8sUUFBUSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVELE9BQU8sYUFBYSxNQUFNLHFDQUFxQyxDQUFDO0FBQ2hFLE9BQU8sVUFBVSxNQUFNLGtDQUFrQyxDQUFDO0FBRTFELElBQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBRzlCLFVBQUMsRUFBb0M7UUFBbEMsS0FBSyxXQUFBLEVBQUUsUUFBUSxjQUFBLEVBQUUsZUFBZSxxQkFBQTtJQUFPLE9BQUEsWUFDM0MsT0FBTyxFQUFFLE1BQU0sRUFDZixRQUFRLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFDN0MsQ0FBQyxRQUFRLElBQUk7UUFDZCxPQUFPLEVBQUUsS0FBSztRQUNkLGFBQWEsRUFBRSxNQUFNO0tBQ3RCLENBQUMsRUFD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QUFHLEtBQUssQ0FBRSxDQVloQixDQUNuQixDQUFDO2dDQUNKLENBQUMsQ0FBQyxJQUNTLElBQ2IsS0FDSyxJQUNFLENBQ3BCLENBQUM7QUFDSixDQUFDO0FBRUQsZUFBZSxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHt1c2VFZmZlY3R9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBEb3duc2hpZnQsIHtDb250cm9sbGVyU3RhdGVBbmRIZWxwZXJzLCB1c2VNdWx0aXBsZVNlbGVjdGlvbiwgdXNlU2VsZWN0fSBmcm9tICdkb3duc2hpZnQnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgaXNFcXVhbCBmcm9tICdmYXN0LWRlZXAtZXF1YWwnO1xuXG5pbXBvcnQge0Jhc2VQcm9wc30gZnJvbSAnLi4vLi4vdHlwZXMnO1xuXG5pbXBvcnQgQm9keVRleHQgZnJvbSAnLi4vYm9keS10ZXh0L2JvZHktdGV4dCc7XG5pbXBvcnQgRmxleFJvdywge0ZsZXhSb3dQcm9wc30gZnJvbSAnLi4vZmxleC1yb3cvZmxleC1yb3cnO1xuaW1wb3J0IFN2Z0ljb24gZnJvbSAnLi4vc3ZnLWljb24vc3ZnLWljb24nO1xuaW1wb3J0IEZsZXhDb2x1bW4gZnJvbSAnLi4vZmxleC1jb2x1bW4vZmxleC1jb2x1bW4nO1xuaW1wb3J0IHtJbnB1dEludGVyYWN0aW9uVHlwZSwgdXNlR2V0SW5wdXRJbnRlcmFjdGlvblR5cGV9IGZyb20gXCIuLi8uLi91dGlscy9pbnB1dC1pbnRlcmFjdGlvbi10eXBlXCI7XG5cbmltcG9ydCBVcEljb24gZnJvbSAnLi4vLi4vYXNzZXRzL2ljb25zL2ljLWFycm93LXVwLnN2Zyc7XG5pbXBvcnQgRG93bkljb24gZnJvbSAnLi4vLi4vYXNzZXRzL2ljb25zL2ljLWFycm93LWRvd24uc3ZnJztcbmltcG9ydCBDaGVja21hcmtJY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1jaGVja21hcmsuc3ZnJztcbmltcG9ydCBEZWxldGVJY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1kZWxldGUuc3ZnJztcblxuY29uc3QgU3R5bGVkRHJvcGRvd24gPSBzdHlsZWQuZGl2PHtcbiAgaXNGaXhlZERyb3Bkb3duPzogYm9vbGVhbjtcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xufT4oKHsgdGhlbWUsIGRpc2FibGVkLCBpc0ZpeGVkRHJvcGRvd24gfSkgPT4gKHtcbiAgb3V0bGluZTogJ25vbmUnLFxuICBwb3NpdGlvbjogaXNGaXhlZERyb3Bkb3duID8gJ3JlbGF0aXZlJyA6ICd1bnNldCcsXG4gIC4uLihkaXNhYmxlZCAmJiB7XG4gICAgb3BhY2l0eTogJzAuNScsXG4gICAgcG9pbnRlckV2ZW50czogJ25vbmUnLFxuICB9KSxcbn0pKTtcblxuY29uc3QgQ29udGFpbmVyID0gc3R5bGVkKEZsZXhSb3cpPHsgaXNPcGVuOiBib29sZWFuIH0+KCh7IHRoZW1lLCBpc09wZW4gfSkgPT4gKHtcbiAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgYm9yZGVyOiAnbm9uZScsXG4gIGhlaWdodDogMzYsXG4gIHBhZGRpbmc6ICcwIDE2cHgnLFxuICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICc6aG92ZXIsIDphY3RpdmUnOiB7XG4gICAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5LFxuICAgIHN2Zzoge1xuICAgICAgY29sb3I6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFByaW1hcnlSZWQsXG4gICAgfSxcbiAgfSxcbn0pKTtcblxuY29uc3QgSXRlbXNDb250YWluZXIgPSBzdHlsZWQuZGl2PHtcbiAgaXNPcGVuOiBib29sZWFuO1xuICBpc0ZpeGVkRHJvcGRvd24/OiBib29sZWFuO1xufT4oKHsgdGhlbWUsIGlzT3BlbiwgaXNGaXhlZERyb3Bkb3duIH0pID0+ICh7XG4gIGRpc3BsYXk6IGlzT3BlbiA/ICdpbmhlcml0JyA6ICdub25lJyxcbiAgbWFyZ2luVG9wOiA0LFxuICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gIC4uLihpc0ZpeGVkRHJvcGRvd24gJiYge1xuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgIHRvcDogJzYwcHgnLFxuICAgIHdpZHRoOiAnMTAwJScsXG4gICAgekluZGV4OiAxLFxuICB9KSxcbn0pKTtcblxuY29uc3QgSXRlbUNvbnRhaW5lciA9IHN0eWxlZChGbGV4Um93KTxGbGV4Um93UHJvcHMgJiB7aXNIaWdobGlnaHRlZD86IGJvb2xlYW59PigoeyB0aGVtZSwgaXNIaWdobGlnaHRlZCB9KSA9PiAoe1xuICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgbWluSGVpZ2h0OiAzNixcbiAgcGFkZGluZzogJzhweCAxNnB4JyxcbiAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnlCbHVlSG92ZXIsXG4gICAgZm9udFdlaWdodDogNjAwLFxuICB9LFxuICAuLi4oaXNIaWdobGlnaHRlZCAmJiB7XG4gICAgJyY6bm90KDpob3ZlciknOiB7XG4gICAgICBib3JkZXI6IGAxcHggc29saWQgJHt0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRCbHVlfWAsXG4gICAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICAgIH0sXG4gIH0pLFxufSkpO1xuXG5jb25zdCBEZWxldGVTdmdJY29uID0gc3R5bGVkKFN2Z0ljb24pKCh7IHRoZW1lIH0pID0+ICh7XG4gIHBhdGg6IHtcbiAgICBzdHJva2U6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudFNlY29uZGFyeSxcbiAgfSxcbiAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICBwYXRoOiB7XG4gICAgICBzdHJva2U6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFByaW1hcnlSZWQsXG4gICAgfSxcbiAgfSxcbn0pKTtcblxuY29uc3QgQ2xlYXJTdmdJY29uID0gc3R5bGVkKFN2Z0ljb24pKCh7IHRoZW1lIH0pID0+ICh7XG4gIHBhdGg6IHtcbiAgICBzdHJva2U6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudFByaW1hcnksXG4gIH0sXG59KSk7XG5cbmNvbnN0IE11bHRpU2VsZWN0Q29udGFpbmVyID0gc3R5bGVkKEZsZXhSb3cpPHsgaXNPcGVuOiBib29sZWFuIH0+KFxuICAgICh7IHRoZW1lIH0pID0+ICh7XG4gICAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICAgICAgcGFkZGluZzogJzhweCcsXG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgICAnOmhvdmVyLCA6YWN0aXZlJzoge1xuICAgICAgICBzdmc6IHtcbiAgICAgICAgICBjb2xvcjogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsUHJpbWFyeVJlZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSlcbik7XG5cbmNvbnN0IFBsYWNlaG9sZGVyV3JhcHBlciA9IHN0eWxlZC5zcGFuKCh7IHRoZW1lIH0pID0+ICh7XG4gIHBhZGRpbmc6ICcwIDhweCcsXG59KSk7XG5cbmNvbnN0IENoaXBJdGVtQ29udGFpbmVyID0gc3R5bGVkLnNwYW4oKHsgdGhlbWUgfSkgPT4gKHtcbiAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgY3Vyc29yOiAncG9pbnRlcicsXG4gIHBhZGRpbmc6ICcycHggOHB4JyxcbiAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsVGVydHJpYXJ5LFxuICBjb2xvcjogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50UHJpbWFyeSxcbn0pKTtcblxuY29uc3QgT3ZlcmZsb3dXcmFwcGVyID0gc3R5bGVkLnNwYW4oKHsgdGhlbWUgfSkgPT4gKHtcbiAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICB3aGl0ZVNwYWNlOiAnbm93cmFwJyxcbiAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLFxufSkpO1xuXG5jb25zdCBEcm9wZG93bkljb25XcmFwcGVyID0gc3R5bGVkKEZsZXhSb3cpKCh7IHRoZW1lIH0pID0+ICh7XG4gIHBhZGRpbmdSaWdodDogJzhweCcsXG4gIG1hcmdpbkxlZnQ6ICc4cHgnLFxufSkpO1xuXG5jb25zdCBDaGVja0ljb24gPSBzdHlsZWQoU3ZnSWNvbikoKHsgdGhlbWUgfSkgPT4gKHtcbiAgcGF0aDoge1xuICAgIGZpbGw6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudEJsdWUsXG4gIH0sXG59KSk7XG5cbmNvbnN0IE11bHRpU2VsZWN0RGVsZXRlSWNvbiA9IHN0eWxlZChTdmdJY29uKSgoeyB0aGVtZSB9KSA9PiAoe1xuICBwYXRoOiB7XG4gICAgc3Ryb2tlOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRCbHVlLFxuICB9LFxuICAnOmhvdmVyLCA6YWN0aXZlJzoge1xuICAgIHBhdGg6IHtcbiAgICAgIHN0cm9rZTogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5jb250ZW50UmVkLFxuICAgIH0sXG4gIH0sXG59KSk7XG5cbmV4cG9ydCB0eXBlIERyb3Bkb3duVmFsdWUgPSB7IHZhbHVlOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmcgfTtcbmV4cG9ydCB0eXBlIERyb3Bkb3duSXRlbTxUID0gRHJvcGRvd25WYWx1ZT4gPSBUO1xuXG5leHBvcnQgdHlwZSBEcm9wZG93bkV2ZW50VmFsdWUgPSB7XG4gIHRhcmdldDoge1xuICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgdmFsdWU6IERyb3Bkb3duVmFsdWUgfCBudWxsO1xuICB9O1xufTtcblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lICovXG5leHBvcnQgaW50ZXJmYWNlIERyb3Bkb3duUHJvcHMgZXh0ZW5kcyBCYXNlUHJvcHMge1xuICBpZD86IHN0cmluZztcbiAgaXRlbXM6IERyb3Bkb3duVmFsdWVbXTtcbiAgdmFsdWU/OiBEcm9wZG93blZhbHVlIHwgbnVsbDtcbiAgbGFiZWw/OiBzdHJpbmc7XG4gIHBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICBhcmVJdGVtc1JlbW92YWJsZT86IGJvb2xlYW47XG4gIGlzU2VhcmNoYWJsZT86IGJvb2xlYW47XG4gIG9uQ2hhbmdlPzogKGV2OiBEcm9wZG93bkV2ZW50VmFsdWUpID0+IHZvaWQ7XG4gIG9uU2VsZWN0PzogKGV2OiBEcm9wZG93bkV2ZW50VmFsdWUpID0+IHZvaWQ7XG4gIG9uUmVtb3ZlPzogKGV2OiBEcm9wZG93bkV2ZW50VmFsdWUpID0+IHZvaWQ7XG5cbiAgbm9JdGVtc01lc3NhZ2U/OiBzdHJpbmc7XG4gIGlzRml4ZWREcm9wZG93bj86IGJvb2xlYW47XG59XG5cbmNvbnN0IGdldENoYW5nZUV2ZW50ID0gKHZhbHVlOiBhbnkpOiBEcm9wZG93bkV2ZW50VmFsdWUgPT4ge1xuICByZXR1cm4ge1xuICAgIHRhcmdldDoge1xuICAgICAgbmFtZTogdW5kZWZpbmVkLFxuICAgICAgdmFsdWUsXG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBEcm9wZG93bihwcm9wczogRHJvcGRvd25Qcm9wcykge1xuICBjb25zdCB7XG4gICAgaWQsXG4gICAgaXRlbXMsXG4gICAgcGxhY2Vob2xkZXIsXG4gICAgbGFiZWwsXG4gICAgYXJlSXRlbXNSZW1vdmFibGUsXG4gICAgdmFsdWUsXG4gICAgc3R5bGUsXG4gICAgb25TZWxlY3QsXG4gICAgb25SZW1vdmUsXG4gICAgbm9JdGVtc01lc3NhZ2UgPSAnTm8gT3B0aW9ucyEnLFxuICAgIGlzRml4ZWREcm9wZG93biA9IGZhbHNlLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3QgZ2V0Q2hhbmdlRXZlbnQgPSAodmFsdWU6IERyb3Bkb3duVmFsdWUgfCBudWxsKTogRHJvcGRvd25FdmVudFZhbHVlID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgdGFyZ2V0OiB7XG4gICAgICAgIG5hbWU6IHVuZGVmaW5lZCxcbiAgICAgICAgdmFsdWUsXG4gICAgICB9LFxuICAgIH07XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlUmVtb3ZlSXRlbSA9IChcbiAgICBpdGVtOiBEcm9wZG93bkl0ZW0sXG4gICAgZXYsXG4gICAgZG93bnNoaWZ0OiBDb250cm9sbGVyU3RhdGVBbmRIZWxwZXJzPERyb3Bkb3duSXRlbT5cbiAgKSA9PiB7XG4gICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIGNvbnN0IHZhbHVlID0gaXRlbSAmJiBpdGVtVmFsdWVHZXR0ZXIoaXRlbSk7XG4gICAgb25SZW1vdmUgJiYgb25SZW1vdmUoZ2V0Q2hhbmdlRXZlbnQodmFsdWUpKTtcbiAgfTtcblxuICBjb25zdCBpdGVtVmFsdWVHZXR0ZXIgPSAoaXRlbSkgPT4gaXRlbS52YWx1ZTtcbiAgY29uc3QgaXRlbU5hbWVHZXR0ZXIgPSAoaXRlbSkgPT4gaXRlbS5sYWJlbDtcblxuICBjb25zdCBoYW5kbGVJdGVtU2VsZWN0ID0gKGl0ZW0pID0+IHtcbiAgICBvblNlbGVjdCAmJiBvblNlbGVjdChpdGVtKTtcbiAgfTtcblxuICBjb25zdCBnZXRJdGVtVG9TdHJpbmcgPSAoaXRlbSkgPT4ge1xuICAgIGlmIChpdGVtID09PSBudWxsKSByZXR1cm4gJyc7XG4gICAgcmV0dXJuIHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmxhYmVsO1xuICB9O1xuXG4gIGNvbnN0IGlucHV0SW50ZXJhY3Rpb25UeXBlUmVmID0gdXNlR2V0SW5wdXRJbnRlcmFjdGlvblR5cGUoKTtcblxuICByZXR1cm4gKFxuICAgICAgPERvd25zaGlmdFxuICAgICAgICAgIGl0ZW1Ub1N0cmluZz17Z2V0SXRlbVRvU3RyaW5nfVxuICAgICAgICAgIG9uU2VsZWN0PXtoYW5kbGVJdGVtU2VsZWN0fVxuICAgICAgICAgIHNlbGVjdGVkSXRlbT17dmFsdWV9XG4gICAgICAgICAgc2VsZWN0ZWRJdGVtQ2hhbmdlZD17KHByZXZJdGVtLCBpdGVtKSA9PiAhaXNFcXVhbChwcmV2SXRlbSwgaXRlbSl9XG4gICAgICA+XG4gICAgICAgIHsoZG93bnNoaWZ0KSA9PiB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZ2V0SXRlbVByb3BzLFxuICAgICAgICAgICAgZ2V0TWVudVByb3BzLFxuICAgICAgICAgICAgaXNPcGVuLFxuICAgICAgICAgICAgc2VsZWN0ZWRJdGVtLFxuICAgICAgICAgICAgZ2V0Um9vdFByb3BzLFxuICAgICAgICAgICAgZ2V0VG9nZ2xlQnV0dG9uUHJvcHMsXG4gICAgICAgICAgICBoaWdobGlnaHRlZEluZGV4LFxuICAgICAgICAgIH0gPSBkb3duc2hpZnQ7XG5cbiAgICAgICAgICBjb25zdCBub0l0ZW1zID0gIShpdGVtcyAmJiBpdGVtcy5sZW5ndGgpO1xuXG4gICAgICAgICAgY29uc3QgaGFuZGxlRm9jdXMgPSAoZXYpID0+IHtcbiAgICAgICAgICAgICFpc09wZW4gJiYgZG93bnNoaWZ0Lm9wZW5NZW51KCk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIDxTdHlsZWREcm9wZG93blxuICAgICAgICAgICAgICAgICAgey4uLmdldFJvb3RQcm9wcyh7IHJlZktleTogJ2lubmVyUmVmJyB9KX1cbiAgICAgICAgICAgICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgICAgICAgICAgICAgIGlzRml4ZWREcm9wZG93bj17aXNGaXhlZERyb3Bkb3dufVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge2xhYmVsICYmIChcbiAgICAgICAgICAgICAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0PXsneHMnfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT17MX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e2xhYmVsfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ9e2lkfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICB7bGFiZWx9XG4gICAgICAgICAgICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICA8Q29udGFpbmVyXG4gICAgICAgICAgICAgICAgICAgIGFsaWduPVwiY2VudGVyXCJcbiAgICAgICAgICAgICAgICAgICAganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIlxuICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0VG9nZ2xlQnV0dG9uUHJvcHMoKX1cbiAgICAgICAgICAgICAgICAgICAgaXNPcGVuPXtpc09wZW59XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zU3BhY2luZz17MTB9XG4gICAgICAgICAgICAgICAgICAgIHRhYkluZGV4PXswfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIDxCb2R5VGV4dFxuICAgICAgICAgICAgICAgICAgICAgIHNpemU9ezN9XG4gICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodD17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICB2YXJpYXRpb249e3NlbGVjdGVkSXRlbSA/ICdpbmhlcml0JyA6ICdkYXJrR3JheSd9XG4gICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLFxuICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHtpdGVtTmFtZUdldHRlcihzZWxlY3RlZEl0ZW0pIHx8IHBsYWNlaG9sZGVyfVxuICAgICAgICAgICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICAgICAgICAgIDxTdmdJY29uXG4gICAgICAgICAgICAgICAgICAgICAgc3JjPXtpc09wZW4gPyBVcEljb24gOiBEb3duSWNvbn1cbiAgICAgICAgICAgICAgICAgICAgICByb3RhdGU9e2lzT3Blbn1cbiAgICAgICAgICAgICAgICAgICAgICBvbktleURvd249eyhldikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2LmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVGb2N1cyhldik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgICAgICAgICAgICAgICBhbHQ9eydBcnJvdyBpY29uJ31cbiAgICAgICAgICAgICAgICAgICAgICByb2xlPXsnaW1nJ31cbiAgICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsbGVkYnk9e2lkfVxuICAgICAgICAgICAgICAgICAgICAgIGFyaWEtaGFzcG9wdXA9XCJsaXN0Ym94XCJcbiAgICAgICAgICAgICAgICAgICAgICBhcmlhLWV4cGFuZGVkPXtpc09wZW59XG4gICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvQ29udGFpbmVyPlxuICAgICAgICAgICAgICAgIDxJdGVtc0NvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0TWVudVByb3BzKCl9XG4gICAgICAgICAgICAgICAgICAgIGlzT3Blbj17aXNPcGVufVxuICAgICAgICAgICAgICAgICAgICBpc0ZpeGVkRHJvcGRvd249e2lzRml4ZWREcm9wZG93bn1cbiAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbGxlZGJ5PXtpZH1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7aXNPcGVuICYmXG4gICAgICAgICAgICAgICAgICAgICAgKG5vSXRlbXMgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3sgcGFkZGluZzogJzhweCAxNnB4JywgcG9pbnRlckV2ZW50czogJ25vbmUnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb2R5VGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplPXszfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodD17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWF0aW9uPVwiZGFya0dyYXlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtub0l0ZW1zTWVzc2FnZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5tYXAoKGl0ZW0sIGlkeCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBpc0VxdWFsKGl0ZW0sIHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNIaWdobGlnaHRlZCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0SW50ZXJhY3Rpb25UeXBlUmVmLmN1cnJlbnQgPT09IElucHV0SW50ZXJhY3Rpb25UeXBlLmtleWJvYXJkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkSW5kZXggIT09IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWRJbmRleCA9PT0gaWR4O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJdGVtQ29udGFpbmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2Ake2l0ZW19LSR7aWR4fWB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlnbj1cImNlbnRlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5PVwic3BhY2UtYmV0d2VlblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1NwYWNpbmc9ezEwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLmdldEl0ZW1Qcm9wcyh7IGl0ZW0sIGluZGV4OiBpZHggfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0hpZ2hsaWdodGVkPXtpc0hpZ2hsaWdodGVkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU9e2lzU2VsZWN0ZWQgPyAxIDogM31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZT17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodD17J3hzJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7aXRlbU5hbWVHZXR0ZXIoaXRlbSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YXJlSXRlbXNSZW1vdmFibGUgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RGVsZXRlU3ZnSWNvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXtEZWxldGVJY29ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KGV2KSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVJlbW92ZUl0ZW0oaXRlbSwgZXYsIGRvd25zaGlmdClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0l0ZW1Db250YWluZXI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICApKX1cbiAgICAgICAgICAgICAgICA8L0l0ZW1zQ29udGFpbmVyPlxuICAgICAgICAgICAgICA8L1N0eWxlZERyb3Bkb3duPlxuICAgICAgICAgICk7XG4gICAgICAgIH19XG4gICAgICA8L0Rvd25zaGlmdD5cbiAgKTtcbn1cblxuZXhwb3J0IHR5cGUgTXVsdGlEcm9wZG93blZhbHVlID0ge1xuICBsYWJlbDogc3RyaW5nO1xuICBjaGlwTGFiZWw/OiBzdHJpbmc7XG4gIGNoaXBOYW1lPzogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBNdWx0aVNlbGVjdERyb3Bkb3duUHJvcHMgZXh0ZW5kcyBCYXNlUHJvcHMge1xuICBpZD86IHN0cmluZztcbiAgdmFsdWU/OiBNdWx0aURyb3Bkb3duVmFsdWVbXTtcbiAgaXRlbXM6IE11bHRpRHJvcGRvd25WYWx1ZVtdO1xuICBsYWJlbD86IHN0cmluZyB8IEpTWC5FbGVtZW50O1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICBvbkNoYW5nZT86IChldjogRHJvcGRvd25FdmVudFZhbHVlKSA9PiB2b2lkO1xuICBvblNlbGVjdD86IChldjogRHJvcGRvd25FdmVudFZhbHVlKSA9PiB2b2lkO1xuICBvblJlbW92ZT86IChldjogRHJvcGRvd25FdmVudFZhbHVlKSA9PiB2b2lkO1xuICBvbkNsZWFyQWxsSXRlbXM/OiAoZXY6IERyb3Bkb3duRXZlbnRWYWx1ZSkgPT4gdm9pZDtcbiAgaXNGaXhlZERyb3Bkb3duPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIE11bHRpU2VsZWN0RHJvcGRvd24ocHJvcHM6IE11bHRpU2VsZWN0RHJvcGRvd25Qcm9wcykge1xuICBjb25zdCB7XG4gICAgaWQsXG4gICAgaXRlbXMsXG4gICAgdmFsdWUsXG4gICAgbGFiZWwsXG4gICAgcGxhY2Vob2xkZXIsXG4gICAgZGlzYWJsZWQsXG4gICAgb25TZWxlY3QsXG4gICAgb25DaGFuZ2UsXG4gICAgb25SZW1vdmUsXG4gICAgb25DbGVhckFsbEl0ZW1zLFxuICAgIGlzRml4ZWREcm9wZG93biA9IGZhbHNlLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3Qge1xuICAgIGdldFNlbGVjdGVkSXRlbVByb3BzLFxuICAgIGdldERyb3Bkb3duUHJvcHMsXG4gICAgYWRkU2VsZWN0ZWRJdGVtLFxuICAgIHJlbW92ZVNlbGVjdGVkSXRlbSxcbiAgICBzZWxlY3RlZEl0ZW1zLFxuICAgIHNldFNlbGVjdGVkSXRlbXMsXG4gICAgcmVzZXQsXG4gIH0gPSB1c2VNdWx0aXBsZVNlbGVjdGlvbjxNdWx0aURyb3Bkb3duVmFsdWU+KHtcbiAgICBpbml0aWFsU2VsZWN0ZWRJdGVtczogdmFsdWUsXG4gICAgb25TZWxlY3RlZEl0ZW1zQ2hhbmdlOiAoY2hhbmdlcykgPT4ge1xuICAgICAgb25TZWxlY3QgJiYgb25TZWxlY3QoZ2V0Q2hhbmdlRXZlbnQoY2hhbmdlcy5zZWxlY3RlZEl0ZW1zKSk7XG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qge1xuICAgIGlzT3BlbixcbiAgICBzZWxlY3RlZEl0ZW0sXG4gICAgZ2V0VG9nZ2xlQnV0dG9uUHJvcHMsXG4gICAgZ2V0TGFiZWxQcm9wcyxcbiAgICBnZXRNZW51UHJvcHMsXG4gICAgZ2V0SXRlbVByb3BzLFxuICAgIG9wZW5NZW51LFxuICAgIGhpZ2hsaWdodGVkSW5kZXgsXG4gIH0gPSB1c2VTZWxlY3Qoe1xuICAgIHNlbGVjdGVkSXRlbTogbnVsbCxcbiAgICBkZWZhdWx0SGlnaGxpZ2h0ZWRJbmRleDogMCwgLy8gYWZ0ZXIgc2VsZWN0aW9uLCBoaWdobGlnaHQgdGhlIGZpcnN0IGl0ZW0uXG4gICAgaXRlbXMsXG4gICAgc3RhdGVSZWR1Y2VyOiAoc3RhdGUsIGFjdGlvbkFuZENoYW5nZXMpID0+IHtcbiAgICAgIGNvbnN0IHsgY2hhbmdlcywgdHlwZSB9ID0gYWN0aW9uQW5kQ2hhbmdlcztcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIHVzZVNlbGVjdC5zdGF0ZUNoYW5nZVR5cGVzLlRvZ2dsZUJ1dHRvbktleURvd25FbnRlcjpcbiAgICAgICAgY2FzZSB1c2VTZWxlY3Quc3RhdGVDaGFuZ2VUeXBlcy5Ub2dnbGVCdXR0b25LZXlEb3duU3BhY2VCdXR0b246XG4gICAgICAgIGNhc2UgdXNlU2VsZWN0LnN0YXRlQ2hhbmdlVHlwZXMuSXRlbUNsaWNrOlxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5jaGFuZ2VzLFxuICAgICAgICAgICAgaXNPcGVuOiB0cnVlLCAvLyBrZWVwIHRoZSBtZW51IG9wZW4gYWZ0ZXIgc2VsZWN0aW9uLlxuICAgICAgICAgIH07XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGNoYW5nZXM7XG4gICAgICB9XG4gICAgfSxcbiAgICBvblN0YXRlQ2hhbmdlOiAoeyB0eXBlLCBzZWxlY3RlZEl0ZW06IG5ld1NlbGVjdGVkSXRlbSB9KSA9PiB7XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSB1c2VTZWxlY3Quc3RhdGVDaGFuZ2VUeXBlcy5Ub2dnbGVCdXR0b25LZXlEb3duRW50ZXI6XG4gICAgICAgIGNhc2UgdXNlU2VsZWN0LnN0YXRlQ2hhbmdlVHlwZXMuVG9nZ2xlQnV0dG9uS2V5RG93blNwYWNlQnV0dG9uOlxuICAgICAgICBjYXNlIHVzZVNlbGVjdC5zdGF0ZUNoYW5nZVR5cGVzLkl0ZW1DbGljazpcbiAgICAgICAge1xuICAgICAgICAgIGNvbnN0IGlzQWxyZWFkeVNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtcy5zb21lKFxuICAgICAgICAgICAgICAoaSkgPT4gaS52YWx1ZSA9PT0gbmV3U2VsZWN0ZWRJdGVtPy52YWx1ZVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAobmV3U2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICBpZiAoaXNBbHJlYWR5U2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRJdGVtcyhcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMuZmlsdGVyKChpKSA9PiBpLnZhbHVlICE9PSBuZXdTZWxlY3RlZEl0ZW0udmFsdWUpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIG9uUmVtb3ZlICYmIG9uUmVtb3ZlKGdldENoYW5nZUV2ZW50KG5ld1NlbGVjdGVkSXRlbSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYWRkU2VsZWN0ZWRJdGVtKG5ld1NlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAgIG9uQ2hhbmdlICYmIG9uQ2hhbmdlKGdldENoYW5nZUV2ZW50KG5ld1NlbGVjdGVkSXRlbSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0sXG4gIH0pO1xuXG4gIC8vQWxpZ24gcmVzZXR0aW5nIHNlbGVjdGVkIHZhbHVlcyBpZiB0aGV5IHdlcmUgcmVzZXQgaW4gcGFyZW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS5sZW5ndGggPCAxKSB7XG4gICAgICByZXNldCgpO1xuICAgIH1cbiAgfSwgW3ZhbHVlXSk7XG5cbiAgY29uc3QgaGFuZGxlQ2xlYXJBbGwgPSAoKSA9PiB7XG4gICAgb25DbGVhckFsbEl0ZW1zICYmIG9uQ2xlYXJBbGxJdGVtcyhnZXRDaGFuZ2VFdmVudChudWxsKSk7XG4gICAgcmVzZXQoKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVGb2N1cyA9IChldikgPT4ge1xuICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmIChkaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAhaXNPcGVuICYmIG9wZW5NZW51KCk7XG4gIH07XG5cbiAgY29uc3QgaW5wdXRJbnRlcmFjdGlvblR5cGVSZWYgPSB1c2VHZXRJbnB1dEludGVyYWN0aW9uVHlwZSgpO1xuXG4gIHJldHVybiAoXG4gICAgICA8U3R5bGVkRHJvcGRvd24gZGlzYWJsZWQ9e2Rpc2FibGVkfSBpc0ZpeGVkRHJvcGRvd249e2lzRml4ZWREcm9wZG93bn0+XG4gICAgICAgIDxGbGV4Q29sdW1uIGl0ZW1zU3BhY2luZz17NH0+XG4gICAgICAgICAge2xhYmVsICYmIChcbiAgICAgICAgICAgICAgPEJvZHlUZXh0IGxpbmVIZWlnaHQ9eyd4cyd9IHsuLi5nZXRMYWJlbFByb3BzKCl9IHNpemU9ezF9IGlkPXtpZH0+XG4gICAgICAgICAgICAgICAge2xhYmVsfVxuICAgICAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgICl9XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxNdWx0aVNlbGVjdENvbnRhaW5lclxuICAgICAgICAgICAgICAgIGFsaWduPVwiY2VudGVyXCJcbiAgICAgICAgICAgICAgICBqdXN0aWZ5PVwic3BhY2UtYmV0d2VlblwiXG4gICAgICAgICAgICAgICAgey4uLmdldFRvZ2dsZUJ1dHRvblByb3BzKHtcbiAgICAgICAgICAgICAgICAgIC4uLmdldERyb3Bkb3duUHJvcHMoeyBwcmV2ZW50S2V5QWN0aW9uOiBpc09wZW4gfSksXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrOiAoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSxcbiAgICAgICAgICAgICAgICAgIGlzT3BlbixcbiAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICA8Qm9keVRleHRcbiAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ9eyd4cyd9XG4gICAgICAgICAgICAgICAgICBzaXplPXszfVxuICAgICAgICAgICAgICAgICAgdmFyaWF0aW9uPXtzZWxlY3RlZEl0ZW0gPyAnaW5oZXJpdCcgOiAnZGFya0dyYXknfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPE92ZXJmbG93V3JhcHBlcj5cbiAgICAgICAgICAgICAgICAgIDxGbGV4Um93IGdhcD17OH0gd3JhcD17J3dyYXAnfT5cbiAgICAgICAgICAgICAgICAgICAge3NlbGVjdGVkSXRlbXMubGVuZ3RoID09PSAwID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgPFBsYWNlaG9sZGVyV3JhcHBlcj57cGxhY2Vob2xkZXJ9PC9QbGFjZWhvbGRlcldyYXBwZXI+XG4gICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1zLm1hcCgoc2VsZWN0ZWRJdGVtLCBpbmRleCkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDaGlwSXRlbUNvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2BzZWxlY3RlZC1pdGVtLSR7aW5kZXh9YH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLmdldFNlbGVjdGVkSXRlbVByb3BzKHsgc2VsZWN0ZWRJdGVtLCBpbmRleCB9KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RmxleFJvdyBhbGlnbj17J2NlbnRlcid9IGdhcD17NH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZEl0ZW0/LmNoaXBOYW1lICYmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb2R5VGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ9eyd4cyd9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT17MX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYXRpb249eydibGFjayd9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZEl0ZW0uY2hpcE5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JvZHlUZXh0PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2VsZWN0ZWRJdGVtPy5jaGlwTGFiZWwgfHwgc2VsZWN0ZWRJdGVtPy5sYWJlbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPE11bHRpU2VsZWN0RGVsZXRlSWNvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVTZWxlY3RlZEl0ZW0oc2VsZWN0ZWRJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZW1vdmUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZW1vdmUoZ2V0Q2hhbmdlRXZlbnQoc2VsZWN0ZWRJdGVtKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT17MTR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmM9XCJhc3NldHMvaWNvbnMvaWMtY3Jvc3Muc3ZnXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdD17J0Nyb3NzIGljb24gdG8gY2xlYXInfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9sZT17J2ltZyd9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0ZsZXhSb3c+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9DaGlwSXRlbUNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICA8L0ZsZXhSb3c+XG4gICAgICAgICAgICAgICAgPC9PdmVyZmxvd1dyYXBwZXI+XG4gICAgICAgICAgICAgIDwvQm9keVRleHQ+XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIDxEcm9wZG93bkljb25XcmFwcGVyPlxuICAgICAgICAgICAgICAgIHtvbkNsZWFyQWxsSXRlbXMgJiYgISFzZWxlY3RlZEl0ZW1zLmxlbmd0aCAmJiAoXG4gICAgICAgICAgICAgICAgICAgIDxDbGVhclN2Z0ljb25cbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYz17RGVsZXRlSWNvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsZWFyQWxsfVxuICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luUmlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGU9eydpbWcnfVxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0PXsnQ3Jvc3MgaWNvbiB0byBjbGVhciBpdGVtcyd9XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICA8U3ZnSWNvblxuICAgICAgICAgICAgICAgICAgICBzaXplPXsxNn1cbiAgICAgICAgICAgICAgICAgICAgc3JjPXtpc09wZW4gPyBVcEljb24gOiBEb3duSWNvbn1cbiAgICAgICAgICAgICAgICAgICAgcm90YXRlPXtpc09wZW59XG4gICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bj17KGV2KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGV2LmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlRm9jdXMoZXYpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgICAgICAgIGFsdD17J0Fycm93IGljb24nfVxuICAgICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsbGVkYnk9e2lkfVxuICAgICAgICAgICAgICAgICAgICBhcmlhLWhhc3BvcHVwPVwibGlzdGJveFwiXG4gICAgICAgICAgICAgICAgICAgIGFyaWEtZXhwYW5kZWQ9e2lzT3Blbn1cbiAgICAgICAgICAgICAgICAgICAgcm9sZT17J2J1dHRvbid9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9Ecm9wZG93bkljb25XcmFwcGVyPlxuICAgICAgICAgICAgPC9NdWx0aVNlbGVjdENvbnRhaW5lcj5cbiAgICAgICAgICAgIDxJdGVtc0NvbnRhaW5lclxuICAgICAgICAgICAgICAgIHsuLi5nZXRNZW51UHJvcHMoKX1cbiAgICAgICAgICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgICAgICAgICBpc0ZpeGVkRHJvcGRvd249e2lzRml4ZWREcm9wZG93bn1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2lzT3BlbiAmJlxuICAgICAgICAgICAgICAgICAgaXRlbXMubWFwKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1NlbGVjdGVkID0gc2VsZWN0ZWRJdGVtcz8uc29tZShcbiAgICAgICAgICAgICAgICAgICAgICAgIChpKSA9PiBpLnZhbHVlID09PSBpdGVtLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSGlnaGxpZ2h0ZWQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRJbnRlcmFjdGlvblR5cGVSZWYuY3VycmVudCA9PT0gSW5wdXRJbnRlcmFjdGlvblR5cGUua2V5Ym9hcmQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkSW5kZXggIT09IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodGVkSW5kZXggPT09IGluZGV4O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgPEl0ZW1Db250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlnbj1cImNlbnRlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zU3BhY2luZz17MTB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtgJHtpdGVtLnZhbHVlfSR7aW5kZXh9YH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0SXRlbVByb3BzKHsgaXRlbSwgaW5kZXggfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNIaWdobGlnaHRlZD17aXNIaWdobGlnaHRlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPEJvZHlUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplPXtpc1NlbGVjdGVkID8gMSA6IDN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0PXsneHMnfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU9eyd4cyd9XG4gICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7aXRlbS5sYWJlbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb2R5VGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge2lzU2VsZWN0ZWQgJiYgPENoZWNrSWNvbiBzaXplPXsxNH0gc3JjPXtDaGVja21hcmtJY29ufSAvPn1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvSXRlbUNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9JdGVtc0NvbnRhaW5lcj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9GbGV4Q29sdW1uPlxuICAgICAgPC9TdHlsZWREcm9wZG93bj5cbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgRHJvcGRvd247XG4iXX0=