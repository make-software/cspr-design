import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useRef, useState } from 'react';
import styled from 'styled-components';
import FlexRow from '../flex-row/flex-row';
import SvgIcon from '../svg-icon/svg-icon';
import UpIcon from '../../assets/icons/ic-arrow-up.svg';
import DownIcon from '../../assets/icons/ic-arrow-down.svg';
import { useClickAway } from '../../hooks/use-click-away';
const StyledDropdown = styled.div(({ theme, disabled }) => ({
    outline: 'none',
    position: 'relative',
    borderRadius: theme.borderRadius.base,
    ...(disabled && {
        opacity: '0.5',
        pointerEvents: 'none',
    }),
    background: theme.styleguideColors.fillSecondary,
    ':hover, :active': {
        background: theme.styleguideColors.fillSecondary,
        svg: {
            path: {
                fill: theme.styleguideColors.fillPrimaryRed,
            },
        },
    },
}));
const StyledContentRow = styled(FlexRow)(({ theme, error }) => theme.withMedia({
    width: '100%',
    border: error ? `1px solid ${theme.styleguideColors.contentRed}` : 'none',
}));
const StyledInput = styled.input(({ theme, fontSize, icon }) => ({
    lineHeight: '1.5',
    fontSize: fontSize,
    height: '36px',
    borderRadius: theme.borderRadius.base,
    outline: 'none',
    padding: icon ? '0 12px' : '0 16px',
    transition: 'all 200ms ease',
    width: '100%',
    color: theme.styleguideColors.contentPrimary,
    border: 'none',
    background: theme.styleguideColors.fillSecondary,
    ':hover': {
        cursor: 'pointer',
    },
}));
const ItemContainer = styled.div(({ theme, isOpen, height, fontSize, maxHeight }) => ({
    display: isOpen ? 'block' : 'none',
    borderRadius: theme.borderRadius.base,
    fontSize: fontSize,
    paddingLeft: '6px',
    background: theme.styleguideColors.fillSecondary,
    boxShadow: '0 1px 0 rgba(0, 0, 0, 0.06)',
    marginTop: '4px',
    height: height,
    maxHeight: maxHeight,
    overflowY: 'auto',
    position: 'absolute',
    top: '100%',
    width: '100%',
    zIndex: '1000',
}));
const Item = styled.div(({ theme, selected }) => ({
    display: 'block',
    cursor: 'pointer',
    padding: '8px 10px',
    color: theme.styleguideColors.contentPrimary,
    ':hover, :active': {
        background: theme.styleguideColors.fillSecondaryBlueHover,
    },
    fontWeight: selected ? 600 : 400,
}));
const ArrowSvg = styled(SvgIcon)(({ theme }) => ({
    marginRight: '16px',
    path: {
        fill: theme.styleguideColors.contentPrimary,
    },
}));
const CustomIcon = styled.div(({ inLoop }) => ({
    margin: inLoop ? '0 12px 0 0' : '0 0 0 16px',
    display: 'inline',
    position: 'relative',
    bottom: inLoop ? '0' : '1px',
}));
export const SearchableDropdown = ({ items, value, height, isError, fontSize, maxHeight, onSelect, placeholder, }) => {
    const [searchedValue, setSearchedValue] = useState('');
    const [isOpen, setIsOpen] = useState(false);
    const [rotate, setRotate] = useState(false);
    const [icon, setIcon] = useState(null);
    const inputRef = useRef(null);
    const { ref } = useClickAway({
        callback: () => {
            setIsOpen(false);
        },
    });
    useEffect(() => {
        value.icon && setIcon(value.icon);
    }, [value]);
    useEffect(() => {
        if (isOpen === rotate)
            return;
        setRotate(isOpen);
    }, [isOpen]);
    const selectOption = (option) => {
        setSearchedValue('');
        onSelect(option);
        setIsOpen((isOpen) => !isOpen);
        setIsOpen(!isOpen);
        setIcon(option.icon);
    };
    const handleOpenDropdown = (e) => {
        setIsOpen(true);
    };
    const getDisplayValue = () => {
        if (searchedValue)
            return searchedValue;
        if (value)
            return value.label;
        return '';
    };
    const filterOptionsWithSearchedValue = (options, searchedValue) => {
        return options.filter((option) => option.label.toLowerCase().indexOf(searchedValue.toLowerCase()) > -1);
    };
    const searchedItems = filterOptionsWithSearchedValue(items, searchedValue);
    return (_jsxs(StyledDropdown, { ref: ref, children: [_jsx(FlexRow, { align: "center", justify: "space-between", onClick: handleOpenDropdown, children: _jsxs(StyledContentRow, { justify: 'space-around', align: 'center', error: isError, children: [icon && _jsx(CustomIcon, { children: icon }), _jsx(StyledInput, { ref: inputRef, placeholder: placeholder, value: getDisplayValue(), onChange: (e) => {
                                setSearchedValue(e.target.value);
                                onSelect({});
                            }, fontSize: fontSize, icon: Boolean(icon) }), _jsx(ArrowSvg, { src: rotate ? UpIcon : DownIcon })] }) }), _jsx(ItemContainer, { isOpen: isOpen, height: height, fontSize: fontSize, maxHeight: maxHeight, children: searchedItems.map((item, index) => {
                    return (_jsxs(Item, { onClick: () => selectOption(item), selected: item.value === value.value, children: [item.icon && _jsx(CustomIcon, { inLoop: true, children: item.icon }), item.label] }, index));
                }) })] }));
};
export default SearchableDropdown;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoYWJsZS1kcm9wZG93bi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvY29tcG9uZW50cy9kcm9wZG93bi13aXRoLXNlYXJjaC9zZWFyY2hhYmxlLWRyb3Bkb3duLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQzNELE9BQU8sTUFBTSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sT0FBTyxNQUFNLHNCQUFzQixDQUFDO0FBQzNDLE9BQU8sTUFBTSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3hELE9BQU8sUUFBUSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUUxRCxNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUMvQixDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3hCLE9BQU8sRUFBRSxNQUFNO0lBQ2YsUUFBUSxFQUFFLFVBQVU7SUFDcEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSTtJQUVyQyxHQUFHLENBQUMsUUFBUSxJQUFJO1FBQ2QsT0FBTyxFQUFFLEtBQUs7UUFDZCxhQUFhLEVBQUUsTUFBTTtLQUN0QixDQUFDO0lBRUYsVUFBVSxFQUFFLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhO0lBQ2hELGlCQUFpQixFQUFFO1FBQ2pCLFVBQVUsRUFBRSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsYUFBYTtRQUNoRCxHQUFHLEVBQUU7WUFDSCxJQUFJLEVBQUU7Z0JBQ0osSUFBSSxFQUFFLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjO2FBQzVDO1NBQ0Y7S0FDRjtDQUNGLENBQUMsQ0FD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QUFJLENBQUMsRUFDakMsUUFBUSxFQUFFLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLEtBQUssYUFHbkMsSUFBSSxDQUFDLElBQUksSUFBSSxLQUFDLFVBQVUsSUFBQyxNQUFNLGtCQUFFLElBQUksQ0FBQyxJQUFJLEdBQWMsRUFDeEQsSUFBSSxDQUFDLEtBQUssS0FITixLQUFLLENBSUwsQ0FDUixDQUFDO2dCQUNKLENBQUMsQ0FBQyxHQUNZLElBQ0QsQ0FDbEIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGVBQWUsa0JBQWtCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgRmxleFJvdyBmcm9tICcuLi9mbGV4LXJvdy9mbGV4LXJvdyc7XG5pbXBvcnQgU3ZnSWNvbiBmcm9tICcuLi9zdmctaWNvbi9zdmctaWNvbic7XG5pbXBvcnQgVXBJY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1hcnJvdy11cC5zdmcnO1xuaW1wb3J0IERvd25JY29uIGZyb20gJy4uLy4uL2Fzc2V0cy9pY29ucy9pYy1hcnJvdy1kb3duLnN2Zyc7XG5pbXBvcnQgeyB1c2VDbGlja0F3YXkgfSBmcm9tICcuLi8uLi9ob29rcy91c2UtY2xpY2stYXdheSc7XG5cbmNvbnN0IFN0eWxlZERyb3Bkb3duID0gc3R5bGVkLmRpdjx7IGRpc2FibGVkPzogYm9vbGVhbiB9PihcbiAgKHsgdGhlbWUsIGRpc2FibGVkIH0pID0+ICh7XG4gICAgb3V0bGluZTogJ25vbmUnLFxuICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIGJvcmRlclJhZGl1czogdGhlbWUuYm9yZGVyUmFkaXVzLmJhc2UsXG5cbiAgICAuLi4oZGlzYWJsZWQgJiYge1xuICAgICAgb3BhY2l0eTogJzAuNScsXG4gICAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScsXG4gICAgfSksXG5cbiAgICBiYWNrZ3JvdW5kOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmZpbGxTZWNvbmRhcnksXG4gICAgJzpob3ZlciwgOmFjdGl2ZSc6IHtcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgICAgIHN2Zzoge1xuICAgICAgICBwYXRoOiB7XG4gICAgICAgICAgZmlsbDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsUHJpbWFyeVJlZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbik7XG5cbmNvbnN0IFN0eWxlZENvbnRlbnRSb3cgPSBzdHlsZWQoRmxleFJvdyk8eyBlcnJvcj86IGJvb2xlYW4gfT4oXG4gICh7IHRoZW1lLCBlcnJvciB9KSA9PlxuICAgIHRoZW1lLndpdGhNZWRpYSh7XG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgYm9yZGVyOiBlcnJvciA/IGAxcHggc29saWQgJHt0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRSZWR9YCA6ICdub25lJyxcbiAgICB9KVxuKTtcblxuY29uc3QgU3R5bGVkSW5wdXQgPSBzdHlsZWQuaW5wdXQ8eyBmb250U2l6ZT86IHN0cmluZzsgaWNvbj86IGJvb2xlYW4gfT4oXG4gICh7IHRoZW1lLCBmb250U2l6ZSwgaWNvbiB9KSA9PiAoe1xuICAgIGxpbmVIZWlnaHQ6ICcxLjUnLFxuICAgIGZvbnRTaXplOiBmb250U2l6ZSxcbiAgICBoZWlnaHQ6ICczNnB4JyxcbiAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmJvcmRlclJhZGl1cy5iYXNlLFxuICAgIG91dGxpbmU6ICdub25lJyxcbiAgICBwYWRkaW5nOiBpY29uID8gJzAgMTJweCcgOiAnMCAxNnB4JyxcbiAgICB0cmFuc2l0aW9uOiAnYWxsIDIwMG1zIGVhc2UnLFxuICAgIHdpZHRoOiAnMTAwJScsXG4gICAgY29sb3I6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuY29udGVudFByaW1hcnksXG4gICAgYm9yZGVyOiAnbm9uZScsXG4gICAgYmFja2dyb3VuZDogdGhlbWUuc3R5bGVndWlkZUNvbG9ycy5maWxsU2Vjb25kYXJ5LFxuICAgICc6aG92ZXInOiB7XG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICB9LFxuICB9KVxuKTtcblxuY29uc3QgSXRlbUNvbnRhaW5lciA9IHN0eWxlZC5kaXY8e1xuICBpc09wZW4/OiBib29sZWFuO1xuICBoZWlnaHQ/OiBzdHJpbmc7XG4gIG1heEhlaWdodD86IHN0cmluZztcbiAgZm9udFNpemU/OiBzdHJpbmc7XG59PigoeyB0aGVtZSwgaXNPcGVuLCBoZWlnaHQsIGZvbnRTaXplLCBtYXhIZWlnaHQgfSkgPT4gKHtcbiAgZGlzcGxheTogaXNPcGVuID8gJ2Jsb2NrJyA6ICdub25lJyxcbiAgYm9yZGVyUmFkaXVzOiB0aGVtZS5ib3JkZXJSYWRpdXMuYmFzZSxcbiAgZm9udFNpemU6IGZvbnRTaXplLFxuICBwYWRkaW5nTGVmdDogJzZweCcsXG4gIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeSxcbiAgYm94U2hhZG93OiAnMCAxcHggMCByZ2JhKDAsIDAsIDAsIDAuMDYpJyxcbiAgbWFyZ2luVG9wOiAnNHB4JyxcbiAgaGVpZ2h0OiBoZWlnaHQsXG4gIG1heEhlaWdodDogbWF4SGVpZ2h0LFxuICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gIHRvcDogJzEwMCUnLFxuICB3aWR0aDogJzEwMCUnLFxuICB6SW5kZXg6ICcxMDAwJyxcbn0pKTtcblxuY29uc3QgSXRlbSA9IHN0eWxlZC5kaXY8eyBzZWxlY3RlZDogYm9vbGVhbiB9PigoeyB0aGVtZSwgc2VsZWN0ZWQgfSkgPT4gKHtcbiAgZGlzcGxheTogJ2Jsb2NrJyxcbiAgY3Vyc29yOiAncG9pbnRlcicsXG4gIHBhZGRpbmc6ICc4cHggMTBweCcsXG4gIGNvbG9yOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxuICAnOmhvdmVyLCA6YWN0aXZlJzoge1xuICAgIGJhY2tncm91bmQ6IHRoZW1lLnN0eWxlZ3VpZGVDb2xvcnMuZmlsbFNlY29uZGFyeUJsdWVIb3ZlcixcbiAgfSxcbiAgZm9udFdlaWdodDogc2VsZWN0ZWQgPyA2MDAgOiA0MDAsXG59KSk7XG5cbmNvbnN0IEFycm93U3ZnID0gc3R5bGVkKFN2Z0ljb24pKCh7IHRoZW1lIH0pID0+ICh7XG4gIG1hcmdpblJpZ2h0OiAnMTZweCcsXG4gIHBhdGg6IHtcbiAgICBmaWxsOiB0aGVtZS5zdHlsZWd1aWRlQ29sb3JzLmNvbnRlbnRQcmltYXJ5LFxuICB9LFxufSkpO1xuXG5jb25zdCBDdXN0b21JY29uID0gc3R5bGVkLmRpdjx7IGluTG9vcD86IGJvb2xlYW4gfT4oKHsgaW5Mb29wIH0pID0+ICh7XG4gIG1hcmdpbjogaW5Mb29wID8gJzAgMTJweCAwIDAnIDogJzAgMCAwIDE2cHgnLFxuICBkaXNwbGF5OiAnaW5saW5lJyxcbiAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gIGJvdHRvbTogaW5Mb29wID8gJzAnIDogJzFweCcsXG59KSk7XG5cbmludGVyZmFjZSBJdGVtIHtcbiAgdmFsdWU6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgaWNvbj86IFJlYWN0LlJlYWN0RWxlbWVudCB8IG51bGw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoYWJsZURyb3Bkb3duUHJvcHMge1xuICBpdGVtczogSXRlbVtdO1xuICB2YWx1ZTogSXRlbTtcbiAgb25TZWxlY3Q6IChkYXRhOiBhbnkpID0+IHZvaWQ7XG4gIGhlaWdodD86IHN0cmluZztcbiAgbWF4SGVpZ2h0Pzogc3RyaW5nO1xuICBmb250U2l6ZT86IHN0cmluZztcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIGlzRXJyb3I/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgU2VhcmNoYWJsZURyb3Bkb3duID0gKHtcbiAgaXRlbXMsXG4gIHZhbHVlLFxuICBoZWlnaHQsXG4gIGlzRXJyb3IsXG4gIGZvbnRTaXplLFxuICBtYXhIZWlnaHQsXG4gIG9uU2VsZWN0LFxuICBwbGFjZWhvbGRlcixcbn06IFNlYXJjaGFibGVEcm9wZG93blByb3BzKSA9PiB7XG4gIGNvbnN0IFtzZWFyY2hlZFZhbHVlLCBzZXRTZWFyY2hlZFZhbHVlXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2lzT3Blbiwgc2V0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW3JvdGF0ZSwgc2V0Um90YXRlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2ljb24sIHNldEljb25dID0gdXNlU3RhdGU8UmVhY3QuUmVhY3RFbGVtZW50IHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3QgaW5wdXRSZWYgPSB1c2VSZWYobnVsbCk7XG5cbiAgY29uc3QgeyByZWYgfSA9IHVzZUNsaWNrQXdheSh7XG4gICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgIHNldElzT3BlbihmYWxzZSk7XG4gICAgfSxcbiAgfSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICB2YWx1ZS5pY29uICYmIHNldEljb24odmFsdWUuaWNvbik7XG4gIH0sIFt2YWx1ZV0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzT3BlbiA9PT0gcm90YXRlKSByZXR1cm47XG5cbiAgICBzZXRSb3RhdGUoaXNPcGVuKTtcbiAgfSwgW2lzT3Blbl0pO1xuXG4gIGNvbnN0IHNlbGVjdE9wdGlvbiA9IChvcHRpb24pID0+IHtcbiAgICBzZXRTZWFyY2hlZFZhbHVlKCcnKTtcbiAgICBvblNlbGVjdChvcHRpb24pO1xuXG4gICAgc2V0SXNPcGVuKChpc09wZW4pID0+ICFpc09wZW4pO1xuICAgIHNldElzT3BlbighaXNPcGVuKTtcbiAgICBzZXRJY29uKG9wdGlvbi5pY29uKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVPcGVuRHJvcGRvd24gPSAoZSkgPT4ge1xuICAgIHNldElzT3Blbih0cnVlKTtcbiAgfTtcblxuICBjb25zdCBnZXREaXNwbGF5VmFsdWUgPSAoKSA9PiB7XG4gICAgaWYgKHNlYXJjaGVkVmFsdWUpIHJldHVybiBzZWFyY2hlZFZhbHVlO1xuICAgIGlmICh2YWx1ZSkgcmV0dXJuIHZhbHVlLmxhYmVsO1xuXG4gICAgcmV0dXJuICcnO1xuICB9O1xuXG4gIGNvbnN0IGZpbHRlck9wdGlvbnNXaXRoU2VhcmNoZWRWYWx1ZSA9IChvcHRpb25zLCBzZWFyY2hlZFZhbHVlKSA9PiB7XG4gICAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKFxuICAgICAgKG9wdGlvbikgPT5cbiAgICAgICAgb3B0aW9uLmxhYmVsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hlZFZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTFcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IHNlYXJjaGVkSXRlbXMgPSBmaWx0ZXJPcHRpb25zV2l0aFNlYXJjaGVkVmFsdWUoaXRlbXMsIHNlYXJjaGVkVmFsdWUpO1xuXG4gIHJldHVybiAoXG4gICAgPFN0eWxlZERyb3Bkb3duIHJlZj17cmVmfT5cbiAgICAgIDxGbGV4Um93XG4gICAgICAgIGFsaWduPVwiY2VudGVyXCJcbiAgICAgICAganVzdGlmeT1cInNwYWNlLWJldHdlZW5cIlxuICAgICAgICBvbkNsaWNrPXtoYW5kbGVPcGVuRHJvcGRvd259XG4gICAgICA+XG4gICAgICAgIDxTdHlsZWRDb250ZW50Um93XG4gICAgICAgICAganVzdGlmeT17J3NwYWNlLWFyb3VuZCd9XG4gICAgICAgICAgYWxpZ249eydjZW50ZXInfVxuICAgICAgICAgIGVycm9yPXtpc0Vycm9yfVxuICAgICAgICA+XG4gICAgICAgICAge2ljb24gJiYgPEN1c3RvbUljb24+e2ljb259PC9DdXN0b21JY29uPn1cbiAgICAgICAgICA8U3R5bGVkSW5wdXRcbiAgICAgICAgICAgIHJlZj17aW5wdXRSZWZ9XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9XG4gICAgICAgICAgICB2YWx1ZT17Z2V0RGlzcGxheVZhbHVlKCl9XG4gICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHtcbiAgICAgICAgICAgICAgc2V0U2VhcmNoZWRWYWx1ZShlLnRhcmdldC52YWx1ZSk7XG4gICAgICAgICAgICAgIG9uU2VsZWN0KHt9KTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBmb250U2l6ZT17Zm9udFNpemV9XG4gICAgICAgICAgICBpY29uPXtCb29sZWFuKGljb24pfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPEFycm93U3ZnIHNyYz17cm90YXRlID8gVXBJY29uIDogRG93bkljb259IC8+XG4gICAgICAgIDwvU3R5bGVkQ29udGVudFJvdz5cbiAgICAgIDwvRmxleFJvdz5cblxuICAgICAgPEl0ZW1Db250YWluZXJcbiAgICAgICAgaXNPcGVuPXtpc09wZW59XG4gICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICBmb250U2l6ZT17Zm9udFNpemV9XG4gICAgICAgIG1heEhlaWdodD17bWF4SGVpZ2h0fVxuICAgICAgPlxuICAgICAgICB7c2VhcmNoZWRJdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxJdGVtXG4gICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNlbGVjdE9wdGlvbihpdGVtKX1cbiAgICAgICAgICAgICAgc2VsZWN0ZWQ9e2l0ZW0udmFsdWUgPT09IHZhbHVlLnZhbHVlfVxuICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7aXRlbS5pY29uICYmIDxDdXN0b21JY29uIGluTG9vcD57aXRlbS5pY29ufTwvQ3VzdG9tSWNvbj59XG4gICAgICAgICAgICAgIHtpdGVtLmxhYmVsfVxuICAgICAgICAgICAgPC9JdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC9JdGVtQ29udGFpbmVyPlxuICAgIDwvU3R5bGVkRHJvcGRvd24+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTZWFyY2hhYmxlRHJvcGRvd247XG4iXX0=