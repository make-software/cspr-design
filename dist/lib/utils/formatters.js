import { createIntl, createIntlCache } from '@formatjs/intl';
import { formatDistanceToNowStrict, formatISO } from 'date-fns';
import i18next from 'i18next';
import { az, enUS, es, fr, nl, pl, ru, tr, uk, vi } from 'date-fns/locale';
import { isBrowserSupportRelativeDateFormat } from './detect-browser';
export const MINIMUM_SHOWING_BALANCE = 0.00001;
export const DEFAULT_AMOUNT_PRECISION = 4;
export const SMALL_PRECISION = 2;
export const DEFAULT_PRECISION = 5;
export const FULL_PRECISION = 9;
const Locale = {
    en: enUS,
    es: es,
    uk: uk,
    tr: tr,
    nl: nl,
    ru: ru,
    pl: pl,
    vi: vi,
    fr: fr,
    az: az,
};
const cache = createIntlCache();
const intl = createIntl({
    locale: 'en-US',
    messages: {
        'components.transaction_status': 'Success',
    },
}, cache);
export const formatNumber = (value, { precision, notation, compactDisplay, } = {}) => {
    return intl.formatNumber(value, {
        minimumFractionDigits: precision || 0,
        maximumFractionDigits: precision || 0,
        notation,
        compactDisplay,
    });
};
const BIG_NUMBERS_NOTATION_SYMBOL = [
    '',
    'k', //Thousand
    'M', //Million
    'B', //Billion
    'T', //Trillion
    'e15', //Quadrillion
    'e18', //Quintillion
    'e21', //Sextillion
    'e24', //Septillion
    'e27', //Octillion
    'e30', //Nonillion
    'e33', //Decillion
    'e36', //Undecillion
    'e39', //Duodecillion
    'e42', //Tredecillion
    'e45', //Quattuordecillion
    'e48', //Quindecillion
    'e51', //Sexdecillion
    'e54', //Septendecillion
    'e57', //Octodecillion
    'e60', //Novemdecillion
    'e63', //Vigintillion
    'e66', //Unvigintillion
    'e69', //Duovigintillion
    'e72', //Trevigintillion
    'e75', //Quattuorvigintillion
    'e78', //Quinvigintillion
    'e81', //Sexvigintillion
    'e84', //Septenvigintillion
    'e87', //Octovigintillion
    'e90', //Novemvigintillion
    'e93', //Trigintillion
    'e96', //Untrigintillion
    'e99', //Duotrigintillion
    'e101', //Googol
    'e104', //Tretrigintillion
];
export const formatBigNumbers = (value) => {
    // determines symbol
    const tier = (Math.log10(Math.abs(value)) / 3) | 0;
    const tiersWithoutSuffixes = [0, 1, 2];
    if (tiersWithoutSuffixes.includes(tier)) {
        return formatNumber(value, {
            precision: DEFAULT_PRECISION,
        });
    }
    // get suffix and determine scale
    const suffix = BIG_NUMBERS_NOTATION_SYMBOL[tier];
    const scale = Math.pow(10, tier * 3);
    const scaledNumber = value / scale;
    return scaledNumber.toFixed(5) + suffix;
};
export const formatCurrency = (value, code, { precision, } = {}) => {
    return intl.formatNumber(value, {
        style: 'currency',
        currency: code,
        minimumFractionDigits: precision,
        maximumFractionDigits: precision,
    });
};
export const formatPercentage = (value, { precision } = {}) => {
    return value.toFixed(precision || 2);
};
export const formatTimestamp = (value) => {
    const date = new Date(value);
    const locale = i18next.language || 'en';
    const nativeIntl = new Intl.DateTimeFormat(locale, {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric',
        timeZoneName: 'short',
    });
    return `${nativeIntl.format(date)}`;
};
const formatDistanceTokens = {
    lessThanXSeconds: 'second',
    xSeconds: 'second',
    lessThanXMinutes: 'minute',
    xMinutes: 'minute',
    xHours: 'hour',
    xDays: 'day',
    xMonths: 'month',
    xYears: 'year',
};
const formatDistance = (token, count, options) => {
    options = options || {};
    const locale = options.locale.code || 'en';
    return new Intl.RelativeTimeFormat(locale, {
        style: 'short',
    })
        .format(-count, formatDistanceTokens[token])
        .replace('.', '');
};
export const formatTimestampAge = (value) => {
    const date = new Date(value);
    const isSupportedLanguageAndBrowser = i18next.language !== 'az' && isBrowserSupportRelativeDateFormat;
    return `${formatDistanceToNowStrict(date, {
        addSuffix: true,
        locale: {
            ...Locale[i18next.language],
            ...(isSupportedLanguageAndBrowser && {
                formatDistance,
            }),
        },
        roundingMethod: 'floor',
    })}`;
};
export const formatDate = (value) => {
    const date = new Date(value);
    return `${intl.formatDate(date, {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
    })}, ${intl.formatTime(date, {
        hour: 'numeric',
        minute: 'numeric',
    })}`;
};
export const formatDateWithWeekday = (value) => {
    const date = new Date(value);
    return `${intl.formatDate(date, {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        weekday: 'long',
    })}`;
};
export const formatDateShort = (value) => {
    const date = new Date(value);
    return `${intl.formatDate(date, {
        month: 'short',
        day: 'numeric',
    })}`;
};
export const formatDateWithMonthAndYear = (value) => {
    const date = new Date(value);
    return `${intl.formatDate(date, {
        month: 'short',
        year: 'numeric',
    })}`;
};
export var HashFontSize;
(function (HashFontSize) {
    HashFontSize["default"] = "default";
    HashFontSize["big"] = "big";
})(HashFontSize || (HashFontSize = {}));
export var HashLength;
(function (HashLength) {
    HashLength[HashLength["FULL"] = 0] = "FULL";
    HashLength[HashLength["TINY"] = 5] = "TINY";
    HashLength[HashLength["LITTLE"] = 10] = "LITTLE";
    HashLength[HashLength["SMALL"] = 15] = "SMALL";
    HashLength[HashLength["MEDIUM"] = 20] = "MEDIUM";
    HashLength[HashLength["LARGE"] = 25] = "LARGE";
})(HashLength || (HashLength = {}));
export const shortenString = (valueToShort, visibleHashLength = HashLength.TINY) => {
    const hashLength = valueToShort.length;
    if (hashLength <= visibleHashLength) {
        return valueToShort;
    }
    const firstPart = valueToShort.substring(0, visibleHashLength);
    const secondPart = valueToShort.substring(hashLength - visibleHashLength);
    return `${firstPart}...${secondPart}`;
};
export const formatHash = (hash, visibleHashLength = HashLength.TINY) => {
    const MIN_TRUNCATE_HASH_LENGTH = HashLength.TINY * 2 + 3;
    const [hashWithoutSuffix, lastDigits] = hash.split('-');
    const hashLength = hashWithoutSuffix.length;
    if (visibleHashLength === HashLength.FULL ||
        hashLength <= MIN_TRUNCATE_HASH_LENGTH) {
        return hash;
    }
    const truncatedHash = shortenString(hashWithoutSuffix, visibleHashLength);
    return lastDigits ? `${truncatedHash}-${lastDigits}` : `${truncatedHash}`;
};
export const formatISODateOnly = (date) => {
    return formatISO(date, {
        representation: 'date',
    });
};
export const formatDeploysCount = (value) => `${formatNumber(value, {
    notation: 'compact',
    compactDisplay: 'short',
})}`;
export const formatRatesToCurrency = (value) => formatNumber(value, { precision: 4 });
export const truncateCSPRName = (name, limit) => name && name.length > limit ? name.substring(0, limit - 1) + '...' : name;
export const shortenCsprName = (csprName, visibleStringLength = HashLength.SMALL) => {
    const [name, extension] = csprName.split(/(.cspr)$/);
    const MIN_TRUNCATE_LENGTH = HashLength.TINY * 2 + 3;
    const hashLength = name.length;
    if (hashLength === HashLength.FULL || hashLength <= MIN_TRUNCATE_LENGTH) {
        return csprName;
    }
    const firstPart = name.substring(0, visibleStringLength);
    const secondPart = name.substring(hashLength - visibleStringLength);
    return `${firstPart}...${secondPart}${extension}`;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWF0dGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvdXRpbHMvZm9ybWF0dGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDaEUsT0FBTyxPQUFPLE1BQU0sU0FBUyxDQUFDO0FBRTlCLE9BQU8sRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzRSxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUV0RSxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxPQUFPLENBQUM7QUFDL0MsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQUcsQ0FBQyxDQUFDO0FBQzFDLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFDLENBQUM7QUFDakMsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxDQUFDO0FBQ25DLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUM7QUFFaEMsTUFBTSxNQUFNLEdBQUc7SUFDYixFQUFFLEVBQUUsSUFBSTtJQUNSLEVBQUUsRUFBRSxFQUFFO0lBQ04sRUFBRSxFQUFFLEVBQUU7SUFDTixFQUFFLEVBQUUsRUFBRTtJQUNOLEVBQUUsRUFBRSxFQUFFO0lBQ04sRUFBRSxFQUFFLEVBQUU7SUFDTixFQUFFLEVBQUUsRUFBRTtJQUNOLEVBQUUsRUFBRSxFQUFFO0lBQ04sRUFBRSxFQUFFLEVBQUU7SUFDTixFQUFFLEVBQUUsRUFBRTtDQUNQLENBQUM7QUFFRixNQUFNLEtBQUssR0FBRyxlQUFlLEVBQUUsQ0FBQztBQUNoQyxNQUFNLElBQUksR0FBRyxVQUFVLENBQ3JCO0lBQ0UsTUFBTSxFQUFFLE9BQU87SUFDZixRQUFRLEVBQUU7UUFDUiwrQkFBK0IsRUFBRSxTQUFTO0tBQzNDO0NBQ0YsRUFDRCxLQUFLLENBQ04sQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUMxQixLQUFzQixFQUN0QixFQUNFLFNBQVMsRUFDVCxRQUFRLEVBQ1IsY0FBYyxNQUtaLEVBQUUsRUFDRSxFQUFFO0lBQ1YsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQWUsRUFBRTtRQUN4QyxxQkFBcUIsRUFBRSxTQUFTLElBQUksQ0FBQztRQUNyQyxxQkFBcUIsRUFBRSxTQUFTLElBQUksQ0FBQztRQUNyQyxRQUFRO1FBQ1IsY0FBYztLQUNmLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQUVGLE1BQU0sMkJBQTJCLEdBQUc7SUFDbEMsRUFBRTtJQUNGLEdBQUcsRUFBRSxVQUFVO0lBQ2YsR0FBRyxFQUFFLFNBQVM7SUFDZCxHQUFHLEVBQUUsU0FBUztJQUNkLEdBQUcsRUFBRSxVQUFVO0lBQ2YsS0FBSyxFQUFFLGFBQWE7SUFDcEIsS0FBSyxFQUFFLGFBQWE7SUFDcEIsS0FBSyxFQUFFLFlBQVk7SUFDbkIsS0FBSyxFQUFFLFlBQVk7SUFDbkIsS0FBSyxFQUFFLFdBQVc7SUFDbEIsS0FBSyxFQUFFLFdBQVc7SUFDbEIsS0FBSyxFQUFFLFdBQVc7SUFDbEIsS0FBSyxFQUFFLGFBQWE7SUFDcEIsS0FBSyxFQUFFLGNBQWM7SUFDckIsS0FBSyxFQUFFLGNBQWM7SUFDckIsS0FBSyxFQUFFLG1CQUFtQjtJQUMxQixLQUFLLEVBQUUsZUFBZTtJQUN0QixLQUFLLEVBQUUsY0FBYztJQUNyQixLQUFLLEVBQUUsaUJBQWlCO0lBQ3hCLEtBQUssRUFBRSxlQUFlO0lBQ3RCLEtBQUssRUFBRSxnQkFBZ0I7SUFDdkIsS0FBSyxFQUFFLGNBQWM7SUFDckIsS0FBSyxFQUFFLGdCQUFnQjtJQUN2QixLQUFLLEVBQUUsaUJBQWlCO0lBQ3hCLEtBQUssRUFBRSxpQkFBaUI7SUFDeEIsS0FBSyxFQUFFLHNCQUFzQjtJQUM3QixLQUFLLEVBQUUsa0JBQWtCO0lBQ3pCLEtBQUssRUFBRSxpQkFBaUI7SUFDeEIsS0FBSyxFQUFFLG9CQUFvQjtJQUMzQixLQUFLLEVBQUUsa0JBQWtCO0lBQ3pCLEtBQUssRUFBRSxtQkFBbUI7SUFDMUIsS0FBSyxFQUFFLGVBQWU7SUFDdEIsS0FBSyxFQUFFLGlCQUFpQjtJQUN4QixLQUFLLEVBQUUsa0JBQWtCO0lBQ3pCLE1BQU0sRUFBRSxRQUFRO0lBQ2hCLE1BQU0sRUFBRSxrQkFBa0I7Q0FDM0IsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUU7SUFDeEMsb0JBQW9CO0lBQ3BCLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ25ELE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRXZDLElBQUksb0JBQW9CLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDeEMsT0FBTyxZQUFZLENBQUMsS0FBSyxFQUFFO1lBQ3pCLFNBQVMsRUFBRSxpQkFBaUI7U0FDN0IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGlDQUFpQztJQUNqQyxNQUFNLE1BQU0sR0FBRywyQkFBMkIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFckMsTUFBTSxZQUFZLEdBQUcsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUVuQyxPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDO0FBQzFDLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxDQUM1QixLQUFzQixFQUN0QixJQUFZLEVBQ1osRUFDRSxTQUFTLE1BR1AsRUFBRSxFQUNFLEVBQUU7SUFDVixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBZSxFQUFFO1FBQ3hDLEtBQUssRUFBRSxVQUFVO1FBQ2pCLFFBQVEsRUFBRSxJQUFJO1FBQ2QscUJBQXFCLEVBQUUsU0FBUztRQUNoQyxxQkFBcUIsRUFBRSxTQUFTO0tBQ2pDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLENBQzlCLEtBQWEsRUFDYixFQUFFLFNBQVMsS0FBNkIsRUFBRSxFQUMxQyxFQUFFO0lBQ0YsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUN2QyxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsQ0FBQyxLQUFhLEVBQVUsRUFBRTtJQUN2RCxNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQztJQUN4QyxNQUFNLFVBQVUsR0FBRyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFO1FBQ2pELEtBQUssRUFBRSxPQUFPO1FBQ2QsR0FBRyxFQUFFLFNBQVM7UUFDZCxJQUFJLEVBQUUsU0FBUztRQUNmLElBQUksRUFBRSxTQUFTO1FBQ2YsTUFBTSxFQUFFLFNBQVM7UUFDakIsTUFBTSxFQUFFLFNBQVM7UUFDakIsWUFBWSxFQUFFLE9BQU87S0FDdEIsQ0FBQyxDQUFDO0lBRUgsT0FBTyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztBQUN0QyxDQUFDLENBQUM7QUFFRixNQUFNLG9CQUFvQixHQUFHO0lBQzNCLGdCQUFnQixFQUFFLFFBQVE7SUFDMUIsUUFBUSxFQUFFLFFBQVE7SUFDbEIsZ0JBQWdCLEVBQUUsUUFBUTtJQUMxQixRQUFRLEVBQUUsUUFBUTtJQUNsQixNQUFNLEVBQUUsTUFBTTtJQUNkLEtBQUssRUFBRSxLQUFLO0lBQ1osT0FBTyxFQUFFLE9BQU87SUFDaEIsTUFBTSxFQUFFLE1BQU07Q0FDZixDQUFDO0FBRUYsTUFBTSxjQUFjLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUFFO0lBQy9DLE9BQU8sR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO0lBQ3hCLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQztJQUUzQyxPQUFPLElBQUssSUFBWSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRTtRQUNsRCxLQUFLLEVBQUUsT0FBTztLQUNmLENBQUM7U0FDQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDM0MsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUN0QixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxrQkFBa0IsR0FBRyxDQUFDLEtBQWEsRUFBVSxFQUFFO0lBQzFELE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLE1BQU0sNkJBQTZCLEdBQ2pDLE9BQU8sQ0FBQyxRQUFRLEtBQUssSUFBSSxJQUFJLGtDQUFrQyxDQUFDO0lBRWxFLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxJQUFJLEVBQUU7UUFDeEMsU0FBUyxFQUFFLElBQUk7UUFDZixNQUFNLEVBQUU7WUFDTixHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQzNCLEdBQUcsQ0FBQyw2QkFBNkIsSUFBSTtnQkFDbkMsY0FBYzthQUNmLENBQUM7U0FDSDtRQUNELGNBQWMsRUFBRSxPQUFPO0tBQ3hCLENBQUMsRUFBRSxDQUFDO0FBQ1AsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLENBQUMsS0FBc0IsRUFBVSxFQUFFO0lBQzNELE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRTtRQUM5QixLQUFLLEVBQUUsT0FBTztRQUNkLEdBQUcsRUFBRSxTQUFTO1FBQ2QsSUFBSSxFQUFFLFNBQVM7S0FDaEIsQ0FBQyxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFO1FBQzNCLElBQUksRUFBRSxTQUFTO1FBQ2YsTUFBTSxFQUFFLFNBQVM7S0FDbEIsQ0FBQyxFQUFFLENBQUM7QUFDUCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLEtBQWEsRUFBVSxFQUFFO0lBQzdELE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRTtRQUM5QixLQUFLLEVBQUUsT0FBTztRQUNkLEdBQUcsRUFBRSxTQUFTO1FBQ2QsSUFBSSxFQUFFLFNBQVM7UUFDZixPQUFPLEVBQUUsTUFBTTtLQUNoQixDQUFDLEVBQUUsQ0FBQztBQUNQLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFDLEtBQWEsRUFBVSxFQUFFO0lBQ3ZELE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRTtRQUM5QixLQUFLLEVBQUUsT0FBTztRQUNkLEdBQUcsRUFBRSxTQUFTO0tBQ2YsQ0FBQyxFQUFFLENBQUM7QUFDUCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRyxDQUFDLEtBQWEsRUFBVSxFQUFFO0lBQ2xFLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRTtRQUM5QixLQUFLLEVBQUUsT0FBTztRQUNkLElBQUksRUFBRSxTQUFTO0tBQ2hCLENBQUMsRUFBRSxDQUFDO0FBQ1AsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFOLElBQVksWUFHWDtBQUhELFdBQVksWUFBWTtJQUN0QixtQ0FBcUIsQ0FBQTtJQUNyQiwyQkFBYSxDQUFBO0FBQ2YsQ0FBQyxFQUhXLFlBQVksS0FBWixZQUFZLFFBR3ZCO0FBRUQsTUFBTSxDQUFOLElBQVksVUFPWDtBQVBELFdBQVksVUFBVTtJQUNwQiwyQ0FBUSxDQUFBO0lBQ1IsMkNBQVEsQ0FBQTtJQUNSLGdEQUFXLENBQUE7SUFDWCw4Q0FBVSxDQUFBO0lBQ1YsZ0RBQVcsQ0FBQTtJQUNYLDhDQUFVLENBQUE7QUFDWixDQUFDLEVBUFcsVUFBVSxLQUFWLFVBQVUsUUFPckI7QUFFRCxNQUFNLENBQUMsTUFBTSxhQUFhLEdBQUcsQ0FDM0IsWUFBb0IsRUFDcEIsb0JBQWdDLFVBQVUsQ0FBQyxJQUFJLEVBQy9DLEVBQUU7SUFDRixNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDO0lBQ3ZDLElBQUksVUFBVSxJQUFJLGlCQUFpQixFQUFFLENBQUM7UUFDcEMsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUVELE1BQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLGlCQUFpQixDQUFDLENBQUM7SUFDL0QsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsaUJBQWlCLENBQUMsQ0FBQztJQUUxRSxPQUFPLEdBQUcsU0FBUyxNQUFNLFVBQVUsRUFBRSxDQUFDO0FBQ3hDLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUN4QixJQUFZLEVBQ1osb0JBQWdDLFVBQVUsQ0FBQyxJQUFJLEVBQy9DLEVBQUU7SUFDRixNQUFNLHdCQUF3QixHQUFHLFVBQVUsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV6RCxNQUFNLENBQUMsaUJBQWlCLEVBQUUsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV4RCxNQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUM7SUFFNUMsSUFDRSxpQkFBaUIsS0FBSyxVQUFVLENBQUMsSUFBSTtRQUNyQyxVQUFVLElBQUksd0JBQXdCLEVBQ3RDLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxNQUFNLGFBQWEsR0FBRyxhQUFhLENBQUMsaUJBQWlCLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztJQUUxRSxPQUFPLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxhQUFhLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsYUFBYSxFQUFFLENBQUM7QUFDNUUsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxJQUFVLEVBQVUsRUFBRTtJQUN0RCxPQUFPLFNBQVMsQ0FBQyxJQUFJLEVBQUU7UUFDckIsY0FBYyxFQUFFLE1BQU07S0FDdkIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxLQUFLLEVBQVUsRUFBRSxDQUNsRCxHQUFHLFlBQVksQ0FBQyxLQUFLLEVBQUU7SUFDckIsUUFBUSxFQUFFLFNBQVM7SUFDbkIsY0FBYyxFQUFFLE9BQU87Q0FDeEIsQ0FBQyxFQUFFLENBQUM7QUFFUCxNQUFNLENBQUMsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLEtBQUssRUFBVSxFQUFFLENBQ3JELFlBQVksQ0FBQyxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUV4QyxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLElBQVksRUFBRSxLQUFhLEVBQVUsRUFBRSxDQUN0RSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUU1RSxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsQ0FDN0IsUUFBZ0IsRUFDaEIsc0JBQWtDLFVBQVUsQ0FBQyxLQUFLLEVBQ2xELEVBQUU7SUFDRixNQUFNLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFckQsTUFBTSxtQkFBbUIsR0FBRyxVQUFVLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUUvQixJQUFJLFVBQVUsS0FBSyxVQUFVLENBQUMsSUFBSSxJQUFJLFVBQVUsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1FBQ3hFLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0lBQ3pELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxHQUFHLG1CQUFtQixDQUFDLENBQUM7SUFFcEUsT0FBTyxHQUFHLFNBQVMsTUFBTSxVQUFVLEdBQUcsU0FBUyxFQUFFLENBQUM7QUFDcEQsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlSW50bCwgY3JlYXRlSW50bENhY2hlIH0gZnJvbSAnQGZvcm1hdGpzL2ludGwnO1xuaW1wb3J0IHsgZm9ybWF0RGlzdGFuY2VUb05vd1N0cmljdCwgZm9ybWF0SVNPIH0gZnJvbSAnZGF0ZS1mbnMnO1xuaW1wb3J0IGkxOG5leHQgZnJvbSAnaTE4bmV4dCc7XG5cbmltcG9ydCB7IGF6LCBlblVTLCBlcywgZnIsIG5sLCBwbCwgcnUsIHRyLCB1aywgdmkgfSBmcm9tICdkYXRlLWZucy9sb2NhbGUnO1xuXG5pbXBvcnQgeyBpc0Jyb3dzZXJTdXBwb3J0UmVsYXRpdmVEYXRlRm9ybWF0IH0gZnJvbSAnLi9kZXRlY3QtYnJvd3Nlcic7XG5cbmV4cG9ydCBjb25zdCBNSU5JTVVNX1NIT1dJTkdfQkFMQU5DRSA9IDAuMDAwMDE7XG5leHBvcnQgY29uc3QgREVGQVVMVF9BTU9VTlRfUFJFQ0lTSU9OID0gNDtcbmV4cG9ydCBjb25zdCBTTUFMTF9QUkVDSVNJT04gPSAyO1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfUFJFQ0lTSU9OID0gNTtcbmV4cG9ydCBjb25zdCBGVUxMX1BSRUNJU0lPTiA9IDk7XG5cbmNvbnN0IExvY2FsZSA9IHtcbiAgZW46IGVuVVMsXG4gIGVzOiBlcyxcbiAgdWs6IHVrLFxuICB0cjogdHIsXG4gIG5sOiBubCxcbiAgcnU6IHJ1LFxuICBwbDogcGwsXG4gIHZpOiB2aSxcbiAgZnI6IGZyLFxuICBhejogYXosXG59O1xuXG5jb25zdCBjYWNoZSA9IGNyZWF0ZUludGxDYWNoZSgpO1xuY29uc3QgaW50bCA9IGNyZWF0ZUludGwoXG4gIHtcbiAgICBsb2NhbGU6ICdlbi1VUycsXG4gICAgbWVzc2FnZXM6IHtcbiAgICAgICdjb21wb25lbnRzLnRyYW5zYWN0aW9uX3N0YXR1cyc6ICdTdWNjZXNzJyxcbiAgICB9LFxuICB9LFxuICBjYWNoZSxcbik7XG5cbmV4cG9ydCBjb25zdCBmb3JtYXROdW1iZXIgPSAoXG4gIHZhbHVlOiBudW1iZXIgfCBzdHJpbmcsXG4gIHtcbiAgICBwcmVjaXNpb24sXG4gICAgbm90YXRpb24sXG4gICAgY29tcGFjdERpc3BsYXksXG4gIH06IHtcbiAgICBwcmVjaXNpb24/OiBudW1iZXI7XG4gICAgbm90YXRpb24/OiAnY29tcGFjdCcgfCAnc3RhbmRhcmQnO1xuICAgIGNvbXBhY3REaXNwbGF5PzogJ3Nob3J0JyB8ICdsb25nJztcbiAgfSA9IHt9LFxuKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKHZhbHVlIGFzIG51bWJlciwge1xuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogcHJlY2lzaW9uIHx8IDAsXG4gICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiBwcmVjaXNpb24gfHwgMCxcbiAgICBub3RhdGlvbixcbiAgICBjb21wYWN0RGlzcGxheSxcbiAgfSk7XG59O1xuXG5jb25zdCBCSUdfTlVNQkVSU19OT1RBVElPTl9TWU1CT0wgPSBbXG4gICcnLFxuICAnaycsIC8vVGhvdXNhbmRcbiAgJ00nLCAvL01pbGxpb25cbiAgJ0InLCAvL0JpbGxpb25cbiAgJ1QnLCAvL1RyaWxsaW9uXG4gICdlMTUnLCAvL1F1YWRyaWxsaW9uXG4gICdlMTgnLCAvL1F1aW50aWxsaW9uXG4gICdlMjEnLCAvL1NleHRpbGxpb25cbiAgJ2UyNCcsIC8vU2VwdGlsbGlvblxuICAnZTI3JywgLy9PY3RpbGxpb25cbiAgJ2UzMCcsIC8vTm9uaWxsaW9uXG4gICdlMzMnLCAvL0RlY2lsbGlvblxuICAnZTM2JywgLy9VbmRlY2lsbGlvblxuICAnZTM5JywgLy9EdW9kZWNpbGxpb25cbiAgJ2U0MicsIC8vVHJlZGVjaWxsaW9uXG4gICdlNDUnLCAvL1F1YXR0dW9yZGVjaWxsaW9uXG4gICdlNDgnLCAvL1F1aW5kZWNpbGxpb25cbiAgJ2U1MScsIC8vU2V4ZGVjaWxsaW9uXG4gICdlNTQnLCAvL1NlcHRlbmRlY2lsbGlvblxuICAnZTU3JywgLy9PY3RvZGVjaWxsaW9uXG4gICdlNjAnLCAvL05vdmVtZGVjaWxsaW9uXG4gICdlNjMnLCAvL1ZpZ2ludGlsbGlvblxuICAnZTY2JywgLy9VbnZpZ2ludGlsbGlvblxuICAnZTY5JywgLy9EdW92aWdpbnRpbGxpb25cbiAgJ2U3MicsIC8vVHJldmlnaW50aWxsaW9uXG4gICdlNzUnLCAvL1F1YXR0dW9ydmlnaW50aWxsaW9uXG4gICdlNzgnLCAvL1F1aW52aWdpbnRpbGxpb25cbiAgJ2U4MScsIC8vU2V4dmlnaW50aWxsaW9uXG4gICdlODQnLCAvL1NlcHRlbnZpZ2ludGlsbGlvblxuICAnZTg3JywgLy9PY3RvdmlnaW50aWxsaW9uXG4gICdlOTAnLCAvL05vdmVtdmlnaW50aWxsaW9uXG4gICdlOTMnLCAvL1RyaWdpbnRpbGxpb25cbiAgJ2U5NicsIC8vVW50cmlnaW50aWxsaW9uXG4gICdlOTknLCAvL0R1b3RyaWdpbnRpbGxpb25cbiAgJ2UxMDEnLCAvL0dvb2dvbFxuICAnZTEwNCcsIC8vVHJldHJpZ2ludGlsbGlvblxuXTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdEJpZ051bWJlcnMgPSAodmFsdWUpID0+IHtcbiAgLy8gZGV0ZXJtaW5lcyBzeW1ib2xcbiAgY29uc3QgdGllciA9IChNYXRoLmxvZzEwKE1hdGguYWJzKHZhbHVlKSkgLyAzKSB8IDA7XG4gIGNvbnN0IHRpZXJzV2l0aG91dFN1ZmZpeGVzID0gWzAsIDEsIDJdO1xuXG4gIGlmICh0aWVyc1dpdGhvdXRTdWZmaXhlcy5pbmNsdWRlcyh0aWVyKSkge1xuICAgIHJldHVybiBmb3JtYXROdW1iZXIodmFsdWUsIHtcbiAgICAgIHByZWNpc2lvbjogREVGQVVMVF9QUkVDSVNJT04sXG4gICAgfSk7XG4gIH1cblxuICAvLyBnZXQgc3VmZml4IGFuZCBkZXRlcm1pbmUgc2NhbGVcbiAgY29uc3Qgc3VmZml4ID0gQklHX05VTUJFUlNfTk9UQVRJT05fU1lNQk9MW3RpZXJdO1xuICBjb25zdCBzY2FsZSA9IE1hdGgucG93KDEwLCB0aWVyICogMyk7XG5cbiAgY29uc3Qgc2NhbGVkTnVtYmVyID0gdmFsdWUgLyBzY2FsZTtcblxuICByZXR1cm4gc2NhbGVkTnVtYmVyLnRvRml4ZWQoNSkgKyBzdWZmaXg7XG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0Q3VycmVuY3kgPSAoXG4gIHZhbHVlOiBudW1iZXIgfCBzdHJpbmcsXG4gIGNvZGU6IHN0cmluZyxcbiAge1xuICAgIHByZWNpc2lvbixcbiAgfToge1xuICAgIHByZWNpc2lvbj86IG51bWJlcjtcbiAgfSA9IHt9LFxuKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGludGwuZm9ybWF0TnVtYmVyKHZhbHVlIGFzIG51bWJlciwge1xuICAgIHN0eWxlOiAnY3VycmVuY3knLFxuICAgIGN1cnJlbmN5OiBjb2RlLFxuICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogcHJlY2lzaW9uLFxuICAgIG1heGltdW1GcmFjdGlvbkRpZ2l0czogcHJlY2lzaW9uLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXRQZXJjZW50YWdlID0gKFxuICB2YWx1ZTogbnVtYmVyLFxuICB7IHByZWNpc2lvbiB9OiB7IHByZWNpc2lvbj86IG51bWJlciB9ID0ge30sXG4pID0+IHtcbiAgcmV0dXJuIHZhbHVlLnRvRml4ZWQocHJlY2lzaW9uIHx8IDIpO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdFRpbWVzdGFtcCA9ICh2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgY29uc3QgbG9jYWxlID0gaTE4bmV4dC5sYW5ndWFnZSB8fCAnZW4nO1xuICBjb25zdCBuYXRpdmVJbnRsID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7XG4gICAgbW9udGg6ICdzaG9ydCcsXG4gICAgZGF5OiAnbnVtZXJpYycsXG4gICAgeWVhcjogJ251bWVyaWMnLFxuICAgIGhvdXI6ICdudW1lcmljJyxcbiAgICBtaW51dGU6ICdudW1lcmljJyxcbiAgICBzZWNvbmQ6ICdudW1lcmljJyxcbiAgICB0aW1lWm9uZU5hbWU6ICdzaG9ydCcsXG4gIH0pO1xuXG4gIHJldHVybiBgJHtuYXRpdmVJbnRsLmZvcm1hdChkYXRlKX1gO1xufTtcblxuY29uc3QgZm9ybWF0RGlzdGFuY2VUb2tlbnMgPSB7XG4gIGxlc3NUaGFuWFNlY29uZHM6ICdzZWNvbmQnLFxuICB4U2Vjb25kczogJ3NlY29uZCcsXG4gIGxlc3NUaGFuWE1pbnV0ZXM6ICdtaW51dGUnLFxuICB4TWludXRlczogJ21pbnV0ZScsXG4gIHhIb3VyczogJ2hvdXInLFxuICB4RGF5czogJ2RheScsXG4gIHhNb250aHM6ICdtb250aCcsXG4gIHhZZWFyczogJ3llYXInLFxufTtcblxuY29uc3QgZm9ybWF0RGlzdGFuY2UgPSAodG9rZW4sIGNvdW50LCBvcHRpb25zKSA9PiB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBjb25zdCBsb2NhbGUgPSBvcHRpb25zLmxvY2FsZS5jb2RlIHx8ICdlbic7XG5cbiAgcmV0dXJuIG5ldyAoSW50bCBhcyBhbnkpLlJlbGF0aXZlVGltZUZvcm1hdChsb2NhbGUsIHtcbiAgICBzdHlsZTogJ3Nob3J0JyxcbiAgfSlcbiAgICAuZm9ybWF0KC1jb3VudCwgZm9ybWF0RGlzdGFuY2VUb2tlbnNbdG9rZW5dKVxuICAgIC5yZXBsYWNlKCcuJywgJycpO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdFRpbWVzdGFtcEFnZSA9ICh2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgY29uc3QgaXNTdXBwb3J0ZWRMYW5ndWFnZUFuZEJyb3dzZXIgPVxuICAgIGkxOG5leHQubGFuZ3VhZ2UgIT09ICdheicgJiYgaXNCcm93c2VyU3VwcG9ydFJlbGF0aXZlRGF0ZUZvcm1hdDtcblxuICByZXR1cm4gYCR7Zm9ybWF0RGlzdGFuY2VUb05vd1N0cmljdChkYXRlLCB7XG4gICAgYWRkU3VmZml4OiB0cnVlLFxuICAgIGxvY2FsZToge1xuICAgICAgLi4uTG9jYWxlW2kxOG5leHQubGFuZ3VhZ2VdLFxuICAgICAgLi4uKGlzU3VwcG9ydGVkTGFuZ3VhZ2VBbmRCcm93c2VyICYmIHtcbiAgICAgICAgZm9ybWF0RGlzdGFuY2UsXG4gICAgICB9KSxcbiAgICB9LFxuICAgIHJvdW5kaW5nTWV0aG9kOiAnZmxvb3InLFxuICB9KX1gO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGUgPSAodmFsdWU6IHN0cmluZyB8IG51bWJlcik6IHN0cmluZyA9PiB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gIHJldHVybiBgJHtpbnRsLmZvcm1hdERhdGUoZGF0ZSwge1xuICAgIG1vbnRoOiAnc2hvcnQnLFxuICAgIGRheTogJ251bWVyaWMnLFxuICAgIHllYXI6ICdudW1lcmljJyxcbiAgfSl9LCAke2ludGwuZm9ybWF0VGltZShkYXRlLCB7XG4gICAgaG91cjogJ251bWVyaWMnLFxuICAgIG1pbnV0ZTogJ251bWVyaWMnLFxuICB9KX1gO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGVXaXRoV2Vla2RheSA9ICh2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHZhbHVlKTtcbiAgcmV0dXJuIGAke2ludGwuZm9ybWF0RGF0ZShkYXRlLCB7XG4gICAgbW9udGg6ICdzaG9ydCcsXG4gICAgZGF5OiAnbnVtZXJpYycsXG4gICAgeWVhcjogJ251bWVyaWMnLFxuICAgIHdlZWtkYXk6ICdsb25nJyxcbiAgfSl9YDtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREYXRlU2hvcnQgPSAodmFsdWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gIHJldHVybiBgJHtpbnRsLmZvcm1hdERhdGUoZGF0ZSwge1xuICAgIG1vbnRoOiAnc2hvcnQnLFxuICAgIGRheTogJ251bWVyaWMnLFxuICB9KX1gO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGVXaXRoTW9udGhBbmRZZWFyID0gKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpO1xuICByZXR1cm4gYCR7aW50bC5mb3JtYXREYXRlKGRhdGUsIHtcbiAgICBtb250aDogJ3Nob3J0JyxcbiAgICB5ZWFyOiAnbnVtZXJpYycsXG4gIH0pfWA7XG59O1xuXG5leHBvcnQgZW51bSBIYXNoRm9udFNpemUge1xuICAnZGVmYXVsdCcgPSAnZGVmYXVsdCcsXG4gICdiaWcnID0gJ2JpZycsXG59XG5cbmV4cG9ydCBlbnVtIEhhc2hMZW5ndGgge1xuICBGVUxMID0gMCxcbiAgVElOWSA9IDUsXG4gIExJVFRMRSA9IDEwLFxuICBTTUFMTCA9IDE1LFxuICBNRURJVU0gPSAyMCxcbiAgTEFSR0UgPSAyNSxcbn1cblxuZXhwb3J0IGNvbnN0IHNob3J0ZW5TdHJpbmcgPSAoXG4gIHZhbHVlVG9TaG9ydDogc3RyaW5nLFxuICB2aXNpYmxlSGFzaExlbmd0aDogSGFzaExlbmd0aCA9IEhhc2hMZW5ndGguVElOWSxcbikgPT4ge1xuICBjb25zdCBoYXNoTGVuZ3RoID0gdmFsdWVUb1Nob3J0Lmxlbmd0aDtcbiAgaWYgKGhhc2hMZW5ndGggPD0gdmlzaWJsZUhhc2hMZW5ndGgpIHtcbiAgICByZXR1cm4gdmFsdWVUb1Nob3J0O1xuICB9XG5cbiAgY29uc3QgZmlyc3RQYXJ0ID0gdmFsdWVUb1Nob3J0LnN1YnN0cmluZygwLCB2aXNpYmxlSGFzaExlbmd0aCk7XG4gIGNvbnN0IHNlY29uZFBhcnQgPSB2YWx1ZVRvU2hvcnQuc3Vic3RyaW5nKGhhc2hMZW5ndGggLSB2aXNpYmxlSGFzaExlbmd0aCk7XG5cbiAgcmV0dXJuIGAke2ZpcnN0UGFydH0uLi4ke3NlY29uZFBhcnR9YDtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXRIYXNoID0gKFxuICBoYXNoOiBzdHJpbmcsXG4gIHZpc2libGVIYXNoTGVuZ3RoOiBIYXNoTGVuZ3RoID0gSGFzaExlbmd0aC5USU5ZLFxuKSA9PiB7XG4gIGNvbnN0IE1JTl9UUlVOQ0FURV9IQVNIX0xFTkdUSCA9IEhhc2hMZW5ndGguVElOWSAqIDIgKyAzO1xuXG4gIGNvbnN0IFtoYXNoV2l0aG91dFN1ZmZpeCwgbGFzdERpZ2l0c10gPSBoYXNoLnNwbGl0KCctJyk7XG5cbiAgY29uc3QgaGFzaExlbmd0aCA9IGhhc2hXaXRob3V0U3VmZml4Lmxlbmd0aDtcblxuICBpZiAoXG4gICAgdmlzaWJsZUhhc2hMZW5ndGggPT09IEhhc2hMZW5ndGguRlVMTCB8fFxuICAgIGhhc2hMZW5ndGggPD0gTUlOX1RSVU5DQVRFX0hBU0hfTEVOR1RIXG4gICkge1xuICAgIHJldHVybiBoYXNoO1xuICB9XG5cbiAgY29uc3QgdHJ1bmNhdGVkSGFzaCA9IHNob3J0ZW5TdHJpbmcoaGFzaFdpdGhvdXRTdWZmaXgsIHZpc2libGVIYXNoTGVuZ3RoKTtcblxuICByZXR1cm4gbGFzdERpZ2l0cyA/IGAke3RydW5jYXRlZEhhc2h9LSR7bGFzdERpZ2l0c31gIDogYCR7dHJ1bmNhdGVkSGFzaH1gO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdElTT0RhdGVPbmx5ID0gKGRhdGU6IERhdGUpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gZm9ybWF0SVNPKGRhdGUsIHtcbiAgICByZXByZXNlbnRhdGlvbjogJ2RhdGUnLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREZXBsb3lzQ291bnQgPSAodmFsdWUpOiBzdHJpbmcgPT5cbiAgYCR7Zm9ybWF0TnVtYmVyKHZhbHVlLCB7XG4gICAgbm90YXRpb246ICdjb21wYWN0JyxcbiAgICBjb21wYWN0RGlzcGxheTogJ3Nob3J0JyxcbiAgfSl9YDtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdFJhdGVzVG9DdXJyZW5jeSA9ICh2YWx1ZSk6IHN0cmluZyA9PlxuICBmb3JtYXROdW1iZXIodmFsdWUsIHsgcHJlY2lzaW9uOiA0IH0pO1xuXG5leHBvcnQgY29uc3QgdHJ1bmNhdGVDU1BSTmFtZSA9IChuYW1lOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIpOiBzdHJpbmcgPT5cbiAgbmFtZSAmJiBuYW1lLmxlbmd0aCA+IGxpbWl0ID8gbmFtZS5zdWJzdHJpbmcoMCwgbGltaXQgLSAxKSArICcuLi4nIDogbmFtZTtcblxuZXhwb3J0IGNvbnN0IHNob3J0ZW5Dc3ByTmFtZSA9IChcbiAgY3Nwck5hbWU6IHN0cmluZyxcbiAgdmlzaWJsZVN0cmluZ0xlbmd0aDogSGFzaExlbmd0aCA9IEhhc2hMZW5ndGguU01BTEwsXG4pID0+IHtcbiAgY29uc3QgW25hbWUsIGV4dGVuc2lvbl0gPSBjc3ByTmFtZS5zcGxpdCgvKC5jc3ByKSQvKTtcblxuICBjb25zdCBNSU5fVFJVTkNBVEVfTEVOR1RIID0gSGFzaExlbmd0aC5USU5ZICogMiArIDM7XG4gIGNvbnN0IGhhc2hMZW5ndGggPSBuYW1lLmxlbmd0aDtcblxuICBpZiAoaGFzaExlbmd0aCA9PT0gSGFzaExlbmd0aC5GVUxMIHx8IGhhc2hMZW5ndGggPD0gTUlOX1RSVU5DQVRFX0xFTkdUSCkge1xuICAgIHJldHVybiBjc3ByTmFtZTtcbiAgfVxuXG4gIGNvbnN0IGZpcnN0UGFydCA9IG5hbWUuc3Vic3RyaW5nKDAsIHZpc2libGVTdHJpbmdMZW5ndGgpO1xuICBjb25zdCBzZWNvbmRQYXJ0ID0gbmFtZS5zdWJzdHJpbmcoaGFzaExlbmd0aCAtIHZpc2libGVTdHJpbmdMZW5ndGgpO1xuXG4gIHJldHVybiBgJHtmaXJzdFBhcnR9Li4uJHtzZWNvbmRQYXJ0fSR7ZXh0ZW5zaW9ufWA7XG59O1xuIl19